{"version":3,"sources":["../src/BsMultiSelect.js"],"names":[],"mappings":"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","file":"BsMultiSelect.js","sourcesContent":["import {PluginManager, plugStaticDom} from './PluginManager'\r\n\r\nimport {composeSync, List, extendIfUndefined} from './ToolsJs';\r\nimport {PickDomFactory} from './PickDomFactory';\r\nimport {ChoiceDomFactory} from './ChoiceDomFactory';\r\n\r\nimport {StaticDomFactory, CreateElementAspect} from './StaticDomFactory';\r\n\r\nimport {PicksDom} from './PicksDom';\r\nimport {FilterDom} from './FilterDom';\r\n\r\nimport {ChoicesDomFactory} from './ChoicesDomFactory';\r\nimport {ChoicesVisibilityAspect} from './ChoicesVisibilityAspect';\r\nimport {SpecialPicksEventsAspect} from './SpecialPicksEventsAspect';\r\n \r\nimport {ComponentPropertiesAspect, TriggerAspect, OnChangeAspect} from './ComponentPropertiesAspect';\r\nimport {OptionsAspect, OptionPropertiesAspect} from './OptionsAspect';\r\n\r\nimport {ChoicesEnumerableAspect } from './ChoicesEnumerableAspect'\r\nimport {FilterManagerAspect, NavigateManager, FilterPredicateAspect} from './FilterManagerAspect'\r\nimport {BuildAndAttachChoiceAspect, BuildChoiceAspect} from './BuildChoiceAspect'\r\nimport {OptionsLoopAspect, OptionAttachAspect} from './OptionsLoopAspect'\r\n\r\nimport {UpdateDataAspect } from './UpdateDataAspect'\r\nimport {UpdateAspect } from './UpdateDataAspect'\r\nimport {CreateWrapAspect, CreateChoiceBaseAspect, OptionToggleAspect, CreatePickHandlersAspect, RemovePickAspect, \r\n    AddPickAspect, FullMatchAspect, ChoiceClickAspect, IsChoiceSelectableAspect, ProducePickAspect} from './CreateWrapAspect.js'\r\nimport {NavigateAspect, HoveredChoiceAspect} from './NavigateAspect'\r\nimport {Wraps} from './Wraps'\r\n\r\n\r\nimport {PickButtonAspect} from './PickButtonAspect'\r\n\r\nimport {BuildPickAspect} from './BuildPickAspect'\r\nimport {InputAspect} from './InputAspect'\r\nimport {ResetFilterAspect, FocusInAspect, ResetFilterListAspect} from './ResetFilterListAspect'\r\n\r\nimport {MultiSelectInlineLayout} from './MultiSelectInlineLayout'\r\n\r\nimport {ResetLayoutAspect} from './ResetLayoutAspect'\r\n\r\nimport {LoadAspect} from './LoadAspect'\r\nimport {DoublyLinkedList, ArrayFacade} from './ToolsJs'\r\nimport {CountableChoicesListInsertAspect} from './CountableChoicesListInsertAspect'\r\n\r\n/// environment - common for many; configuration for concreate\r\nexport function BsMultiSelect(element, environment, plugins, configuration, onInit){\r\n    var {window} = environment;\r\n    environment.isIE11 = !!window.MSInputMethodContext && !!document.documentMode;\r\n\r\n    let { containerClass,\r\n          css, \r\n          getDisabled,\r\n          options, \r\n          getText\r\n        } = configuration;\r\n    \r\n    let disposeAspect = {dispose(){}};\r\n    let triggerAspect = TriggerAspect(element, environment.trigger);\r\n    let onChangeAspect = OnChangeAspect(triggerAspect, 'dashboardcode.multiselect:change');\r\n    let componentPropertiesAspect = ComponentPropertiesAspect(getDisabled??(() => false));\r\n    let optionsAspect   = OptionsAspect(options); \r\n    let optionPropertiesAspect = OptionPropertiesAspect(getText);\r\n    let isChoiceSelectableAspect = IsChoiceSelectableAspect();\r\n    let createWrapAspect        = CreateWrapAspect();\r\n    let createChoiceBaseAspect   = CreateChoiceBaseAspect(optionPropertiesAspect);\r\n    //let rtlAspect = RtlAspect();\r\n    //let setOptionSelectedAspect = SetOptionSelectedAspect(optionPropertiesAspect);\r\n    \r\n    let addPickAspect = AddPickAspect();\r\n    let removePickAspect = RemovePickAspect();\r\n    \r\n    let createElementAspect = CreateElementAspect(name => window.document.createElement(name));\r\n    \r\n    let choicesDomFactory = ChoicesDomFactory(createElementAspect);\r\n    let staticDomFactory  = StaticDomFactory(choicesDomFactory, createElementAspect);\r\n    \r\n    let wrapsCollection = ArrayFacade();\r\n    \r\n    let countableChoicesList = DoublyLinkedList(\r\n        (wrap)=>wrap.choice.itemPrev, \r\n        (warp, v)=>warp.choice.itemPrev=v, \r\n        (wrap)=>wrap.choice.itemNext, \r\n        (wrap, v)=>wrap.choice.itemNext=v\r\n    );\r\n    \r\n    let countableChoicesListInsertAspect = CountableChoicesListInsertAspect(countableChoicesList, wrapsCollection);\r\n\r\n    let choicesEnumerableAspect = ChoicesEnumerableAspect(countableChoicesList, wrap=>wrap.choice.itemNext)\r\n    \r\n    let filteredChoicesList = DoublyLinkedList(\r\n        (wrap)=>wrap.choice.filteredPrev, \r\n        (wrap, v)=>wrap.choice.filteredPrev=v, \r\n        (wrap)=>wrap.choice.filteredNext, \r\n        (wrap, v)=>wrap.choice.filteredNext=v\r\n    );\r\n    \r\n    let emptyNavigateManager = NavigateManager(\r\n        countableChoicesList,\r\n        (wrap)=>wrap.choice.itemPrev,\r\n        (wrap)=>wrap.choice.itemNext \r\n        \r\n    ); \r\n    let filteredNavigateManager = NavigateManager(\r\n        filteredChoicesList, \r\n        (wrap)=>wrap.choice.filteredPrev,\r\n        (wrap)=>wrap.choice.filteredNext ); \r\n\r\n    let filterPredicateAspect = FilterPredicateAspect()\r\n\r\n    let filterManagerAspect = FilterManagerAspect(\r\n        emptyNavigateManager,\r\n        filteredNavigateManager,\r\n        \r\n        filteredChoicesList, \r\n        choicesEnumerableAspect,\r\n        filterPredicateAspect\r\n    );\r\n\r\n    let hoveredChoiceAspect = HoveredChoiceAspect()\r\n    let navigateAspect = NavigateAspect(hoveredChoiceAspect, \r\n        (down, hoveredChoice)=>filterManagerAspect.getNavigateManager().navigate(down, hoveredChoice));\r\n    let picksList = List();\r\n    let wraps = Wraps(\r\n        wrapsCollection,\r\n        ()=>countableChoicesList.reset(), \r\n        (w)=>countableChoicesList.remove(w),\r\n        (w, key)=>countableChoicesListInsertAspect.countableChoicesListInsert(w, key));\r\n\r\n    let aspects = {\r\n        environment, configuration, triggerAspect, onChangeAspect, componentPropertiesAspect, disposeAspect, \r\n        countableChoicesList, countableChoicesListInsertAspect,\r\n        optionsAspect, optionPropertiesAspect, \r\n        createWrapAspect, createChoiceBaseAspect, isChoiceSelectableAspect, \r\n        createElementAspect,\r\n        choicesDomFactory, staticDomFactory,\r\n        filterPredicateAspect, wrapsCollection, choicesEnumerableAspect, \r\n        filteredChoicesList, filterManagerAspect, hoveredChoiceAspect, navigateAspect, picksList, wraps,\r\n        addPickAspect, removePickAspect\r\n    }\r\n\r\n    plugStaticDom(plugins, aspects); // apply cssPatch to css, apply selectElement support;  \r\n\r\n    let {choicesDom, createStaticDom} = staticDomFactory.create(css)\r\n\r\n    let {staticDom, staticManager} = createStaticDom(element, containerClass)\r\n\r\n    // after this we can use staticDom (means generated DOM elements) in plugin construtctor, what simplifies parameters passing a lot   \r\n\r\n    // THINK: get filterDom, picksDom  from createStaticDom ?  But this would create excesive dublicate call in  selectElementPlugin\r\n    let filterDom = FilterDom(staticDom.isDisposablePicksElement, createElementAspect, css);\r\n    let picksDom  = PicksDom(staticDom.picksElement, staticDom.isDisposablePicksElement, createElementAspect, css);\r\n    \r\n\r\n    let specialPicksEventsAspect = SpecialPicksEventsAspect();\r\n\r\n    let choicesVisibilityAspect = ChoicesVisibilityAspect(choicesDom.choicesElement);\r\n    let resetFilterListAspect = ResetFilterListAspect(filterDom, filterManagerAspect)\r\n    let resetFilterAspect =  ResetFilterAspect(filterDom, resetFilterListAspect)\r\n    \r\n\r\n    let focusInAspect = FocusInAspect(picksDom);\r\n    \r\n    let pickButtonAspect = PickButtonAspect(configuration.pickButtonHTML);\r\n    \r\n    let pickDomFactory = PickDomFactory(css, componentPropertiesAspect, optionPropertiesAspect, pickButtonAspect);\r\n    let buildPickAspect = BuildPickAspect(picksDom, pickDomFactory);\r\n    let producePickAspect = ProducePickAspect(picksList, removePickAspect, buildPickAspect)\r\n    let createPickHandlersAspect = CreatePickHandlersAspect(producePickAspect);\r\n    \r\n    \r\n    let optionToggleAspect  = OptionToggleAspect(createPickHandlersAspect, addPickAspect);\r\n    let fullMatchAspect = FullMatchAspect(createPickHandlersAspect, addPickAspect);\r\n    let inputAspect = InputAspect(filterDom, filterManagerAspect, fullMatchAspect);    \r\n\r\n    let choiceClickAspect = ChoiceClickAspect(optionToggleAspect, filterDom);\r\n\r\n    let choiceDomFactory = ChoiceDomFactory(css, optionPropertiesAspect, aspects.highlightAspect); // optional highlightAspect added by highlightPlugin\r\n    \r\n    let buildChoiceAspect = BuildChoiceAspect( choicesDom, choiceDomFactory, choiceClickAspect);\r\n    let buildAndAttachChoiceAspect =  BuildAndAttachChoiceAspect(buildChoiceAspect);\r\n    let resetLayoutAspect = ResetLayoutAspect(() => resetFilterAspect.resetFilter());\r\n\r\n    let optionAttachAspect = OptionAttachAspect(createWrapAspect, createChoiceBaseAspect, buildAndAttachChoiceAspect, wraps);\r\n    let optionsLoopAspect = OptionsLoopAspect(optionsAspect, optionAttachAspect);\r\n    let updateDataAspect = UpdateDataAspect(choicesDom, wraps, picksList, optionsLoopAspect, resetLayoutAspect);\r\n    let updateAspect = UpdateAspect(updateDataAspect);\r\n\r\n    let loadAspect = LoadAspect(optionsLoopAspect);\r\n\r\n    extendIfUndefined(aspects, {\r\n        staticDom, picksDom, choicesDom,filterDom, resetLayoutAspect, pickDomFactory, choiceDomFactory,\r\n        choicesVisibilityAspect, staticManager, buildChoiceAspect, optionToggleAspect,  choiceClickAspect, \r\n        buildAndAttachChoiceAspect, optionsLoopAspect, optionAttachAspect,\r\n        buildPickAspect, producePickAspect, createPickHandlersAspect, inputAspect, resetFilterListAspect, resetFilterAspect, \r\n        specialPicksEventsAspect,\r\n        resetLayoutAspect, focusInAspect, \r\n        loadAspect, updateDataAspect, updateAspect, \r\n        fullMatchAspect} )\r\n    \r\n    let pluginManager = PluginManager(plugins, aspects);\r\n    \r\n    let multiSelectInlineLayout =  MultiSelectInlineLayout(aspects);\r\n\r\n    let api = {component: \"BsMultiSelect.api\"} // key to use in memory leak analyzes\r\n    pluginManager.buildApi(api);\r\n\r\n    // after this we can pass aspects methods call without wrapping - there should be no more overridings. TODO freeze aspects?\r\n    api.dispose = composeSync(\r\n        resetLayoutAspect.resetLayout,\r\n        ()=>{disposeAspect.dispose()},\r\n        pluginManager.dispose, \r\n        ()=>{picksList.forEach(pick=>pick.dispose());},\r\n        multiSelectInlineLayout.dispose, // TODO move to layout\r\n        wraps.dispose,\r\n        staticManager.dispose,  picksDom.dispose, filterDom.dispose );\r\n    \r\n    api.updateData = () => { \r\n        updateDataAspect.updateData();\r\n    };\r\n    api.update = () => {\r\n        updateAspect.update()\r\n    }\r\n \r\n    \r\n    // TODO api.updateOption = (key) => {/* all updates: selected, disabled, hidden, text */}\r\n\r\n    onInit?.(api, aspects);\r\n    picksDom.pickFilterElement.appendChild(filterDom.filterInputElement);\r\n    picksDom.picksElement.appendChild(picksDom.pickFilterElement); \r\n    staticManager.appendToContainer();\r\n    loadAspect.load();\r\n    return api;\r\n}\r\n"]}