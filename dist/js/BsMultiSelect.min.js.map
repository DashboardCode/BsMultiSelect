{"version":3,"sources":["../../src/ToolsJs.js","../../src/ToolsDom.js","../../src/ToolsStyling.js","../../src/FilterManagerAspect.js","../../src/Wraps.js","../../src/MultiSelectInlineLayoutAspect.js","../../src/BsMultiSelect.js","../../src/CreateElementAspect.js","../../src/NavigateAspect.js","../../src/PickButtonAspect.js","../../src/ComponentPropertiesAspect.js","../../src/OptionsAspect.js","../../src/CreateWrapAspect.js","../../src/CountableChoicesListInsertAspect.js","../../src/ChoicesEnumerableAspect.js","../../src/PicksDomFactory.js","../../src/FilterDomFactory.js","../../src/ChoicesDomFactory.js","../../src/PickDomFactory.js","../../src/ChoiceDomFactory.js","../../src/StaticDomFactory.js","../../src/ChoicesVisibilityAspect.js","../../src/PicksElementAspect.js","../../src/SpecialPicksEventsAspect.js","../../src/ResetFilterListAspect.js","../../src/BuildPickAspect.js","../../src/InputAspect.js","../../src/BuildChoiceAspect.js","../../src/ResetLayoutAspect.js","../../src/OptionsLoopAspect.js","../../src/UpdateDataAspect.js","../../src/LoadAspect.js","../../src/AfterInputAspect.js","../../src/PluginManager.js","../../src/BsMultiSelectDepricatedParameters.js","../../src/MultiSelectBuilder.js","../../src/CreateForJQuery.js","../../src/AddToJQueryPrototype.js","../../src/plugins/BsAppearancePlugin.js","../../src/plugins/BsAppearanceBs5Plugin.js","../../src/plugins/LabelForAttributePlugin.js","../../src/plugins/RtlPlugin.js","../../src/plugins/ValidationApiPlugin.js","../../src/plugins/HiddenOptionPlugin.js","../../src/plugins/CssPatchPlugin.js","../../src/plugins/JQueryMethodsPlugin.js","../../src/plugins/OptionsApiPlugin.js","../../src/plugins/SelectedOptionPlugin.js","../../src/plugins/DisabledOptionPlugin.js","../../src/plugins/PicksApiPlugin.js","../../src/plugins/PicksPlugin.js","../../src/plugins/CreatePopperPlugin.js","../../src/plugins/ChoicesDynamicStylingPlugin.js","../../src/plugins/HighlightPlugin.js","../../src/plugins/CustomChoiceStylingsPlugin.js","../../src/plugins/CustomPickStylingsPlugin.js","../../src/plugins/UpdateAppearancePlugin.js","../../src/plugins/DisableComponentPlugin.js","../../src/plugins/PlaceholderPlugin.js","../../src/plugins/PlaceholderCssPatchPlugin.js","../../src/plugins/FloatingLabelPlugin.js","../../src/plugins/WarningCssPatchPlugin.js","../../src/plugins/WarningPlugin.js","../../src/PluginSet.js","../../src/plugins/WarningBs5Plugin.js","../../src/plugins/CssPatchBs5Plugin.js","../../src/plugins/BsAppearanceBs5CssPatchPlugin.js","../../src/plugins/FloatingLabelCssPatchBs5Plugin.js","../../src/plugins/SelectElementPlugin.js","../../src/plugins/FormResetPlugin.js","../../src/plugins/FormRestoreOnBackwardPlugin.js","../../src/ToolSet.js","../../src/BsMultiSelect.jquery.js","../../src/DomFactories.js"],"names":["isBoolean","value","isString","String","extendIfUndefined","destination","source","property","undefined","shallowClearClone","v","_len","arguments","length","sources","Array","_key","forEach","s","hasOwnProperty","forEachRecursion","f","e","prev","indexRecursion","index","List","tail","count","add","next","node","remove","getTail","getCount","isEmpty","reset","DoublyLinkedList","getPrev","setPrev","getNext","setNext","head","getHead","composeSync","_len2","functions","_key2","defCall","_len3","_key3","_i","_functions","Function","tmp","ObservableLambda","func","list","getValue","call","attach","detachAll","findDirectChildByTagName","element","tagName","i","children","closestByTagName","closest","closestByClassName","className","classList","contains","containsAndSelf","otherNode","getDataGuardedWithPrefix","prefix","name","tmp1","getAttribute","tmp2","predicate","Element","parentNode","getIsRtl","isRtl","attributeName","attribute","closestByAttribute","EventBinder","bind","eventName","handler","addEventListener","push","unbind","removeEventListener","EventTumbler","on","off","addStyling","styling","backupStyling","classes","styles","slice","style","removeStyling","toggleStyling","isOn","isF","force","extendClasses","out","param","actionStr","actionArr","isRemoveEmptyClasses","c","split","extend","actionObj","Object","Styling","a","o","freeze","createStyling","isReplace","params","extendInt","p","concat","createCss","stylings1","stylings2","param1","param2","NavigateManager","navigate","down","wrap","Wraps","wrapsCollection","listFacade_reset","listFacade_remove","listFacade_add","insert","key","clear","dispose","forLoop","MultiSelectInlineLayoutAspect","environment","filterDom","choicesDom","choicesVisibilityAspect","hoveredChoiceAspect","navigateAspect","filterManagerAspect","focusInAspect","optionToggleAspect","createPickHandlersAspect","picksList","inputAspect","specialPicksEventsAspect","buildChoiceAspect","resetLayoutAspect","picksElementAspect","afterInputAspect","disposeAspect","choicesElement","window","document","eventLoopFlag","flag","pr","get","set","timeout","clearTimeout","setTimeout","EventLoopProlongableFlag","skipFocusout","resetSkipFocusout","skipoutMousedown","choicesElementMousedownEventTumbler","documentMouseupEventTumbler","documentMouseup","event","target","setFocus","resetLayout","setFocusIn","showChoices","isChoicesVisible","updatePopupLocation","setChoicesVisible","scrollTop","hideChoices","resetMouseCandidateChoice","resetHoveredChoice","preventDefaultClickEvent","skipoutAndResetMousedown","handleOnRemoveButton","setSelectedFalse","uncheckOption","processUncheck","mouseCandidateEventBinder","mouseOverToHoveredAndReset","choice","isHoverIn","hoverIn","keyDownArrow","onKeyDown","keyCode","which","empty","indexOf","preventDefault","pick","backSpace","stopPropagation","onKeyUp","hoveredWrap","getNavigateManager","getHoveredChoice","toggle","clickToShowChoices","setFocusIfNotTarget","init","onFocusIn","onFocusOut","onInput","visibleCount","_inputAspect$processI","processInput","filterInputValue","processEmptyInput","setWidth","visible","notVisible","onClick","onMousedown","origCreatePickHandlers","createPickHandlers","pickHandlers","removeOnButton","origBuildChoice","buildChoice","removeAndDispose","unbindChoiceElement","choiceElement","overAndLeaveEventBinder","adoptChoiceElement","BsMultiSelect","pluginManager","configuration","onInit","_pluginManager$layout","isIE11","MSInputMethodContext","documentMode","createElementFromHtml","hoveredChoice","buttonHTML","containerClass","css","getDisabled","options","getText","triggerAspect","trigger","TriggerAspect","onChangeAspect","onChange","OnChangeAspect","componentPropertiesAspect","ComponentPropertiesAspect","optionsAspect","getOptions","OptionsAspect","optionPropertiesAspect","option","text","OptionPropertiesAspect","isChoiceSelectableAspect","isSelectable","createWrapAspect","createWrap","createChoiceBaseAspect","createChoiceBase","filteredPrev","filteredNext","searchText","toLowerCase","trim","isFilteredIn","setVisible","setHoverIn","isChoiceElementAttached","choiceDom","choiceElementAttach","itemPrev","itemNext","CreateChoiceBaseAspect","addPickAspect","addPick","producePick","removePickAspect","removePick","createElementAspect","html","innerHTML","createElement","splice","start","countableChoicesList","warp","countableChoicesListInsertAspect","countableChoicesListInsert","choiceNext","CountableChoicesListInsertAspect","choicesEnumerableAspect","ChoicesEnumerableAspect","filteredChoicesList","filterPredicateAspect","filterPredicate","emptyNavigateManager","filteredNavigateManager","showEmptyFilter","filterText","getFilter","setFilter","FilterManagerAspect","setHoveredChoice","NavigateAspect","wraps","w","picksDomFactory","create","picksElement","isDisposablePicksElement","pickFilterElement","picks","pickFilter","disableToggleStyling","picks_disabled","focusToggleStyling","picks_focus","isFocusIn","createPickElement","pickElement","beforeElement","insertBefore","detach","removeChild","disable","isComponentDisabled","toggleFocusStyling","getIsFocusIn","setIsFocusIn","newIsFocusIn","PicksDomFactory","filterDomFactory","filterInputElement","filterInput","setAttribute","eventBinder","setEmpty","focus","width","onFilterInputInput","onfilterInputKeyDown","onFilterInputKeyUp","FilterDomFactory","choicesDomFactory","choicesListElement","appendChild","display","choices","choicesList","createChoiceElement","isVisible","ChoicesDomFactory","pickDomFactory","pickButtonAspect","getButtonHTML","pickContentElement","querySelector","pickButtonElement","pickContent","pickButton","disableToggle","pickContent_disabled","pickDom","pickDomManagerHandlers","updateData","textContent","updateDisabled","isOptionDisabled","PickDomFactory","pickButtonHTML","choiceDomFactory","updateDataInternal","choiceDomManagerHandlers","choiceContentElement","choiceCheckBoxElement","choiceLabelElement","choiceContent","choiceCheckBox","choiceLabel","choiceSelectedToggle","choice_selected","choiceDisabledToggle","choice_disabled","choiceCheckBoxDisabledToggle","choiceCheckBox_disabled","choiceLabelDisabledToggle","choiceLabel_disabled","choiceCursorDisabledToggle","cursor","choiceHoverToggle","choice_disabled_hover","isOptionSelected","choice_hover","updateHoverIn","isCheckBoxDisabled","disabled","updateSelected","checked","ChoiceDomFactory","plugStaticDomFactories","staticDomFactory","createStaticDom","showError","message","backgroundColor","color","Error","containerElement","removableContainerClass","picksDom","staticDom","initialElement","staticManager","appendToContainer","StaticDomFactory","plugStaticDom","componentDisabledEventBinder","skipoutAndResetMousedownEventBinder","_createStaticDom","resetFilterListAspect","forceResetFilter","ResetFilterListAspect","resetFilterAspect","resetFilter","ResetFilterAspect","FocusInAspect","buildPickAspect","buildPick","_picksDom$createPickE","_pickDomFactory$creat","updateComponentDisabled","pickElementAttach","BuildPickAspect","producePickAspect","fixSelectedFalse","removeFromPicksList","ProducePickAspect","CreatePickHandlersAspect","OptionToggleAspect","fullMatchAspect","fullMatch","FullMatchAspect","fullMatchWrap","InputAspect","choiceClickAspect","choiceClick","ChoiceClickAspect","_choicesDom$createCho","_choiceDomFactory$cre","BuildChoiceAspect","buildAndAttachChoiceAspect","buildAndAttachChoice","getNextElement","BuildAndAttachChoiceAspect","optionAttachAspect","OptionAttachAspect","optionsLoopAspect","loop","OptionsLoopAspect","updateDataAspect","UpdateDataAspect","updateAspect","update","UpdateAspect","loadAspect","load","LoadAspect","onClickUnbind","panelIsVisble","AfterInputAspect","multiSelectInlineLayoutAspect","layout","api","component","buildApi","aspects","ComposePluginManagerFactory","plugins","defaults","buildAspectsList","buildAspects","settings","eventHandlers","events","instances","disposes","_instances$i$buildApi","_instances$i","_instances$_i2$dispos","_instances$_i","newAspects","_eventHandlers$i$valu","_eventHandlers$i$valu2","_eventHandlers$i$valu3","_eventHandlers$i$valu4","_loop","plugStaticDomBus","some","after","_eventHandlers$_i3$va","_eventHandlers$_i3$va2","instance","_eventHandlers$i$valu5","_eventHandlers$i$valu6","PluginManager","transformStyles","old","opt","transformClasses","MultiSelectBuilder","defaultCss","pluginManagerFactory","_options2","buildConfiguration","_options","console","log","cssPatch","selectedPanelFocusBorderColor","selectedPanelFocusBoxShadow","boxShadow","borderColor","inputColor","useCss","pick_disabled","useCssPatch","getIsValid","getIsInValid","adjustLegacySettings","defaultSettings","createForJQuery","$","globalPopper","isJQyery","body","hasAttribute","Event","dispatchEvent","createEvent","initCustomEvent","composeEventTrigger","_MultiSelectBuilder","object","arr","ObjectValuesEx","createForUmd","Default","prototypable","pluginName","createPlugin","firstChar","charAt","firstCharLower","prototypableName","noConflictPrototypable","fn","noConflictPrototypableForInstance","dataKey","createInstance","$e","removeData","data","output","this","each","isMethodName","test","methodName","lMethodName","result","prototypableForInstance","noConflict","addToJQueryPrototype","removeInstanceData","multiSelect","BsAppearancePlugin","labelAspect","selectElement","getDefaultLabel","origLabelAspectGetLabel","getLabel","labelElement","updateSize","validationApiAspect","updateAppearanceAspect","floatingLabelAspect","getValidity","getSize","composeGetSize","isFloatingLabel","composeGetValidity","picks_lg","picks_sm","picks_def","picks_floating_def","picksLgStyling","picksSmStyling","picksDefStyling","size","updateSizeClasses","updateSizeJsPicks","updateSizeJs","updateSizeJsForAdapter","updateSizeForAdapter","origToggleFocusStyling","validity","validationObservable","picks_focus_invalid","picks_focus_valid","wasUpdatedObservable","getManualValidationObservable","validationApiObservable","_getMessagesElements","siblings","l","siblingsAsArray","invalidMessages","filter","validMessages","getMessagesElements","map","updateValidity","updateAppearance","updateWasValidated","inputGroupElement","query","id","p1","parentElement","LabelForAttributePlugin","label","LabelAspect","labelNewIdAspect","createInputId","LabelNewIdAspect","labelForAttributeAspect","backupedForAttribute","newId","LabelForAttributeAspect","RtlPlugin","popperRtlAspect","forceRtlOnContainer","attributeBackup","currentAtribute","restore","removeAttribute","dirAttributeValue","ValidationApiPlugin","getValueRequired","valueMissingMessage","getIsValueMissing","required","optionsArray","selected","isValueMissingObservable","setValue","newValue","ValidationApiAspect","validationApi","visibleElement","onValid","customValidationMessage","validationMessage","willValidate","setMessage","valueMissing","customError","valid","setCustomValidity","checkValidity","reportValidity","ValidityApi","isValid","layoutInit","buildHiddenChoice","updateChoiceHidden","getNextNonHidden","getIsOptionHidden","newIsOptionHidden","isOptionHidden","nextChoice","CssPatchPlugin","extendCss","JQueryMethodsPlugin","getContainer","getChoices","getChoicesList","getFilterInput","getPicks","picksCount","OptionsApiPlugin","updateOptionAdded","_nextChoice","updateOptionRemoved","updateChoiceSelected","getIsOptionSelected","newIsSelected","updateChoiceDisabled","getIsOptionDisabled","newIsDisabled","PicksApiPlugin","forEachPeak","getTailPeak","_picksList$getTail","countPeaks","isEmptyPeaks","updateHidden","PicksPlugin","origAdd","origReset","_origAdd","addOptionPicked","CreatePopperPlugin","createPopperConstructor","createPopper","Popper","createModifiersVX","createPopperVX","anchorElement","popperConfiguration","CreateModifiersV1","CreateModifiersV2","createPopperConfigurationAspect","createConfiguration","preventOverflow","placement","modifiers","CreatePopperConfigurationAspect","createPopperAspect","popper","destroy","CreatePopperAspect","pop","origBackSpace","CreatePopper_ConstrunctorAspect","enabled","hide","flip","fallbackPlacements","ChoicesDynamicStylingPlugin","useChoicesDynamicStyling","choicesDynamicStyling","minimalChoicesDynamicStylingMaxHeight","origSetChoicesVisible","g","getElementsByTagName","documentElement","new_y","innerHeight","clientHeight","getBoundingClientRect","top","msHeight","Math","max","round","setProperty","ChoicesDynamicStylingPlugin_scrollHandle","origNavigateAspectNavigate","scrollIntoView","HighlightPlugin","useHighlighting","highlightAspect","HighlightAspect","origCreateChoiceDomFactory","updateHighlighted","highlighter","getHighlighter","origProcessEmptyInput","origSetFilter","origSetVisible","CustomChoiceStylingsPlugin","customChoiceStylings","customChoiceStylingsAspect","customize","handlers","customChoiceStylingsClosure","custom","CustomChoiceStylingsAspect","origChoiceDomFactoryCreate","ExtendChoiceDomFactory","CustomPickStylingsPlugin","customPickStylings","customPickStylingsAspect","customPickStylingsClosure","CustomPickStylingsAspect","origPickDomFactoryCreate","ExtendPickDomFactory","UpdateAppearancePlugin","DisableComponentPlugin","origCreatePickDomFactory","origOnClick","disableComponent","newIsComponentDisabled","PlaceholderPlugin","resetableFlag","placeholder","setPlaceholder","ignoreNextInputResetableFlag","placeholderStopInputAspect","setPlaceholderOrig","origOnInput","setEmptyInputWidth","emptyToggleStyling","filterInput_empty","showPlacehodler","updatePlacehodlerVisibility","updateEmptyInputWidth","origDisable","setDisabled","returnValue","PlaceholderCssPatchPlugin","FloatingLabelPlugin","label_floating_lifted","picks_floating_lifted","updateLiftedLabel","liftToggleStyling1","liftToggleStyling2","liftedLabel","WarningCssPatchPlugin","warning","paddingLeft","paddingRight","zIndex","fontSize","WarningPlugin","noResultsWarning","isNoResultsWarningEnabled","warningAspect","warningElement","origAppendToContainer","nextSibling","show","WarningAspect","origVisible","origNotVisible","ExtendAfterInputAspect","pop2","origWarningAspectShow","msg","Bs5PluginSet","BsAppearanceBs5Plugin","WarningBs5Plugin","CssPatchBs5Plugin","opacity","PickDomFactoryPlugCssPatch","float","verticalAlign","PickDomFactoryPlugCssPatchBs5","listStyleType","flexWrap","height","marginBottom","PicksDomFactoryPlugCssPatch","paddingInlineStart","paddingInlineEnd","PicksDomFactoryPlugCssPatchBs5","justifyContent","ChoiceDomFactoryPlugCssPatch","ChoicesDomFactoryPlugCssPatch","border","padding","margin","outline","backgroundImage","FilterDomFactoryPlugCssPatch","BsAppearanceBs5CssPatchPlugin","minHeight","FloatingLabelCssPatchBs5Plugin","transform","paddingTop","paddingBottom","multiSelectPlugins","SelectElementPlugin","optGroupAspect","origStaticDomFactoryCreate","origCreateStaticDom","disposableContainerElement","backupDisplay","backupedRequired","fieldsetElement","getOptionOptGroup","getOptGroupText","optGroup","getOptGroupId","origLoadAspectLoop","readyState","domContentLoadedHandler","HiddenOptionPlugin","origBuildAndAttachChoice","origIsSelectable","hidden","origCreateWrap","updateOptionsHidden","updateOptionHidden","FormResetPlugin","eventBuilder","form","SelectedOptionPlugin","getSelected","setIsOptionSelected","setSelected","updateOptionsSelectedAspect","updateOptionsSelected","UpdateOptionsSelectedAspect","origFilterPredicate","composeUpdateSelected","booleanValue","trySetWrapSelected","success","origAddPick","selectAll","deselectAll","setOptionSelected","updateOptionSelected","FormRestoreOnBackwardPlugin","DisabledOptionPlugin","origToggle","origBuildPick","choiceUpdateDisabledBackup","updateOptionsDisabled","updateOptionDisabled","picksPlugins","allPlugins","utilities","PickDomFactoryPlugCssBs5","PicksDomFactoryPlugCss","ChoiceDomFactoryPlugCss","ChoiceDomFactoryPlugCssBs5","ChoicesDomFactoryPlugCss","FilterDomFactoryPlugCss","createDefaultCssBs5","jQuery","BsPicks","MultiSelectTools"],"mappings":"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","sourcesContent":["export function isBoolean(value){\r\n    return value === true || value === false;\r\n}\r\n\r\nexport function isString(value){\r\n    return value instanceof String || typeof(value) === 'string';\r\n}\r\n\r\nexport function extendIfUndefined(destination, source) {\r\n    for (let property in source)\r\n        if (destination[property] === undefined)\r\n            destination[property] = source[property];\r\n}\r\n\r\nexport function shallowClearClone(source, ...sources) { // override previous, no null and undefined\r\n    var destination = {};\r\n    for (let property in source){ // TODO:  Object.assign (need polyfill for IE11)\r\n        let v = source[property];\r\n        if (!(v === null || v===undefined))\r\n            destination[property] = v;\r\n    }\r\n    if(sources)\r\n        sources.forEach(\r\n            s=>{\r\n                for(let property in s){\r\n                    let v = s[property];\r\n                    if (!(v === null || v===undefined))\r\n                        destination[property] = v;\r\n                    else\r\n                        if (destination.hasOwnProperty(property)){\r\n                            delete destination[property];\r\n                        }\r\n                }\r\n            }\r\n        )\r\n    return destination;\r\n}\r\n\r\nfunction forEachRecursion(f, e){\r\n    if (!e)\r\n        return;\r\n    let goOn = f(e.value); \r\n    if (!(goOn===false))\r\n        forEachRecursion(f, e.prev);\r\n}\r\n\r\nfunction indexRecursion(index, e){\r\n    if (!e.prev)\r\n        return index;\r\n    indexRecursion(++index, e.prev);\r\n}\r\n\r\nexport function List(){\r\n    var tail = null;\r\n    var count = 0;\r\n    return {\r\n        add(e){\r\n            if (tail){\r\n                tail.next = {value:e, prev:tail, next:null};\r\n                tail = tail.next;\r\n            } else \r\n                tail = {value:e, prev:null, next:null}\r\n            count++;\r\n            let node = tail;\r\n            function remove(){\r\n                if (node.prev){\r\n                    (node.prev).next = node.next;\r\n                }\r\n                if (node.next){\r\n                    (node.next).prev = node.prev;\r\n                }\r\n                if (tail == node){\r\n                    tail = node.prev;\r\n                }\r\n                count--;\r\n            }\r\n            function index(){\r\n                return indexRecursion(0, node);\r\n            }\r\n            return {remove, index};\r\n        },\r\n        forEach(f){\r\n            forEachRecursion(f, tail);\r\n        },\r\n        getTail(){ return (tail)?tail.value:null },\r\n        getCount(){ return count },\r\n        isEmpty(){ return count==0 },\r\n        reset(){ tail=null; count = 0 }\r\n    }\r\n}\r\n\r\nexport function DoublyLinkedList(getPrev, setPrev, getNext, setNext){\r\n    var head = null, tail = null;\r\n    var count = 0;\r\n    return {\r\n        add(e, next){\r\n            if (!tail){\r\n                head = tail = e;\r\n                setPrev(e, null);\r\n                setNext(e, null);\r\n            }\r\n            else {\r\n                if (!next){\r\n                    setPrev(e, tail);\r\n                    setNext(e, null);\r\n                    setNext(tail, e);\r\n                    tail = e;\r\n                } \r\n                else{\r\n                    if (next===head)\r\n                        head=e;\r\n                    let prev = getPrev(next);\r\n                    setNext(e, next);\r\n                    setPrev(next, e);\r\n                    if (prev){\r\n                        setPrev(e, prev);\r\n                        setNext(prev, e);\r\n                    } else {\r\n                        setPrev(e, null);\r\n                    }\r\n                } \r\n            }\r\n            count++;\r\n        },\r\n        remove(e){\r\n            let next = getNext(e);\r\n            let prev = getPrev(e);\r\n            if (prev) {\r\n                setNext(prev, next)\r\n            }\r\n            if (next) {\r\n                 setPrev(next, prev)\r\n            }\r\n            if (tail == e) {\r\n                tail = prev;\r\n            }\r\n            if (head == e) {\r\n                head = next; \r\n            }\r\n            count--;\r\n        }, \r\n        getHead(){ return head },\r\n        getTail(){ return tail },\r\n        getCount(){ return count },\r\n        isEmpty(){ return count==0 },\r\n        reset(){ \r\n            tail=head=null; \r\n            count = 0; }\r\n    }\r\n}\r\n\r\nexport function DoublyLinkedCollection(getPrev, setPrev, getNext, setNext){\r\n    var list = [];\r\n    var head = null, tail = null;\r\n    return {\r\n        push(e){\r\n            list.push(e);\r\n            if (!tail){\r\n                head = tail = e;\r\n                setPrev(e, null);\r\n                setNext(e, null);\r\n            }\r\n            else {\r\n                setPrev(e, tail);\r\n                setNext(e, null);\r\n                setNext(tail, e);\r\n                tail = e;\r\n            }\r\n        },\r\n        add(e, key){\r\n            list.splice(key, 0, e);\r\n            if (!tail){\r\n                head = tail = e;\r\n                setPrev(e, null);\r\n                setNext(e, null);\r\n            }\r\n            else {\r\n                let next = list[key];\r\n                if (!next) {\r\n                    setPrev(e, tail);\r\n                    setNext(e, null);\r\n                    setNext(tail, e);\r\n                    tail = e;\r\n                } \r\n                else {\r\n                    if (next===head)\r\n                        head=e;\r\n                    let prev = getPrev(next);\r\n                    setNext(e, next);\r\n                    setPrev(next, e);\r\n                    if (prev){\r\n                        setPrev(e, prev);\r\n                        setNext(prev, e);\r\n                    } else {\r\n                        setPrev(e, null);\r\n                    }\r\n                } \r\n            }\r\n        },\r\n        get: (key) => list[key],\r\n        remove(key){\r\n            var e = list[key];\r\n            list.splice(key, 1);\r\n            let next = getNext(e);\r\n            let prev = getPrev(e);\r\n            if (prev) {\r\n                setNext(prev, next)\r\n            }\r\n            if (next) {\r\n                 setPrev(next, prev)\r\n            }\r\n            if (tail == e) {\r\n                tail = prev;\r\n            }\r\n            if (head == e) {\r\n                head = next; \r\n            }\r\n            return e;\r\n        }, \r\n        forLoop(f){\r\n            for(let i=0; i<list.length; i++)\r\n            {\r\n                let e = list[i];\r\n                f(e);\r\n            }\r\n        },\r\n        getHead(){ return head },\r\n        getTail(){ return tail },\r\n        getCount(){ return list.length },\r\n        isEmpty(){ return list.length==0 },\r\n        reset(){ \r\n            list=[];\r\n            tail=head=null; \r\n            }\r\n    }\r\n}\r\n\r\nexport function ArrayFacade(){\r\n    var list = [];\r\n    return {\r\n        push(e){\r\n            list.push(e);\r\n        },\r\n        add(e, key){\r\n            list.splice(key, 0, e);\r\n        },\r\n        get: (key) => list[key],\r\n        getNext: (key, predicate) => {\r\n            let count = list.length;\r\n            let start = key+1;\r\n            if (key<count) {\r\n                if (!predicate)\r\n                    return list[start];\r\n                for (let i = start; i < count; i++) {\r\n                    let c = list[i];\r\n                    if (predicate(c))\r\n                        return c;\r\n                }\r\n            }\r\n        },\r\n        remove(key){\r\n            var e = list[key];\r\n            list.splice(key, 1);\r\n            return e;\r\n        }, \r\n        forLoop(f){\r\n            for(let i=0; i<list.length; i++)\r\n            {\r\n                let e = list[i];\r\n                f(e, i);\r\n            }\r\n        },\r\n        getHead(){ return list[0] },\r\n        getCount(){ return list.length },\r\n        isEmpty(){ return list.length==0 },\r\n        reset(){ list=[];}\r\n    }\r\n}\r\n\r\nexport function composeSync(...functions){\r\n    return () => \r\n        functions.forEach(\r\n        (f) => {\r\n            if (f)\r\n                f();\r\n        }\r\n    )\r\n}\r\n\r\nexport function defCall(...functions){\r\n    for (let f of functions) \r\n        if (f) {\r\n            if (f instanceof Function){\r\n                let tmp =  f();\r\n                if (tmp)\r\n                    return tmp;\r\n            }\r\n            else\r\n                return f \r\n        }\r\n}\r\n\r\nexport function ObservableValue(value){\r\n    var list = List();\r\n    return {\r\n        getValue(){\r\n            return value;\r\n        },\r\n        setValue(newValue){\r\n            value = newValue;\r\n            list.forEach(f=>f(newValue));\r\n        },\r\n        attach(f){\r\n            return list.add(f)\r\n        },\r\n        detachAll(){\r\n            list.reset();\r\n        }\r\n    }\r\n}\r\n\r\nexport function ObservableLambda(func){\r\n    var list = List();\r\n    var value = func();\r\n    return {\r\n        getValue(){\r\n            return value;\r\n        },\r\n        call(){\r\n            value = func();\r\n            list.forEach(f=>f(value));\r\n        },\r\n        attach(f){\r\n            return list.add(f)\r\n        },\r\n        detachAll(){\r\n            list.reset();\r\n        }\r\n    }\r\n}\r\n\r\n// export function ObjectValues(object){ // Object.values(plugins) - problem for IE11; full impementation of polifill is mor complex, but for our purpose this is enough\r\n//     var arr = [];\r\n// \tfor (var key in object) {\r\n//         arr.push(object[key]);\r\n// \t}\r\n// \treturn arr;\r\n// }\r\n\r\nexport function ObjectValuesEx(object){ \r\n    var arr = [];\r\n\tfor (var key in object) {\r\n        arr.push({key:key, value:object[key]});\r\n\t}\r\n\treturn arr;\r\n}","export function findDirectChildByTagName(element, tagName){\r\n    let value = null;\r\n    for (let i = 0; i<element.children.length; i++)\r\n    {\r\n        let tmp = element.children[i];\r\n        if (tmp.tagName==tagName)\r\n        {\r\n            value = tmp;\r\n            break;\r\n        }\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function composeEventTrigger(window){ \r\n    let trigger;\r\n    if (typeof(window.Event) === 'function'){\r\n        trigger = (e, eventName) =>{ \r\n            var event = new window.Event(eventName);\r\n            e.dispatchEvent(event);\r\n        }\r\n    }\r\n    else\r\n        trigger = (e, eventName) =>  { // IE 11 polyfill\r\n            let event = window.document.createEvent(\"CustomEvent\");\r\n            event.initCustomEvent(eventName, false, false, undefined);\r\n            e.dispatchEvent(event);\r\n    }\r\n    return trigger;\r\n}\r\n\r\nexport function closestByTagName(element, tagName){\r\n    return closest(element, e => e.tagName === tagName) // TODO support xhtml?  e.tagName.toUpperCase() ?\r\n}\r\n\r\nexport function closestByClassName(element, className){\r\n    return closest(element, e => e.classList.contains(className))\r\n}\r\n\r\nexport function closestByAttribute(element, attributeName, attribute){\r\n    return closest(element, e => e.getAttribute(attributeName)===attribute )\r\n}\r\n\r\nexport function containsAndSelf(node, otherNode ){\r\n    return node === otherNode || node.contains(otherNode);  \r\n}\r\n\r\nexport function getDataGuardedWithPrefix(element, prefix, name){\r\n    var tmp1 = element.getAttribute('data-' + prefix + '-' + name);\r\n    if (tmp1) {\r\n        return tmp1;\r\n    } else  {\r\n        var tmp2 = element.getAttribute('data-' + name);\r\n        if (tmp2)\r\n            return tmp2;\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction closest(element, predicate){\r\n    if (!element || !(element instanceof Element)) return null; // should be element, not document (TODO: check iframe)\r\n     \r\n    if (predicate(element)) return element;\r\n    return closest(element.parentNode, predicate);\r\n}\r\n\r\nexport function siblingsAsArray(element){\r\n    var value = []\r\n    if (element.parentNode){\r\n        var children = element.parentNode.children;\r\n        var l = element.parentNode.children.length;\r\n        if (children.length>1){\r\n            for (var i=0; i < l; ++i){\r\n                var e = children[i];\r\n                if (e!=element)\r\n                    value.push(e);\r\n                \r\n            }\r\n        }\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getIsRtl(element){\r\n    var isRtl = false;\r\n    var e = closestByAttribute(element,\"dir\",\"rtl\");\r\n    if (e)\r\n        isRtl = true;\r\n    return isRtl;\r\n}\r\n\r\nexport function EventBinder(){\r\n    var list = [];\r\n    return {\r\n        bind(element, eventName, handler) {\r\n            element.addEventListener(eventName, handler)\r\n            list.push( {element, eventName, handler} )\r\n        },\r\n        unbind() {\r\n            list.forEach( e=> {\r\n                let {element, eventName, handler}=e;\r\n                element.removeEventListener(eventName, handler)\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport function EventTumbler(element, eventName, handler){\r\n    return {\r\n        on() {\r\n            element.addEventListener(eventName, handler)\r\n        },\r\n        off() {\r\n            element.removeEventListener(eventName, handler)\r\n        }\r\n    }\r\n}\r\n\r\nexport function AttributeBackup(){\r\n    var list = [];\r\n    return {\r\n        set(element, attributeName, attribute){\r\n            var currentAtribute =  element.getAttribute(attributeName); \r\n            list.push( {element, currentAtribute, attribute} )\r\n            element.setAttribute(attributeName, attribute)\r\n        },\r\n        restore(){\r\n            list.forEach(e=>{\r\n                let {element, attributeName, attribute} = e;\r\n                if (attributeName)\r\n                    element.setAttribute(attributeName, attribute)\r\n                else\r\n                    element.removeAttribute(attributeName)\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport function EventLoopFlag(window) {\r\n    var flag = false;\r\n    return {\r\n        get(){\r\n            return flag;\r\n        },\r\n        set(){\r\n            flag = true;\r\n            pr = window.setTimeout( \r\n                () => {  \r\n                        flag = false;\r\n            })\r\n            \r\n        }\r\n    }\r\n}\r\n\r\nexport function EventLoopProlongableFlag(window) {\r\n    var flag = false;\r\n    var pr = null;\r\n    return {\r\n        get(){\r\n            return flag;\r\n        },\r\n        set(timeout){\r\n            if (flag && pr){\r\n                window.clearTimeout(pr);\r\n            }\r\n            flag = true;\r\n            pr = window.setTimeout( \r\n                () => {  \r\n                        flag = false;\r\n                        pr=null;\r\n                }, timeout?timeout:0)\r\n            \r\n        }\r\n    }\r\n}\r\n\r\nexport function ResetableFlag() {\r\n    var flag = false;\r\n    return {\r\n        get(){\r\n            return flag;\r\n        },\r\n        set(){\r\n            flag = true;\r\n        },\r\n        reset(){\r\n            flag = false;\r\n        }\r\n    }\r\n}","import {shallowClearClone, isString} from './ToolsJs';\r\n\r\nexport function addStyling(element, styling){\r\n    var backupStyling = {classes:[], styles:{}}\r\n    if (styling) {\r\n        var {classes, styles} = styling;\r\n        classes.forEach(e => element.classList.add(e)) // todo use add(classes)\r\n        backupStyling.classes = classes.slice();\r\n        for (let property in styles){\r\n            backupStyling.styles[property] = element.style[property];\r\n            element.style[property] = styles[property]; // todo use Object.assign (need polyfill for IE11)\r\n        }\r\n    }\r\n    return backupStyling;\r\n}\r\n\r\nfunction removeStyling(element, styling){\r\n    if (styling) {\r\n        var {classes, styles} = styling;\r\n        classes.forEach(e=>element.classList.remove(e)) // todo use remove(classes)\r\n        for (let property in styles)\r\n            element.style[property]  = styles[property]; // todo use Object.assign (need polyfill for IE11)\r\n    }\r\n}\r\n\r\nexport function toggleStyling(element, styling){\r\n    var backupStyling = {classes:[], styles:{}};\r\n    var isOn=false;\r\n    var isF = styling instanceof Function;\r\n    return (value, force)=>{\r\n        if (value) {\r\n            if (isOn===false){\r\n                backupStyling = addStyling(element, isF?styling():styling)\r\n                isOn=true;\r\n            } else if (force){\r\n                removeStyling(element, backupStyling);\r\n                backupStyling =addStyling(element, isF?styling():styling)\r\n            }\r\n        } else {\r\n            if (isOn===true || force===true){\r\n                removeStyling(element, backupStyling);\r\n                isOn=false;\r\n            } \r\n        }\r\n    }\r\n}\r\n\r\nfunction extendClasses(out, param, actionStr, actionArr, isRemoveEmptyClasses){\r\n    if (isString(param)){\r\n        if (param === \"\"){\r\n            if (isRemoveEmptyClasses){\r\n                out.classes = [];\r\n            }\r\n        } else {\r\n            let c = param.split(' ');\r\n            out.classes = actionStr(c);\r\n        }\r\n        return true;\r\n    } else if (param instanceof Array){\r\n        if (param.length==0){\r\n            if (isRemoveEmptyClasses){\r\n                out.classes = [];\r\n            }\r\n        }\r\n        else{\r\n            out.classes = actionArr(param);\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction extend(value, param, actionStr, actionArr, actionObj, isRemoveEmptyClasses){\r\n    var success = extendClasses(value, param, actionStr, actionArr, isRemoveEmptyClasses);\r\n    if (success === false){\r\n        if (param instanceof Object){\r\n            var {classes, styles} = param;\r\n            extendClasses(value, classes, actionStr, actionArr, isRemoveEmptyClasses);\r\n            \r\n            if (styles) {\r\n                value.styles = actionObj(styles);\r\n            } else if (!classes) {\r\n                value.styles = actionObj(param)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function Styling(param){\r\n    var value = {classes:[], styles:{}};\r\n    if (param){\r\n        extend(value, param, a=>a, a=>a.slice(), o=>shallowClearClone(o), true);\r\n    }\r\n    return Object.freeze(value);\r\n}\r\n\r\nfunction createStyling(isReplace, param, ...params){\r\n    var value = {classes:[], styles:{}};\r\n    if (param){\r\n        extend(value, param, a=>a, a=>a.slice(), o=>shallowClearClone(o),true);\r\n        if (params){\r\n            var {classes, styles} = value;\r\n            var extendInt = isReplace? (p)=>extend(value, p, s=>s, a=>a.slice(), o=> shallowClearClone(styles, o),true):\r\n                (p)=>extend(value, p, a=>classes.concat(a), a=>classes.concat(a), o=>shallowClearClone(styles, o),false)\r\n            params.forEach(p=> extendInt(p));\r\n        }\r\n    }\r\n    return Styling(value);\r\n}\r\n\r\nexport function createCss(stylings1, stylings2){\r\n    var destination = {};\r\n    for (let property in stylings1) {\r\n        let param1 = stylings1[property];\r\n\r\n        let param2 = stylings2?stylings2[property]:undefined;\r\n        if (param2===undefined)\r\n            destination[property] = Styling(param1)\r\n        else{\r\n            destination[property] = createStyling(true, param1, param2); \r\n        }\r\n    }\r\n    if (stylings2)\r\n        for (let property in stylings2) {\r\n            if (!stylings1[property])\r\n                destination[property] = Styling(stylings2[property])\r\n        }\r\n    return destination;\r\n}\r\n\r\nexport function extendCss(stylings1, stylings2){\r\n    for (let property in stylings2) {\r\n        let param2 = stylings2[property];\r\n        let param1 = stylings1[property];\r\n        if (param1 === undefined)\r\n            stylings1[property] = Styling(param2)\r\n        else{\r\n            stylings1[property] = createStyling(false, param1, param2); \r\n        }\r\n    }\r\n}","export function NavigateManager(\r\n    list, getPrev, getNext\r\n){\r\n    return {\r\n        navigate(down, wrap /* hoveredChoice */){ \r\n            if (down) {\r\n                return wrap?getNext(wrap): list.getHead();\r\n            } else {\r\n                return wrap?getPrev(wrap): list.getTail();\r\n            }\r\n        },\r\n        getCount(){\r\n            return list.getCount()\r\n        },\r\n        getHead(){\r\n            return list.getHead()\r\n        }\r\n    }\r\n}\r\n\r\nexport function FilterPredicateAspect(){\r\n    return {\r\n        filterPredicate: (wrap, text) => \r\n            wrap.choice.searchText.indexOf(text) >= 0    \r\n    }\r\n}\r\n\r\nexport function FilterManagerAspect(\r\n    emptyNavigateManager,\r\n    filteredNavigateManager,\r\n    filteredChoicesList, \r\n    choicesEnumerableAspect,\r\n    filterPredicateAspect\r\n    ) {\r\n    let showEmptyFilter=true;\r\n    let filterText = \"\";\r\n    return {\r\n        getNavigateManager(){\r\n            return (showEmptyFilter)?emptyNavigateManager:filteredNavigateManager;\r\n        },\r\n        processEmptyInput(){ // redefined in PlaceholderPulgin, HighlightPlugin\r\n            showEmptyFilter =true;\r\n            filterText =\"\";\r\n            choicesEnumerableAspect.forEach( (wrap)=>{\r\n                wrap.choice.setVisible(true);\r\n            });\r\n        },\r\n        getFilter(){\r\n            return filterText;\r\n        },\r\n        setFilter(text){   // redefined in  HighlightPlugin\r\n            showEmptyFilter =false;\r\n            filterText = text;\r\n            filteredChoicesList.reset();\r\n            choicesEnumerableAspect.forEach( (wrap)=>{\r\n                wrap.choice.filteredPrev = wrap.choice.filteredNext = null;\r\n                var v = filterPredicateAspect.filterPredicate(wrap, text)\r\n                if (v)\r\n                    filteredChoicesList.add(wrap);\r\n                wrap.choice.setVisible(v);\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","export function Wraps(wrapsCollection,  \r\n    listFacade_reset, listFacade_remove, listFacade_add) \r\n{\r\n    return {\r\n        push: (wrap) => push(wrap, wrapsCollection, listFacade_add),\r\n        insert: (key, wrap) => insert(key, wrap, wrapsCollection, listFacade_add),\r\n        remove: (key) => {\r\n            var wrap = wrapsCollection.remove(key);\r\n            listFacade_remove(wrap);\r\n            return wrap;\r\n        },\r\n        clear: () => {\r\n            wrapsCollection.reset();\r\n            listFacade_reset();\r\n        }, \r\n        dispose: () => wrapsCollection.forLoop(wrap => wrap.dispose()) \r\n    }\r\n}\r\n\r\nfunction push(wrap, wrapsCollection, listFacade_add){\r\n    wrapsCollection.push(wrap);\r\n    listFacade_add(wrap);\r\n}\r\n\r\nfunction insert(key, wrap, wrapsCollection, listFacade_add){\r\n    if (key>=wrapsCollection.getCount()) {\r\n        push(wrap, wrapsCollection, listFacade_add);\r\n    }\r\n    else {\r\n        wrapsCollection.add(wrap, key);\r\n        listFacade_add(wrap, key);\r\n    }\r\n}","import {composeSync} from './ToolsJs';\r\nimport {EventBinder, EventLoopProlongableFlag, EventTumbler, containsAndSelf} from './ToolsDom'\r\n\r\nexport function MultiSelectInlineLayoutAspect (\r\n        environment, filterDom, choicesDom, \r\n        choicesVisibilityAspect, \r\n        hoveredChoiceAspect, navigateAspect, filterManagerAspect,\r\n        focusInAspect, optionToggleAspect,\r\n        createPickHandlersAspect,\r\n        picksList,\r\n        inputAspect, specialPicksEventsAspect,  buildChoiceAspect, \r\n        resetLayoutAspect,\r\n\r\n        picksElementAspect,\r\n        \r\n        afterInputAspect,\r\n        disposeAspect\r\n    ) \r\n{\r\n    let choicesElement = choicesDom.choicesElement;\r\n    var window = environment.window;\r\n    var document = window.document;\r\n    var eventLoopFlag =EventLoopProlongableFlag(window); \r\n    var skipFocusout = false; // state\r\n    \r\n    function getSkipFocusout() {\r\n        return skipFocusout;\r\n    };\r\n    function resetSkipFocusout() {\r\n        skipFocusout = false;\r\n    };\r\n    function setSkipFocusout() {\r\n        skipFocusout = true;\r\n    };\r\n\r\n    // we want to escape the closing of the menu (because of focus out from) on a user's click inside the container\r\n    var skipoutMousedown = function() {\r\n        setSkipFocusout();\r\n    }\r\n\r\n    // add listeners that manages close dropdown on  click outside container\r\n    var choicesElementMousedownEventTumbler = EventTumbler(choicesElement, \"mousedown\", skipoutMousedown);\r\n    var documentMouseupEventTumbler = EventTumbler(document, \"mouseup\", documentMouseup);\r\n\r\n    var documentMouseup = function(event) {\r\n        // if we would left without focus then \"close the drop\" do not remove focus border\r\n        if (choicesElement == event.target) \r\n            filterDom.setFocus()\r\n\r\n        // if click outside container - close dropdown\r\n        else if ( !containsAndSelf(choicesElement, event.target) && !picksElementAspect.containsAndSelf(event.target)) {\r\n            resetLayoutAspect.resetLayout();\r\n            focusInAspect.setFocusIn(false);\r\n        }\r\n    }\r\n\r\n    function showChoices() {\r\n        if ( !choicesVisibilityAspect.isChoicesVisible() )\r\n        {\r\n            choicesVisibilityAspect.updatePopupLocation();\r\n            eventLoopFlag.set();\r\n            choicesVisibilityAspect.setChoicesVisible(true);\r\n            \r\n            // TODO: move to scroll plugin\r\n            choicesElement.scrollTop = 0;\r\n            \r\n            choicesElementMousedownEventTumbler.on();\r\n            documentMouseupEventTumbler.on();\r\n        }\r\n    }\r\n\r\n    function hideChoices() {\r\n        resetMouseCandidateChoice();\r\n        hoveredChoiceAspect.resetHoveredChoice();\r\n        if (choicesVisibilityAspect.isChoicesVisible())\r\n        {\r\n            // COOMENT OUT DEBUGGING popup layout\r\n            choicesVisibilityAspect.setChoicesVisible(false);\r\n            \r\n            choicesElementMousedownEventTumbler.off();\r\n            documentMouseupEventTumbler.off();\r\n        }\r\n    }\r\n\r\n    var preventDefaultClickEvent = null;\r\n\r\n    // TODO: remove setTimeout: set on start of mouse event reset on end\r\n    function skipoutAndResetMousedown(){\r\n        skipoutMousedown();\r\n        window.setTimeout(()=>resetSkipFocusout());\r\n    }\r\n\r\n    function processUncheck(uncheckOption, event){\r\n        // we can't remove item on \"click\" in the same loop iteration - it is unfrendly for 3PP event handlers (they will get detached element)\r\n        // never remove elements in the same event iteration\r\n        window.setTimeout(()=>uncheckOption())\r\n        preventDefaultClickEvent = event; // setPreventDefaultMultiSelectEvent\r\n    }\r\n\r\n    // function handleOnRemoveButton(onRemove, setSelectedFalse){\r\n    //     // processRemoveButtonClick removes the item\r\n    //     // what is a problem with calling 'remove' directly (not using  setTimeout('remove', 0)):\r\n    //     // consider situation \"MultiSelect\" on DROPDOWN (that should be closed on the click outside dropdown)\r\n    //     // therefore we aslo have document's click's handler where we decide to close or leave the DROPDOWN open.\r\n    //     // because of the event's bubling process 'remove' runs first. \r\n    //     // that means the event's target element on which we click (the x button) will be removed from the DOM together with badge \r\n    //     // before we could analize is it belong to our dropdown or not.\r\n    //     // important 1: we can't just the stop propogation using stopPropogate because click outside dropdown on the similar \r\n    //     // component that use stopPropogation will not close dropdown (error, dropdown should be closed)\r\n    //     // important 2: we can't change the dropdown's event handler to leave dropdown open if event's target is null because of\r\n    //     // the situation described above: click outside dropdown on the same component.\r\n    //     // Alternatively it could be possible to use stopPropogate but together create custom click event setting new target \r\n    //     // that belomgs to DOM (e.g. panel)\r\n\r\n\r\n    //     onRemove(event => {\r\n    //         processUncheck(setSelectedFalse, event);\r\n    //         hideChoices();\r\n    //         resetFilterAspect.resetFilter(); \r\n    //     });\r\n    // }\r\n    \r\n    function handleOnRemoveButton(setSelectedFalse){ return (event) => {\r\n        processUncheck(setSelectedFalse, event);\r\n        resetLayoutAspect.resetLayout(); \r\n    }}\r\n    \r\n    let mouseCandidateEventBinder = EventBinder();\r\n    var resetMouseCandidateChoice = () => {\r\n        mouseCandidateEventBinder.unbind();\r\n    };\r\n\r\n    var mouseOverToHoveredAndReset = (wrap) => {\r\n        \r\n        if (!wrap.choice.isHoverIn)\r\n            navigateAspect.hoverIn(wrap);\r\n        resetMouseCandidateChoice();\r\n    };\r\n \r\n    function adoptChoiceElement(wrap){\r\n        let choiceElement = wrap.choice.choiceElement;\r\n        // in chrome it happens on \"become visible\" so we need to skip it, \r\n        // for IE11 and edge it doesn't happens, but for IE11 and Edge it doesn't happens on small \r\n        // mouse moves inside the item. \r\n        // https://stackoverflow.com/questions/59022563/browser-events-mouseover-doesnt-happen-when-you-make-element-visible-and-mous\r\n        \r\n        var onChoiceElementMouseover = () => \r\n        {\r\n            if (eventLoopFlag.get() )\r\n            {\r\n                resetMouseCandidateChoice();\r\n                mouseCandidateEventBinder.bind(choiceElement, 'mousemove', ()=>mouseOverToHoveredAndReset(wrap));\r\n                mouseCandidateEventBinder.bind(choiceElement, 'mousedown', ()=>mouseOverToHoveredAndReset(wrap));\r\n            }\r\n            else\r\n            {\r\n                if (!wrap.choice.isHoverIn)\r\n                {\r\n                    // NOTE: mouseleave is not enough to guarantee remove hover styles in situations\r\n                    // when style was setuped without mouse (keyboard arrows)\r\n                    // therefore force reset manually (done inside hoverIn)\r\n                    navigateAspect.hoverIn(wrap);\r\n                }   \r\n            }\r\n        }\r\n        \r\n        // note 1: mouseleave preferred to mouseout - which fires on each descendant\r\n        // note 2: since I want add aditional info panels to the dropdown put mouseleave on dropdwon would not work\r\n        var onChoiceElementMouseleave = () => {\r\n            if (!eventLoopFlag.get()) {\r\n                hoveredChoiceAspect.resetHoveredChoice();\r\n            }\r\n        }\r\n        var overAndLeaveEventBinder = EventBinder();\r\n        overAndLeaveEventBinder.bind(choiceElement, 'mouseover',  onChoiceElementMouseover);\r\n        overAndLeaveEventBinder.bind(choiceElement, 'mouseleave', onChoiceElementMouseleave);\r\n\r\n        return overAndLeaveEventBinder.unbind;\r\n    }\r\n\r\n    \r\n\r\n\r\n    // it can be initated by 3PP functionality\r\n    // sample (1) BS functionality - input x button click - clears input\r\n    // sample (2) BS functionality - esc keydown - clears input\r\n    // and there could be difference in processing: (2) should hide the menu, then reset , when (1) should just reset without hiding.\r\n\r\n    function afterInput(){\r\n        let visibleCount = filterManagerAspect.getNavigateManager().getCount();\r\n\r\n        if (visibleCount > 0){\r\n            afterInputAspect.visible(showChoices, visibleCount);\r\n        }else{\r\n            afterInputAspect.notVisible(hideChoices);\r\n        }\r\n    }\r\n\r\n    function keyDownArrow(down) {\r\n        let wrap = navigateAspect.navigate(down);  \r\n        if (wrap)\r\n        {\r\n            // TODO: next line should be moved to planned  \"HeightAndScroll\" plugin, actual only for scrolling with keyDown functionality\r\n            eventLoopFlag.set(400); // means disable mouse handlers that set hovered choice item; arrowDown can intiate scrolling when scrolling can itiate mouse leave on hovered item; this stops it\r\n            navigateAspect.hoverIn(wrap); // !\r\n            showChoices(); \r\n        }\r\n    }\r\n\r\n    function hoveredToSelected(){\r\n        let hoveredWrap = hoveredChoiceAspect.getHoveredChoice(); \r\n        if (hoveredWrap){\r\n            let wasToggled = optionToggleAspect.toggle(hoveredWrap); \r\n            if (wasToggled) {\r\n                resetLayoutAspect.resetLayout();\r\n            }\r\n        }\r\n    }\r\n\r\n    // TODO: bind it more declarative way? (compact code)\r\n    var onKeyDown = (event) => {\r\n        let keyCode = event.which;\r\n        var empty = filterDom.isEmpty();\r\n        if ([ 13,\r\n              27  // '27-esc' there is \"just in case\", I can imagine that there are user agents that do UNDO\r\n            ].indexOf(keyCode)>=0 \r\n            || (keyCode == 9 && !empty) //  otherwice there are no keyup (true at least for '9-tab'),\r\n            ) {\r\n                event.preventDefault(); \r\n            \r\n            // '13-enter'  - prevention against form's default button \r\n            // but doesn't help with bootsrap modal ESC or ENTER (close behaviour);\r\n        }\r\n        if ([ 38, 40 ].indexOf(keyCode) >= 0 )\r\n            event.preventDefault(); \r\n        if (keyCode == 8 /*backspace*/) {\r\n            // NOTE: this will process backspace only if there are no text in the input field\r\n            // If user will find this inconvinient, we will need to calculate something like this\r\n            // let isBackspaceAtStartPoint = (this.filterInput.selectionStart == 0 && this.filterInput.selectionEnd == 0);\r\n            if (empty) {\r\n                let pick = picksList.getTail();\r\n                if (pick){ \r\n                    specialPicksEventsAspect.backSpace(pick);\r\n                }\r\n            }\r\n        }\r\n        // ---------------------------------------------------------------------------------\r\n        // NOTE: no preventDefault called in case of empty for 9-tab\r\n        else if (keyCode == 9  /*tab*/) { // NOTE: no keydown for this (without preventDefaul after TAB keyup event will be targeted another element)  \r\n            if (empty) { \r\n                hideChoices();  // hideChoices inside (and no filter reset since it is empty) \r\n            }\r\n        }\r\n        else if (keyCode == 27 /*esc*/ ) { // NOTE: forbid the ESC to close the modal (in case the nonempty or dropdown is open)\r\n            if (!empty  || choicesVisibilityAspect.isChoicesVisible())\r\n                event.stopPropagation()\r\n        }\r\n        else if (keyCode == 38) {\r\n            keyDownArrow(false); // up\r\n        }\r\n        else if (keyCode == 40) {\r\n            keyDownArrow(true); // down\r\n        }\r\n    }\r\n    var onKeyUp = (event) => {\r\n        let keyCode = event.which;\r\n        //var handler = keyUp[event.which/* key code */];\r\n        //handler();    \r\n        if (keyCode == 9 /*tab*/) {\r\n            if (choicesVisibilityAspect.isChoicesVisible()) {\r\n                keyDownArrow(true);\r\n            } else {\r\n                if (filterManagerAspect.getNavigateManager().getCount()>0){\r\n                    showChoices();\r\n                }\r\n            }\r\n        }\r\n        else if (keyCode == 13 ) {\r\n            if (choicesVisibilityAspect.isChoicesVisible()) {\r\n                hoveredToSelected();\r\n            } else {\r\n                if (filterManagerAspect.getNavigateManager().getCount()>0){\r\n                    showChoices();\r\n                }\r\n            }\r\n        }\r\n        else if (keyCode == 27) { // escape\r\n            // is it always empty (bs x can still it) \r\n            resetLayoutAspect.resetLayout();\r\n        }\r\n    }\r\n\r\n    function clickToShowChoices(event){\r\n        filterDom.setFocusIfNotTarget(event.target);\r\n        if (preventDefaultClickEvent != event) {\r\n            if (choicesVisibilityAspect.isChoicesVisible()){\r\n                hideChoices() \r\n            } else {\r\n                if (filterManagerAspect.getNavigateManager().getCount()>0)\r\n                    showChoices();\r\n            }\r\n        }\r\n        preventDefaultClickEvent=null;\r\n    }\r\n\r\n    return {\r\n        init(){\r\n            filterDom.onFocusIn(()=>focusInAspect.setFocusIn(true));\r\n            filterDom.onFocusOut(() => { \r\n                    if (!getSkipFocusout()){ // skip initiated by mouse click (we manage it different way)\r\n                        resetLayoutAspect.resetLayout(); // if do not do this we will return to filtered list without text filter in input\r\n                        focusInAspect.setFocusIn(false);\r\n                    }\r\n                    resetSkipFocusout();\r\n                }\r\n            );\r\n                \r\n            filterDom.onInput(() => {\r\n                let {filterInputValue, isEmpty} = inputAspect.processInput();\r\n                if (isEmpty)\r\n                    filterManagerAspect.processEmptyInput();\r\n                else\r\n                    filterDom.setWidth(filterInputValue);  \r\n                eventLoopFlag.set(); // means disable mouse handlers that set hovered item; otherwise we will get \"Hover On MouseEnter\" when filter's changes should remove hover\r\n                afterInput();\r\n            });    \r\n            filterDom.onKeyDown(onKeyDown);    \r\n            filterDom.onKeyUp(onKeyUp);\r\n                \r\n            picksElementAspect.onClick(clickToShowChoices);\r\n            picksElementAspect.onMousedown(skipoutAndResetMousedown);\r\n        \r\n            resetLayoutAspect.resetLayout = composeSync(\r\n                hideChoices,\r\n                resetLayoutAspect.resetLayout // resetFilter by default\r\n            );\r\n        \r\n            let origCreatePickHandlers = createPickHandlersAspect.createPickHandlers;\r\n            createPickHandlersAspect.createPickHandlers = (wrap) => {\r\n                let pickHandlers = origCreatePickHandlers(wrap);\r\n                pickHandlers.removeOnButton = handleOnRemoveButton(pickHandlers.removeOnButton);\r\n                return pickHandlers;\r\n            } \r\n        \r\n            let origBuildChoice = buildChoiceAspect.buildChoice;\r\n            buildChoiceAspect.buildChoice = (wrap) => {\r\n                origBuildChoice(wrap);\r\n                let pickHandlers = createPickHandlersAspect.createPickHandlers(wrap);\r\n        \r\n                wrap.choice.remove = composeSync(wrap.choice.remove, () => {\r\n                    if (pickHandlers.removeAndDispose) {\r\n                        pickHandlers.removeAndDispose();\r\n                        pickHandlers.removeAndDispose=null;\r\n                    }\r\n                })\r\n                \r\n                let unbindChoiceElement = adoptChoiceElement(wrap);\r\n                wrap.choice.dispose = composeSync(unbindChoiceElement, wrap.choice.dispose);\r\n            }\r\n\r\n            disposeAspect.dispose = composeSync(disposeAspect.dispose, resetMouseCandidateChoice, () => picksElementAspect.unbind() );\r\n        }\r\n    }\r\n}\r\n","import {composeSync, List} from './ToolsJs';\r\nimport {PickDomFactory} from './PickDomFactory';\r\nimport {ChoiceDomFactory} from './ChoiceDomFactory';\r\n\r\nimport {StaticDomFactory} from './StaticDomFactory';\r\n\r\nimport {CreateElementAspect} from './CreateElementAspect';\r\n\r\nimport {PicksDomFactory} from './PicksDomFactory';\r\nimport {FilterDomFactory} from './FilterDomFactory';\r\n\r\nimport {ChoicesDomFactory} from './ChoicesDomFactory';\r\nimport {ChoicesVisibilityAspect} from './ChoicesVisibilityAspect';\r\nimport {SpecialPicksEventsAspect} from './SpecialPicksEventsAspect';\r\n \r\nimport {ComponentPropertiesAspect, TriggerAspect, OnChangeAspect} from './ComponentPropertiesAspect';\r\nimport {OptionsAspect, OptionPropertiesAspect} from './OptionsAspect';\r\n\r\nimport {ChoicesEnumerableAspect } from './ChoicesEnumerableAspect'\r\nimport {FilterManagerAspect, NavigateManager, FilterPredicateAspect} from './FilterManagerAspect'\r\nimport {BuildAndAttachChoiceAspect, BuildChoiceAspect} from './BuildChoiceAspect'\r\nimport {OptionsLoopAspect, OptionAttachAspect} from './OptionsLoopAspect'\r\n\r\nimport {UpdateDataAspect } from './UpdateDataAspect'\r\nimport {UpdateAspect } from './UpdateDataAspect'\r\nimport {CreateWrapAspect, CreateChoiceBaseAspect, OptionToggleAspect, CreatePickHandlersAspect, RemovePickAspect, \r\n    AddPickAspect, FullMatchAspect, ChoiceClickAspect, IsChoiceSelectableAspect, ProducePickAspect} from './CreateWrapAspect.js'\r\nimport {NavigateAspect, HoveredChoiceAspect} from './NavigateAspect'\r\nimport {Wraps} from './Wraps'\r\n\r\n\r\nimport {PickButtonAspect} from './PickButtonAspect'\r\n\r\nimport {BuildPickAspect} from './BuildPickAspect'\r\nimport {InputAspect} from './InputAspect'\r\nimport {ResetFilterAspect, FocusInAspect, ResetFilterListAspect} from './ResetFilterListAspect'\r\n\r\nimport {MultiSelectInlineLayoutAspect} from './MultiSelectInlineLayoutAspect'\r\n\r\nimport {ResetLayoutAspect} from './ResetLayoutAspect'\r\n\r\nimport {LoadAspect} from './LoadAspect'\r\nimport {DoublyLinkedList, ArrayFacade} from './ToolsJs'\r\nimport {CountableChoicesListInsertAspect} from './CountableChoicesListInsertAspect'\r\n\r\nimport {PicksElementAspect} from './PicksElementAspect'\r\nimport {AfterInputAspect} from './AfterInputAspect'\r\n\r\n\r\n/// environment - common for many; configuration for concreate\r\nexport function BsMultiSelect(element, environment, pluginManager, configuration, onInit){\r\n    var {window} = environment;\r\n    environment.isIE11 = !!window.MSInputMethodContext && !!document.documentMode;\r\n\r\n    let { containerClass,\r\n          css, \r\n          getDisabled,\r\n          options, \r\n          getText\r\n        } = configuration;\r\n    \r\n    let disposeAspect = {dispose(){}};\r\n    let triggerAspect = TriggerAspect(element, environment.trigger);\r\n    let onChangeAspect = OnChangeAspect(triggerAspect, 'dashboardcode.multiselect:change');\r\n    let componentPropertiesAspect = ComponentPropertiesAspect(getDisabled??(() => false));\r\n    let optionsAspect = OptionsAspect(options); \r\n    let optionPropertiesAspect = OptionPropertiesAspect(getText);\r\n    let isChoiceSelectableAspect = IsChoiceSelectableAspect();\r\n    let createWrapAspect       = CreateWrapAspect();\r\n    let createChoiceBaseAspect = CreateChoiceBaseAspect(optionPropertiesAspect);\r\n    \r\n    let addPickAspect = AddPickAspect();\r\n    let removePickAspect = RemovePickAspect();\r\n    \r\n    let createElementAspect = CreateElementAspect(name => window.document.createElement(name), (element, html) => element.innerHTML = html );\r\n    \r\n    let wrapsCollection = ArrayFacade();\r\n    \r\n    let countableChoicesList = DoublyLinkedList(\r\n        (wrap)=>wrap.choice.itemPrev, \r\n        (warp, v)=>warp.choice.itemPrev=v, \r\n        (wrap)=>wrap.choice.itemNext, \r\n        (wrap, v)=>wrap.choice.itemNext=v\r\n    );\r\n    \r\n    let countableChoicesListInsertAspect = CountableChoicesListInsertAspect(countableChoicesList, wrapsCollection);\r\n\r\n    let choicesEnumerableAspect = ChoicesEnumerableAspect(countableChoicesList, wrap=>wrap.choice.itemNext)\r\n    \r\n    let filteredChoicesList = DoublyLinkedList(\r\n        (wrap)=>wrap.choice.filteredPrev, \r\n        (wrap, v)=>wrap.choice.filteredPrev=v, \r\n        (wrap)=>wrap.choice.filteredNext, \r\n        (wrap, v)=>wrap.choice.filteredNext=v\r\n    );\r\n    \r\n    let emptyNavigateManager = NavigateManager(\r\n        countableChoicesList,\r\n        (wrap)=>wrap.choice.itemPrev,\r\n        (wrap)=>wrap.choice.itemNext \r\n        \r\n    ); \r\n    let filteredNavigateManager = NavigateManager(\r\n        filteredChoicesList, \r\n        (wrap)=>wrap.choice.filteredPrev,\r\n        (wrap)=>wrap.choice.filteredNext ); \r\n\r\n    let filterPredicateAspect = FilterPredicateAspect()\r\n\r\n    let filterManagerAspect = FilterManagerAspect(\r\n        emptyNavigateManager,\r\n        filteredNavigateManager,\r\n        \r\n        filteredChoicesList, \r\n        choicesEnumerableAspect,\r\n        filterPredicateAspect\r\n    );\r\n\r\n    let hoveredChoiceAspect = HoveredChoiceAspect()\r\n    let navigateAspect = NavigateAspect(hoveredChoiceAspect, \r\n        (down, hoveredChoice)=>filterManagerAspect.getNavigateManager().navigate(down, hoveredChoice));\r\n    let picksList = List();\r\n    let wraps = Wraps(\r\n        wrapsCollection,\r\n        ()=>countableChoicesList.reset(), \r\n        (w)=>countableChoicesList.remove(w),\r\n        (w, key)=>countableChoicesListInsertAspect.countableChoicesListInsert(w, key));\r\n\r\n    let picksDomFactory   = PicksDomFactory  (css, createElementAspect);\r\n    let filterDomFactory  = FilterDomFactory (css, createElementAspect);\r\n    let choicesDomFactory = ChoicesDomFactory(css, createElementAspect);\r\n\r\n    let pickButtonAspect  = PickButtonAspect(configuration.pickButtonHTML);\r\n    let pickDomFactory    = PickDomFactory   (css, createElementAspect, optionPropertiesAspect, pickButtonAspect);\r\n    let choiceDomFactory  = ChoiceDomFactory (css, createElementAspect, optionPropertiesAspect);\r\n    \r\n    pluginManager.plugStaticDomFactories(\r\n        {\r\n            environment, configuration, disposeAspect, \r\n            \r\n            triggerAspect, onChangeAspect, componentPropertiesAspect, \r\n            countableChoicesList, countableChoicesListInsertAspect, optionPropertiesAspect, createElementAspect,\r\n            wrapsCollection, choicesEnumerableAspect, filteredChoicesList, \r\n            filterPredicateAspect, isChoiceSelectableAspect,  \r\n    \r\n            hoveredChoiceAspect, navigateAspect, \r\n    \r\n            choicesDomFactory, filterDomFactory, picksDomFactory, \r\n            pickDomFactory, choiceDomFactory, \r\n    \r\n            filterManagerAspect,\r\n    \r\n            optionsAspect, createWrapAspect, createChoiceBaseAspect, \r\n            picksList, wraps, addPickAspect, removePickAspect\r\n        }\r\n    );\r\n\r\n\r\n    let staticDomFactory  = StaticDomFactory(createElementAspect);\r\n\r\n    pluginManager.plugStaticDom(\r\n        {staticDomFactory}\r\n    ); // apply cssPatch to css, apply selectElement support;  \r\n\r\n    let {createStaticDom} = staticDomFactory.create(choicesDomFactory, filterDomFactory, picksDomFactory); // overrided in SelectElementPlugin\r\n\r\n    let {staticDom, filterDom, picksDom, staticManager, choicesDom} = createStaticDom(element, containerClass);\r\n\r\n    // after this we can use staticDom (means generated DOM elements) in plugin construtctor, what simplifies parameters passing a lot   \r\n\r\n\r\n    let specialPicksEventsAspect = SpecialPicksEventsAspect();\r\n\r\n    let choicesVisibilityAspect = ChoicesVisibilityAspect(choicesDom.choicesElement);\r\n    let resetFilterListAspect = ResetFilterListAspect(filterDom, filterManagerAspect);\r\n    let resetFilterAspect =  ResetFilterAspect(filterDom, resetFilterListAspect);\r\n\r\n    let focusInAspect = FocusInAspect(picksDom);\r\n    \r\n    let buildPickAspect = BuildPickAspect(picksDom, pickDomFactory);\r\n    \r\n    let producePickAspect = ProducePickAspect(picksList, removePickAspect, buildPickAspect);\r\n    let createPickHandlersAspect = CreatePickHandlersAspect(producePickAspect);\r\n    \r\n    let optionToggleAspect  = OptionToggleAspect(createPickHandlersAspect, addPickAspect);\r\n    let fullMatchAspect = FullMatchAspect(createPickHandlersAspect, addPickAspect);\r\n    let inputAspect = InputAspect(filterDom, filterManagerAspect, fullMatchAspect);    \r\n    let choiceClickAspect = ChoiceClickAspect(optionToggleAspect, filterDom);\r\n    \r\n    let buildChoiceAspect = BuildChoiceAspect(choicesDom, choiceDomFactory, choiceClickAspect);\r\n    \r\n    let buildAndAttachChoiceAspect =  BuildAndAttachChoiceAspect(buildChoiceAspect);\r\n    let resetLayoutAspect = ResetLayoutAspect(() => resetFilterAspect.resetFilter());\r\n\r\n    let optionAttachAspect = OptionAttachAspect(createWrapAspect, createChoiceBaseAspect, buildAndAttachChoiceAspect, wraps);\r\n    let optionsLoopAspect = OptionsLoopAspect(optionsAspect, optionAttachAspect);\r\n    let updateDataAspect = UpdateDataAspect(choicesDom, wraps, picksList, optionsLoopAspect, resetLayoutAspect);\r\n    let updateAspect = UpdateAspect(updateDataAspect);\r\n\r\n    let loadAspect = LoadAspect(optionsLoopAspect);\r\n\r\n    let picksElementAspect = PicksElementAspect(picksDom.picksElement);\r\n    let afterInputAspect = AfterInputAspect(filterManagerAspect, navigateAspect, choicesVisibilityAspect, hoveredChoiceAspect);\r\n\r\n    let multiSelectInlineLayoutAspect =  MultiSelectInlineLayoutAspect(\r\n        environment, filterDom, choicesDom, \r\n        choicesVisibilityAspect, \r\n        hoveredChoiceAspect, navigateAspect, filterManagerAspect,\r\n        focusInAspect, optionToggleAspect,\r\n        createPickHandlersAspect,\r\n        picksList,\r\n        inputAspect, specialPicksEventsAspect,  buildChoiceAspect, \r\n        resetLayoutAspect, \r\n        picksElementAspect,\r\n        afterInputAspect,\r\n        disposeAspect\r\n    );\r\n    \r\n    pluginManager.layout(\r\n        {\r\n            staticDom, picksDom, choicesDom, filterDom, resetLayoutAspect, \r\n            choicesVisibilityAspect, staticManager, buildChoiceAspect, optionToggleAspect,  choiceClickAspect, \r\n            buildAndAttachChoiceAspect, optionsLoopAspect, optionAttachAspect,\r\n            buildPickAspect, producePickAspect, createPickHandlersAspect, inputAspect, resetFilterListAspect, resetFilterAspect, \r\n            specialPicksEventsAspect,\r\n            resetLayoutAspect, focusInAspect, \r\n            loadAspect, updateDataAspect, updateAspect, \r\n            fullMatchAspect,\r\n            picksElementAspect, afterInputAspect,\r\n            multiSelectInlineLayoutAspect }\r\n    );\r\n    multiSelectInlineLayoutAspect.init();\r\n    pluginManager.attach();\r\n\r\n    let api = {component: \"BsMultiSelect.api\"} // key to use in memory leak analyzes\r\n    pluginManager.buildApi(api);\r\n\r\n    // after this we can pass aspects methods call without wrapping - there should be no more overridings. TODO freeze aspects?\r\n    api.dispose = composeSync(\r\n        resetLayoutAspect.resetLayout,\r\n        ()=>{disposeAspect.dispose()},\r\n        pluginManager.dispose, \r\n        ()=>{picksList.forEach(pick=>pick.dispose());},\r\n        wraps.dispose,\r\n        staticManager.dispose,  picksDom.dispose, filterDom.dispose );\r\n    \r\n    api.updateData = () => { \r\n        updateDataAspect.updateData();\r\n    };\r\n    api.update = () => {\r\n        updateAspect.update()\r\n    }\r\n \r\n    \r\n    // TODO api.updateOption = (key) => {/* all updates: selected, disabled, hidden, text */}\r\n\r\n    onInit?.(api, pluginManager.aspects);\r\n    picksDom.pickFilterElement.appendChild(filterDom.filterInputElement);\r\n    picksDom.picksElement.appendChild(picksDom.pickFilterElement); \r\n    staticManager.appendToContainer();\r\n    loadAspect.load();\r\n    return api;\r\n}\r\n","export function CreateElementAspect(createElement, createElementFromHtml){\r\n    return {\r\n        createElement,\r\n        createElementFromHtml\r\n    }\r\n}","export function HoveredChoiceAspect(){\r\n    let hoveredChoice=null;\r\n    return {\r\n        getHoveredChoice: () => hoveredChoice,\r\n        setHoveredChoice: (wrap) => {hoveredChoice = wrap},\r\n        resetHoveredChoice() {\r\n            if (hoveredChoice) {\r\n                hoveredChoice.choice.setHoverIn(false)\r\n                hoveredChoice = null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function NavigateAspect(hoveredChoiceAspect, navigate){\r\n    return {\r\n        hoverIn(wrap){\r\n            hoveredChoiceAspect.resetHoveredChoice(); \r\n            hoveredChoiceAspect.setHoveredChoice(wrap);\r\n            wrap.choice.setHoverIn(true);\r\n        },\r\n        navigate: (down) => navigate(down, hoveredChoiceAspect.getHoveredChoice()), \r\n    }\r\n}","export function PickButtonAspect(buttonHTML){\r\n    return {\r\n        getButtonHTML : () => buttonHTML\r\n    }\r\n}","export function TriggerAspect(element, trigger) {\r\n    return {\r\n        trigger: (eventName) => {\r\n            trigger(element, eventName)\r\n        }\r\n    }\r\n}\r\n\r\nexport function OnChangeAspect(triggerAspect, name) {\r\n    return {\r\n        onChange(){\r\n            triggerAspect.trigger(name)\r\n        }\r\n    }\r\n}\r\n\r\nexport function ComponentPropertiesAspect(getDisabled) {\r\n    return {\r\n        getDisabled\r\n    }\r\n}\r\n\r\n","export function OptionsAspect(options){\r\n    return {\r\n        getOptions : () => options\r\n    }\r\n}\r\n\r\nexport function OptionPropertiesAspect(getText){\r\n    if (!getText){\r\n        getText = (option) => option.text;\r\n    }\r\n    return {\r\n        getText\r\n    }\r\n}\r\n","import {composeSync} from './ToolsJs';\r\n\r\nexport function IsChoiceSelectableAspect(){ // TODO rename to IsSelectableByUserAspect ?\r\n    return {\r\n        isSelectable: (wrap)=>true \r\n    }\r\n}\r\n\r\n// todo: remove?\r\nexport function ChoiceClickAspect(optionToggleAspect, filterDom){\r\n    return {\r\n        choiceClick: (wrap) => {\r\n            optionToggleAspect.toggle(wrap);\r\n            filterDom.setFocus();\r\n        }\r\n    }\r\n}\r\n\r\n// // fullMatchAspect trySetWrapSelected(fullMatchWrap.option, composeUpdateSelected(fullMatchWrap, true), true);\r\n\r\nexport function OptionToggleAspect(createPickHandlersAspect, addPickAspect /*, setOptionSelectedAspect*/){\r\n    return {\r\n        toggle: (wrap) => {\r\n            let pickHandlers = createPickHandlersAspect.createPickHandlers(wrap);\r\n            addPickAspect.addPick(wrap, pickHandlers);\r\n            return true; // TODO: process setOptionSelectedAspect\r\n        }\r\n    }\r\n}\r\n\r\nexport function AddPickAspect(){\r\n    return {\r\n        addPick(wrap, pickHandlers){\r\n            return pickHandlers.producePick();\r\n        }\r\n    }\r\n}\r\n\r\nexport function FullMatchAspect(createPickHandlersAspect, addPickAspect){\r\n    return {\r\n        fullMatch(wrap){\r\n            let pickHandlers = createPickHandlersAspect.createPickHandlers(wrap);\r\n            addPickAspect.addPick(wrap, pickHandlers);\r\n            return true; // TODO: process setOptionSelectedAspect\r\n        }\r\n    }\r\n}\r\n\r\nexport function RemovePickAspect(){\r\n    return {\r\n        removePick(wrap, pick){\r\n            pick.dispose(); // overrided in SelectedOptionPlugin with trySetWrapSelected(wrap, false);\r\n        }\r\n    }\r\n}\r\n\r\nexport function ProducePickAspect(picksList, removePickAspect, buildPickAspect){\r\n    return {\r\n        producePick(wrap, pickHandlers){\r\n            let pick = buildPickAspect.buildPick(wrap, (event)=>pickHandlers.removeOnButton(event));\r\n                \r\n            let fixSelectedFalse = () => removePickAspect.removePick(wrap, pick)\r\n\r\n            pickHandlers.removeOnButton = fixSelectedFalse;\r\n            \r\n            pick.pickElementAttach();\r\n            let {remove: removeFromPicksList} = picksList.add(pick);\r\n            pick.setSelectedFalse = fixSelectedFalse;\r\n            pick.wrap = wrap; \r\n            pick.dispose = composeSync(\r\n                removeFromPicksList,\r\n                ()=>{\r\n                    pick.setSelectedFalse=null;\r\n                    pick.wrap = null;\r\n                }, \r\n                pick.dispose);\r\n            pickHandlers.removeAndDispose = () => pick.dispose();\r\n            return pick;\r\n        }\r\n    }\r\n}\r\n\r\n// redefined in MultiSelectInlineLayout to redefine handlers removeOnButton\r\n// redefined in SelectedOptionPlugin to compose wrap.updateSelected\r\nexport function CreatePickHandlersAspect(producePickAspect){\r\n    return{\r\n        createPickHandlers(wrap){\r\n            let pickHandlers = { \r\n                producePick: null,  // not redefined directly, but redefined in addPickAspect\r\n                removeAndDispose: null,  // not redefined, \r\n                removeOnButton: null // redefined in MultiSelectInlineLayout\r\n            }\r\n            \r\n            pickHandlers.producePick = () => producePickAspect.producePick(wrap, pickHandlers);\r\n            return pickHandlers;\r\n        }\r\n    }\r\n}\r\n\r\nexport function CreateChoiceBaseAspect(optionPropertiesAspect){\r\n    return {\r\n        createChoiceBase(option){\r\n            return {\r\n                    \r\n                //updateDisabled:null,  \r\n                //updateHidden:null,\r\n                \r\n                // navigation and filter support\r\n                filteredPrev: null, \r\n                filteredNext: null, \r\n                searchText: optionPropertiesAspect.getText(option).toLowerCase().trim(), // TODO make an index abstraction\r\n                \r\n                // internal state handlers, so they do not have \"update semantics\"\r\n                isHoverIn: false,\r\n                isFilteredIn: false,\r\n                \r\n                setVisible: null,\r\n                setHoverIn: null,\r\n                \r\n                // TODO: is it a really sense to have them there?\r\n                isChoiceElementAttached: false,\r\n                choiceElement: null,\r\n                choiceDom:null,\r\n                choiceElementAttach: null,\r\n                \r\n                itemPrev: null,\r\n                itemNext: null,\r\n                \r\n                remove: null,\r\n                \r\n                dispose: null\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function CreateWrapAspect(){\r\n    return {\r\n        createWrap(option){\r\n            return {\r\n                option: option\r\n            }\r\n        }\r\n    }\r\n}","export function CountableChoicesListInsertAspect(countableChoicesList, wrapsCollection){\r\n    return {\r\n        countableChoicesListInsert(wrap, key){\r\n            let choiceNext = wrapsCollection.getNext(key);\r\n            countableChoicesList.add(wrap, choiceNext)\r\n        }\r\n    }\r\n}","export function ChoicesEnumerableAspect(countableChoicesList, getNext){\r\n    return {\r\n        forEach(f){\r\n            let wrap =  countableChoicesList.getHead(); \r\n            while(wrap){\r\n                f(wrap);\r\n                wrap = getNext(wrap);\r\n            }\r\n        }\r\n    }\r\n}","import {addStyling, toggleStyling} from './ToolsStyling';\r\n\r\nexport function PicksDomFactory(css, createElementAspect){\r\n    return {\r\n        create(picksElement, isDisposablePicksElement){\r\n            var pickFilterElement  = createElementAspect.createElement('LI');\r\n    \r\n            addStyling(picksElement,      css.picks);\r\n            addStyling(pickFilterElement, css.pickFilter);\r\n        \r\n            let disableToggleStyling = toggleStyling(picksElement, css.picks_disabled);\r\n            let focusToggleStyling   = toggleStyling(picksElement, css.picks_focus);\r\n            let isFocusIn = false;\r\n        \r\n            return {\r\n                picksElement,\r\n                pickFilterElement,\r\n\r\n                createPickElement(){\r\n                    var pickElement = createElementAspect.createElement('LI');\r\n                    addStyling(pickElement, css.pick);\r\n                    return {\r\n                        pickElement, \r\n                        attach: (beforeElement) => picksElement.insertBefore(pickElement, beforeElement??pickFilterElement),\r\n                        detach: () => picksElement.removeChild(pickElement)\r\n                    };\r\n                },\r\n                disable(isComponentDisabled){\r\n                    disableToggleStyling(isComponentDisabled)\r\n                },\r\n                toggleFocusStyling(){\r\n                    focusToggleStyling(isFocusIn)\r\n                },\r\n                getIsFocusIn(){\r\n                    return isFocusIn;\r\n                },\r\n                setIsFocusIn(newIsFocusIn){\r\n                    isFocusIn = newIsFocusIn\r\n                }, \r\n                dispose(){\r\n                    if (!isDisposablePicksElement){\r\n                        disableToggleStyling(false)\r\n                        focusToggleStyling(false)\r\n\r\n                        if (pickFilterElement.parentNode)\r\n                            pickFilterElement.parentNode.removeChild(pickFilterElement)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function PicksDomFactoryPlugCss(css){\r\n    css.picks = 'form-control';\r\n    css.pickFilter = '';\r\n    css.picks_disabled = 'disabled';\r\n    css.picks_focus = 'focus';\r\n    css.pick = 'badge';\r\n}\r\n\r\nexport function PicksDomFactoryPlugCssPatch(cssPatch){\r\n    cssPatch.picks = {listStyleType:'none', display:'flex', flexWrap:'wrap',  height: 'auto', marginBottom: '0',cursor: 'text'},\r\n    cssPatch.picks_disabled =  {backgroundColor: '#e9ecef'};\r\n    cssPatch.picks_focus = {borderColor: '#80bdff', boxShadow: '0 0 0 0.2rem rgba(0, 123, 255, 0.25)'};\r\n}\r\n\r\nexport function PicksDomFactoryPlugCssPatchBs4(cssPatch){\r\n    cssPatch.pick = {paddingLeft: '0', paddingRight: '.5rem', paddingInlineStart:'0', paddingInlineEnd:'0.5rem', lineHeight: '1.5em'};\r\n}\r\n\r\nexport function PicksDomFactoryPlugCssPatchBs5(cssPatch){\r\n    cssPatch.pick = {paddingLeft: '0', paddingRight: '.5rem', paddingInlineStart:'0', paddingInlineEnd:'0.5rem', color:'var(--bs-dark)'};\r\n}","import {addStyling} from './ToolsStyling';\r\nimport {EventBinder} from './ToolsDom';\r\n\r\nexport function FilterDomFactory(css, createElementAspect){\r\n    return {\r\n        create(isDisposablePicksElement){\r\n            var filterInputElement = createElementAspect.createElement('INPUT');\r\n            addStyling(filterInputElement, css.filterInput);\r\n        \r\n            filterInputElement.setAttribute(\"type\",\"search\");\r\n            filterInputElement.setAttribute(\"autocomplete\",\"off\");\r\n            var eventBinder = EventBinder();\r\n\r\n            return {\r\n                filterInputElement,\r\n                isEmpty(){return filterInputElement.value ? false : true},\r\n                setEmpty(){\r\n                    filterInputElement.value ='';\r\n                },\r\n                getValue(){\r\n                    return filterInputElement.value;\r\n                },\r\n                setFocus(){\r\n                    filterInputElement.focus();\r\n                },\r\n                setWidth(text){\r\n                    filterInputElement.style.width = text.length * 1.3 + 2 + \"ch\"\r\n                },\r\n                // TODO: check why I need this comparision? \r\n                setFocusIfNotTarget(target){\r\n                    if (target != filterInputElement)\r\n                        filterInputElement.focus();\r\n                },\r\n                onInput(onFilterInputInput){\r\n                    eventBinder.bind(filterInputElement,'input',    onFilterInputInput);\r\n                },\r\n                onFocusIn(onFocusIn){\r\n                    eventBinder.bind(filterInputElement,'focusin',  onFocusIn);\r\n                },\r\n                onFocusOut(onFocusOut){\r\n                    eventBinder.bind(filterInputElement,'focusout', onFocusOut);\r\n                },\r\n                onKeyDown(onfilterInputKeyDown){\r\n                    eventBinder.bind(filterInputElement,'keydown',  onfilterInputKeyDown);    \r\n                },\r\n                onKeyUp(onFilterInputKeyUp){\r\n                    eventBinder.bind(filterInputElement,'keyup',    onFilterInputKeyUp);\r\n                },\r\n                dispose(){\r\n                    eventBinder.unbind();\r\n                    if (!isDisposablePicksElement){\r\n                        if (filterInputElement.parentNode)\r\n                            filterInputElement.parentNode.removeChild(filterInputElement)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function FilterDomFactoryPlugCss(css){\r\n    css.filterInput = '';\r\n}\r\n\r\nexport function FilterDomFactoryPlugCssPatch(cssPatch){\r\n    cssPatch.filterInput = {\r\n        border:'0px', height: 'auto', boxShadow:'none', \r\n        padding:'0', margin:'0', \r\n        outline:'none', backgroundColor:'transparent',\r\n        backgroundImage: 'none' // otherwise BS .was-validated set its image\r\n    };\r\n}\r\n","import {addStyling} from './ToolsStyling';\r\n\r\nexport function ChoicesDomFactory(css, createElementAspect) {\r\n    return {\r\n        create(){\r\n            var choicesElement = createElementAspect.createElement('DIV');\r\n            var choicesListElement = createElementAspect.createElement('UL');\r\n            \r\n            choicesElement.appendChild(choicesListElement);\r\n            choicesElement.style.display = 'none';\r\n\r\n            addStyling(choicesElement, css.choices);\r\n            addStyling(choicesListElement, css.choicesList);\r\n            \r\n            return {\r\n                choicesElement,\r\n                choicesListElement,\r\n                createChoiceElement(){\r\n                    var choiceElement = createElementAspect.createElement('LI');\r\n                    addStyling(choiceElement, css.choice);\r\n                    return {\r\n                        choiceElement,\r\n                        setVisible: (isVisible) => choiceElement.style.display = isVisible ? 'block': 'none',\r\n                        attach: (beforeElement) => choicesListElement.insertBefore(choiceElement, beforeElement),\r\n                        detach: () => choicesListElement.removeChild(choiceElement)\r\n                    };\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function ChoicesDomFactoryPlugCss(css){\r\n    css.choices = 'dropdown-menu';\r\n    css.choicesList = '';\r\n    css.choice = '';\r\n}\r\n\r\nexport function ChoicesDomFactoryPlugCssPatch(cssPatch){\r\n    cssPatch.choicesList = {listStyleType:'none', paddingLeft:'0', paddingRight:'0', marginBottom:'0'};\r\n    cssPatch.choice = {classes:'px-md-2 px-1', styles:{cursor:'pointer'}};\r\n}\r\n\r\n","import  {EventBinder} from './ToolsDom';\r\nimport  {addStyling, toggleStyling} from './ToolsStyling';\r\n\r\n\r\nexport function PickDomFactoryPlugCss(css){\r\n    css.pickContent = '';\r\n    css.pickContent_disabled = 'disabled';\r\n    css.pickButton = 'close';\r\n}\r\n\r\nexport function PickDomFactoryPlugCssBs4(css){\r\n    css.pickButton = 'close';\r\n}\r\n\r\nexport function PickDomFactoryPlugCssBs5(css){\r\n    css.pickButton = 'btn-close';\r\n}\r\n\r\nexport function PickDomFactoryPlugCssPatch(cssPatch){\r\n    cssPatch.pickContent_disabled = {opacity: '.65'};\r\n}\r\n\r\nexport function PickDomFactoryPlugCssPatchBs4(cssPatch){\r\n    cssPatch.pickButton = {float : \"none\", fontSize:'1.5em', lineHeight: '.9em', };\r\n}\r\n\r\n\r\nexport function PickDomFactoryPlugCssPatchBs5(cssPatch){\r\n    cssPatch.pickButton = {float : \"none\", fontSize:'0.8em', verticalAlign: \"text-top\"};\r\n}\r\n\r\nexport function PickDomFactory(css, createElementAspect, optionPropertiesAspect, pickButtonAspect){\r\n    return { \r\n        create(pickElement, wrap, remove){\r\n            let buttonHTML = pickButtonAspect.getButtonHTML();\r\n            createElementAspect.createElementFromHtml(pickElement, '<span></span>'+buttonHTML);\r\n            let pickContentElement = pickElement.querySelector('SPAN');\r\n            let pickButtonElement  = pickElement.querySelector('BUTTON');\r\n            let eventBinder = EventBinder();\r\n            eventBinder.bind(pickButtonElement, \"click\", remove);\r\n            \r\n            addStyling(pickContentElement, css.pickContent);\r\n            addStyling(pickButtonElement, css.pickButton);\r\n            let disableToggle = toggleStyling(pickContentElement, css.pickContent_disabled);\r\n\r\n            function updateData(){\r\n                pickContentElement.textContent = optionPropertiesAspect.getText(wrap.option); \r\n            }\r\n            function updateDisabled(){\r\n                disableToggle(wrap.isOptionDisabled)\r\n            }\r\n\r\n            return {\r\n                pickDom:{\r\n                    pickContentElement,\r\n                    pickButtonElement,\r\n                },\r\n                pickDomManagerHandlers:{\r\n                    updateData,\r\n                    updateDisabled,\r\n                },\r\n                dispose(){\r\n                    eventBinder.unbind();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import {EventBinder} from './ToolsDom';\r\nimport {addStyling, toggleStyling} from './ToolsStyling';\r\n\r\nexport function ChoiceDomFactory(css, createElementAspect,  optionPropertiesAspect){\r\n    var updateDataInternal = function(wrap, element){\r\n        element.textContent = optionPropertiesAspect.getText(wrap.option);\r\n    }\r\n    //TODO move check which aspects availbale like wrap.hasOwnProperty(\"isOptionSelected\") to there\r\n    return {\r\n        create(choiceElement, wrap, toggle){\r\n            let choiceDom = null;\r\n            let choiceDomManagerHandlers = null;\r\n            let eventBinder = EventBinder();\r\n                eventBinder.bind(choiceElement, \"click\",  toggle);\r\n            \r\n            if (wrap.hasOwnProperty(\"isOptionSelected\")){\r\n                createElementAspect.createElementFromHtml(choiceElement, '<div><input formnovalidate type=\"checkbox\"><label></label></div>');\r\n                \r\n                let choiceContentElement = choiceElement.querySelector('DIV');\r\n                let choiceCheckBoxElement = choiceContentElement.querySelector('INPUT');\r\n                let choiceLabelElement = choiceContentElement.querySelector('LABEL');\r\n                \r\n                addStyling(choiceContentElement,  css.choiceContent); \r\n                addStyling(choiceCheckBoxElement, css.choiceCheckBox); \r\n                addStyling(choiceLabelElement,    css.choiceLabel); \r\n\r\n                choiceDom = {\r\n                    choiceElement,\r\n                    choiceContentElement,\r\n                    choiceCheckBoxElement,\r\n                    choiceLabelElement\r\n                };\r\n                \r\n                let choiceSelectedToggle = toggleStyling(choiceElement, css.choice_selected);\r\n                let updateSelected = function(){ \r\n                    choiceSelectedToggle(wrap.isOptionSelected);\r\n                    choiceCheckBoxElement.checked = wrap.isOptionSelected;\r\n                    if (wrap.isOptionDisabled || wrap.choice.isHoverIn){\r\n                        choiceHoverToggle(wrap.choice.isHoverIn, true);\r\n                    }\r\n                }\r\n\r\n                let choiceDisabledToggle = toggleStyling(choiceElement, css.choice_disabled);\r\n                let choiceCheckBoxDisabledToggle = toggleStyling(choiceCheckBoxElement, css.choiceCheckBox_disabled);\r\n                let choiceLabelDisabledToggle = toggleStyling(choiceLabelElement, css.choiceLabel_disabled);\r\n                let choiceCursorDisabledToggle = toggleStyling(choiceElement, {classes:[], styles:{cursor:\"default\"}}); \r\n                let updateDisabled = function(){\r\n                    choiceDisabledToggle(wrap.isOptionDisabled);\r\n                    choiceCheckBoxDisabledToggle(wrap.isOptionDisabled);\r\n                    choiceLabelDisabledToggle(wrap.isOptionDisabled);\r\n    \r\n                    // do not desable checkBox if option is selected! there should be possibility to unselect \"disabled\"\r\n                    let isCheckBoxDisabled = wrap.isOptionDisabled && !wrap.isOptionSelected;\r\n                    choiceCheckBoxElement.disabled = isCheckBoxDisabled;\r\n                    choiceCursorDisabledToggle(isCheckBoxDisabled);\r\n                }\r\n\r\n                let choiceHoverToggle    = toggleStyling(choiceElement, ()=>{\r\n                    if (css.choice_disabled_hover &&  wrap.isOptionDisabled===true && wrap.isOptionSelected===false)\r\n                        return css.choice_disabled_hover;\r\n                    else\r\n                        return css.choice_hover;\r\n                });\r\n                let updateHoverIn = function(){\r\n                    choiceHoverToggle(wrap.choice.isHoverIn);\r\n                }\r\n\r\n                choiceDomManagerHandlers = {\r\n                    updateData: ()=>updateDataInternal(wrap, choiceLabelElement),\r\n                    updateHoverIn,\r\n                    updateDisabled,\r\n                    updateSelected, \r\n                }\r\n            }else{\r\n                let choiceHoverToggle    = toggleStyling(choiceElement, ()=>\r\n                    (wrap.isOptionDisabled && css.choice_disabled_hover)?css.choice_disabled_hover:css.choice_hover);\r\n                \r\n                let updateHoverIn = function(){\r\n                    choiceHoverToggle(wrap.choice.isHoverIn);\r\n                }\r\n                choiceElement.innerHTML = '<span></span>';\r\n                let choiceContentElement = choiceElement.querySelector('SPAN');\r\n                choiceDom = {\r\n                    choiceElement,\r\n                    choiceContentElement,\r\n                };\r\n                choiceDomManagerHandlers = {\r\n                    updateData: ()=>updateDataInternal(wrap, choiceContentElement),\r\n                    updateHoverIn\r\n                }\r\n            }\r\n            \r\n            return {\r\n                choiceDom,\r\n                choiceDomManagerHandlers, \r\n                dispose(){\r\n                    eventBinder.unbind();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function ChoiceDomFactoryPlugCss(css){\r\n    css.choiceCheckBox_disabled = 'disabled'; //  not bs, in scss as 'ul.form-control li .custom-control-input.disabled ~ .custom-control-label'\r\n    css.choiceLabel_disabled = '';\r\n    css.choice_disabled_hover  = '';\r\n    css.choice_hover = 'hover'; //  not bs, in scss as 'ul.dropdown-menu li.hover'\r\n}\r\n\r\nexport function ChoiceDomFactoryPlugCssBs4(css){\r\n    css.choiceCheckBox = 'custom-control-input';\r\n    css.choiceContent = 'custom-control custom-checkbox d-flex';\r\n    css.choiceLabel = 'custom-control-label justify-content-start';\r\n    css.choice_selected = '';\r\n    css.choice_disabled = '';\r\n}\r\n\r\nexport function ChoiceDomFactoryPlugCssBs5(css){\r\n    css.choiceCheckBox = 'form-check-input'; // bs\r\n    css.choiceContent = 'form-check'; // bs d-flex required for rtl to align items\r\n    css.choiceLabel = 'form-check-label';\r\n    css.choice_selected = 'selected'; //  not bs,\r\n    css.choice_disabled = 'disabled'; //  not bs,\r\n}\r\n\r\nexport function ChoiceDomFactoryPlugCssPatch(cssPatch){\r\n    cssPatch.choiceCheckBox = {color: 'inherit', cursor:'inherit'};\r\n    cssPatch.choiceContent = {justifyContent: 'flex-start', cursor:'inherit'}; // BS problem: without this on inline form menu items justified center\r\n    cssPatch.choiceLabel = {color: 'inherit', cursor:'inherit'}; // otherwise BS .was-validated set its color\r\n    cssPatch.choiceLabel_disabled = {opacity: '.65'};  // more flexible than {color: '#6c757d'}; note: avoid opacity on pickElement's border; TODO write to BS4 \r\n    cssPatch.choice_disabled_hover  = 'bg-light';\r\n    cssPatch.choice_hover = 'text-primary bg-light';\r\n}\r\n\r\n","import {findDirectChildByTagName, closestByClassName} from './ToolsDom';\r\n\r\nexport function StaticDomFactory(createElementAspect){\r\n    return {\r\n        create(choicesDomFactory, filterDomFactory, picksDomFactory){\r\n            let choicesDom = choicesDomFactory.create();\r\n            return {\r\n                createStaticDom(element, containerClass){\r\n                    function showError(message){\r\n                        element.style.backgroundColor = 'red';\r\n                        element.style.color = 'white';\r\n                        throw new Error(message);\r\n                    }\r\n                   \r\n                    let containerElement, picksElement;\r\n                    let removableContainerClass= false;\r\n                    if (element.tagName == 'DIV') {\r\n                        containerElement = element;\r\n                        if (!containerElement.classList.contains(containerClass)){\r\n                            containerElement.classList.add(containerClass);\r\n                            removableContainerClass = true;\r\n                        }\r\n                        picksElement = findDirectChildByTagName(containerElement, 'UL');\r\n                    }\r\n                    else if (element.tagName == 'UL') {\r\n                        picksElement = element;\r\n                        containerElement = closestByClassName(element, containerClass);\r\n                        if (!containerElement){\r\n                            showError('BsMultiSelect: defined on UL but precedentant DIV for container not found; class='+containerClass);\r\n                        }\r\n                    } \r\n                    else if (element.tagName==\"INPUT\"){\r\n                        showError('BsMultiSelect: INPUT element is not supported');\r\n                    }\r\n                    let isDisposablePicksElement=false;\r\n                    if (!picksElement) {\r\n                        picksElement = createElementAspect.createElement('UL');\r\n                        isDisposablePicksElement = true; \r\n                    }\r\n\r\n                    let filterDom = filterDomFactory.create(isDisposablePicksElement);\r\n                    let picksDom  = picksDomFactory.create(picksElement, isDisposablePicksElement);\r\n                \r\n                    return {\r\n                        choicesDom,\r\n                        filterDom,\r\n                        picksDom,\r\n                        staticDom: {\r\n                            initialElement:element,\r\n                            containerElement,\r\n                            picksElement,\r\n                            isDisposablePicksElement\r\n                        },\r\n                        staticManager: {\r\n                            appendToContainer(){ \r\n                                containerElement.appendChild(choicesDom.choicesElement); \r\n                                if (isDisposablePicksElement)\r\n                                    containerElement.appendChild(picksElement)\r\n                            },\r\n                            dispose(){ \r\n                                containerElement.removeChild(choicesDom.choicesElement); \r\n                                if (removableContainerClass)\r\n                                    containerElement.classList.remove(containerClass);\r\n                                if (isDisposablePicksElement)\r\n                                    containerElement.removeChild(picksElement)\r\n                            }\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","export function ChoicesVisibilityAspect(choicesElement) {\r\n\r\n    return {\r\n        isChoicesVisible(){ \r\n            return choicesElement.style.display != 'none'},\r\n        setChoicesVisible(visible){\r\n            choicesElement.style.display = visible ? 'block' : 'none';\r\n        },\r\n        updatePopupLocation(){\r\n\r\n        }\r\n    }\r\n}\r\n","import {EventBinder, containsAndSelf} from './ToolsDom';\r\n\r\nexport function PicksElementAspect(picksElement){\r\n    var componentDisabledEventBinder = EventBinder();\r\n    var skipoutAndResetMousedownEventBinder = EventBinder();\r\n    return {\r\n        containsAndSelf(element){\r\n            return containsAndSelf(picksElement, element);\r\n        },\r\n        onClickUnbind(){\r\n            componentDisabledEventBinder.unbind();\r\n        },\r\n        onClick(handler){\r\n            componentDisabledEventBinder.bind(picksElement, \"click\",  handler);\r\n        },\r\n        onMousedown(handler){\r\n            skipoutAndResetMousedownEventBinder.bind(picksElement, \"mousedown\",  handler);\r\n        },\r\n        unbind(){\r\n            skipoutAndResetMousedownEventBinder.unbind();\r\n            componentDisabledEventBinder.unbind();\r\n        }\r\n    }\r\n}","export function SpecialPicksEventsAspect(){\r\n    return {\r\n        backSpace(pick){ \r\n            pick.setSelectedFalse(); \r\n        }\r\n    }\r\n}","export function ResetFilterListAspect(filterDom, filterManagerAspect){\r\n    return {\r\n        forceResetFilter(){  // over in PlaceholderPlugin\r\n            filterDom.setEmpty();\r\n            filterManagerAspect.processEmptyInput(); // over in PlaceholderPlugin\r\n        }\r\n    }\r\n}\r\n\r\nexport function ResetFilterAspect(filterDom, resetFilterListAspect){\r\n    return {\r\n        resetFilter(){ // call in OptionsApiPlugin\r\n            if (!filterDom.isEmpty())  // call in Placeholder\r\n                resetFilterListAspect.forceResetFilter(); // over in Placeholder\r\n        }\r\n    }\r\n}\r\n\r\nexport function FocusInAspect(picksDom){\r\n    return {\r\n        setFocusIn(focus){ // call in OptionsApiPlugin\r\n            picksDom.setIsFocusIn(focus) // unique call, call BsAppearancePlugin\r\n            picksDom.toggleFocusStyling() // over BsAppearancePlugin\r\n        }\r\n    }\r\n}\r\n\r\n","export function BuildPickAspect(\r\n    picksDom, \r\n    pickDomFactory\r\n){\r\n    return {\r\n        buildPick(wrap, removeOnButton){\r\n            let {pickElement, attach, detach} = picksDom.createPickElement(); \r\n            let {dispose, pickDom, pickDomManagerHandlers} = pickDomFactory.create(pickElement, wrap, removeOnButton); \r\n            \r\n            pickDomManagerHandlers.updateData();\r\n            if (pickDomManagerHandlers.updateDisabled)\r\n                pickDomManagerHandlers.updateDisabled();\r\n            if (pickDomManagerHandlers.updateComponentDisabled)\r\n                pickDomManagerHandlers.updateComponentDisabled();\r\n            let pick = {\r\n                pickDom,\r\n                pickDomManagerHandlers,\r\n                pickElementAttach: attach,\r\n                dispose: () => { \r\n                    detach(); \r\n                    dispose(); \r\n                    pick.pickDomManagerHandlers = null;\r\n                    pick.pickDom = pickDom;\r\n                    pick.pickElementAttach = null;\r\n                    pick.dispose = null;\r\n                }\r\n            }\r\n            return pick;\r\n        }\r\n    }\r\n}","export function InputAspect(\r\n    filterDom,\r\n    filterManagerAspect,\r\n    fullMatchAspect\r\n    ){\r\n\r\n    return {\r\n        // overrided in SelectedOptionPlugin\r\n        processInput(){ \r\n            let filterInputValue = filterDom.getValue();\r\n            let text = filterInputValue.trim();\r\n            var isEmpty=false;\r\n            if (text == '')\r\n                isEmpty=true;\r\n            else\r\n            {\r\n                filterManagerAspect.setFilter(text.toLowerCase());\r\n            }\r\n            \r\n            if (!isEmpty)\r\n            {\r\n                if ( filterManagerAspect.getNavigateManager().getCount() == 1)\r\n                {\r\n                    // todo: move exact match to filterManager\r\n                    let fullMatchWrap =  filterManagerAspect.getNavigateManager().getHead();\r\n                    let text = filterManagerAspect.getFilter();\r\n                    if (fullMatchWrap.choice.searchText == text)\r\n                    {\r\n                        let success = fullMatchAspect.fullMatch(fullMatchWrap); \r\n                        if (success) {\r\n                            filterDom.setEmpty();\r\n                            isEmpty = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return {filterInputValue, isEmpty};\r\n        }\r\n    }\r\n}","export function BuildAndAttachChoiceAspect(\r\n    buildChoiceAspect,\r\n    ){\r\n    return {\r\n        buildAndAttachChoice(\r\n            wrap,\r\n            getNextElement \r\n            )\r\n        {\r\n            buildChoiceAspect.buildChoice(wrap);\r\n            wrap.choice.choiceElementAttach(getNextElement?.());\r\n        }\r\n    }\r\n}\r\n\r\nexport function BuildChoiceAspect(\r\n        choicesDom,\r\n        choiceDomFactory,\r\n        choiceClickAspect\r\n    ) {\r\n    return {\r\n        buildChoice(wrap) {\r\n            var {choiceElement, setVisible, attach, detach} = choicesDom.createChoiceElement();\r\n            wrap.choice.choiceElement = choiceElement;\r\n            wrap.choice.choiceElementAttach = attach;\r\n            wrap.choice.isChoiceElementAttached = true;\r\n            \r\n            let {dispose, choiceDom, choiceDomManagerHandlers} = choiceDomFactory.create(choiceElement, wrap, () => choiceClickAspect.choiceClick(wrap));\r\n            wrap.choice.choiceDom=choiceDom;\r\n            choiceDomManagerHandlers.updateData();\r\n            if (choiceDomManagerHandlers.updateSelected)  \r\n                choiceDomManagerHandlers.updateSelected();\r\n            if (choiceDomManagerHandlers.updateDisabled)  \r\n                choiceDomManagerHandlers.updateDisabled();\r\n            \r\n\r\n            wrap.choice.choiceDomManagerHandlers = choiceDomManagerHandlers;\r\n            \r\n            wrap.choice.remove = () => {\r\n                detach();\r\n            };\r\n            \r\n            wrap.choice.isFilteredIn = true;\r\n            \r\n            wrap.choice.setHoverIn = (v) => {\r\n                wrap.choice.isHoverIn =v ;\r\n                choiceDomManagerHandlers.updateHoverIn();\r\n            }\r\n        \r\n            wrap.choice.setVisible = (v) => {\r\n                wrap.choice.isFilteredIn = v;\r\n                setVisible(wrap.choice.isFilteredIn)\r\n            }\r\n            \r\n            wrap.choice.dispose = () => {\r\n                wrap.choice.choiceDomManagerHandlers = null;\r\n                dispose();\r\n    \r\n                wrap.choice.choiceElement = null;\r\n                wrap.choice.choiceDom = null;\r\n                wrap.choice.choiceElementAttach = null;\r\n                wrap.choice.isChoiceElementAttached = false;\r\n                wrap.choice.remove = null; \r\n        \r\n                // not real data manipulation but internal state\r\n                wrap.choice.setVisible = null; // TODO: refactor it there should be 3 types of not visibility: for hidden, for filtered out, for optgroup, for message item\r\n                wrap.choice.setHoverIn = null;\r\n        \r\n                wrap.choice.dispose = null;\r\n            }\r\n\r\n            wrap.dispose = () => {\r\n                wrap.choice.dispose();\r\n                wrap.dispose = null;\r\n            }\r\n        }\r\n    }\r\n}","export function ResetLayoutAspect(resetLayout){\r\n    return {\r\n        resetLayout\r\n    }\r\n}","export function OptionAttachAspect(createWrapAspect, createChoiceBaseAspect, buildAndAttachChoiceAspect, wraps){\r\n    return {\r\n        attach(option){\r\n            let wrap = createWrapAspect.createWrap(option);\r\n            wrap.choice = createChoiceBaseAspect.createChoiceBase(option);\r\n\r\n            // let optGroup = optGroupAspect.getOptionOptGroup(option);\r\n            // if (prevOptGroup != optGroup){\r\n            //     currentOptGroup = optGroup;\r\n            //     var optGroupWrap = optGroupBuildAspect.wrapAndAttachOptGroupItem(option);\r\n            // }\r\n            // wrap.optGroup = currentOptGroup;\r\n            \r\n            \r\n            wraps.push(wrap); // note: before attach because attach need it for navigation management\r\n            buildAndAttachChoiceAspect.buildAndAttachChoice(wrap);\r\n            //wraps.push(wrap);\r\n        }\r\n    }\r\n}\r\n\r\nexport function OptionsLoopAspect(optionsAspect, optionAttachAspect){ \r\n    return{\r\n        loop(){\r\n            let options = optionsAspect.getOptions();\r\n            for(let i = 0; i<options.length; i++) {\r\n                let option = options[i];\r\n                optionAttachAspect.attach(option);\r\n            } \r\n        }\r\n    }\r\n}","export function UpdateDataAspect(\r\n    choicesDom, wraps, picksList, optionsLoopAspect, resetLayoutAspect\r\n    ){\r\n    return {\r\n        updateData(){\r\n            // close drop down , remove filter\r\n            resetLayoutAspect.resetLayout();\r\n            choicesDom.choicesListElement.innerHTML = \"\"; // TODO: there should better \"optimization\"\r\n            wraps.clear();\r\n            picksList.forEach(pick=>pick.dispose());\r\n            picksList.reset();\r\n            optionsLoopAspect.loop();\r\n        }\r\n    }\r\n}\r\n\r\nexport function UpdateAspect(updateDataAspect){\r\n    return {\r\n        update(){\r\n            updateDataAspect.updateData();\r\n        }\r\n    }\r\n}","\r\nexport function LoadAspect(optionsLoopAspect){\r\n    return{\r\n        load(){  // redriven in AppearancePlugin, FormRestoreOnBackwardPlugin\r\n            optionsLoopAspect.loop();\r\n        }\r\n    }\r\n}","export function AfterInputAspect(filterManagerAspect, navigateAspect, choicesVisibilityAspect, hoveredChoiceAspect){\r\n    return {\r\n        visible(showChoices, visibleCount){\r\n            let panelIsVisble = choicesVisibilityAspect.isChoicesVisible();\r\n            if (!panelIsVisble) {\r\n                  showChoices(); \r\n            }\r\n            if (visibleCount == 1) {\r\n                navigateAspect.hoverIn(filterManagerAspect.getNavigateManager().getHead())\r\n            } else {\r\n                if (panelIsVisble)\r\n                    hoveredChoiceAspect.resetHoveredChoice();\r\n            }   \r\n        },\r\n        notVisible(hideChoices){\r\n            if (choicesVisibilityAspect.isChoicesVisible()){\r\n                hideChoices();\r\n            }\r\n        }\r\n    }\r\n}","import {extendIfUndefined} from './ToolsJs';\r\n\r\nexport function ComposePluginManagerFactory(plugins, defaults){\r\n    let buildAspectsList = [];\r\n\r\n    for(let i = 0; i<plugins.length; i++){\r\n        let buildAspects =  plugins[i].value(defaults);\r\n        if (buildAspects){\r\n            buildAspectsList.push({key:plugins[i].key, value:buildAspects});\r\n        }\r\n    }\r\n    \r\n    return (configuration, settings)=>{\r\n        let eventHandlers = [];\r\n        let aspects = {};\r\n        for(let i = 0; i<buildAspectsList.length; i++){\r\n            let events = buildAspectsList[i].value.buildAspects(aspects, configuration, settings)\r\n            if (events){\r\n                eventHandlers.push({key:buildAspectsList[i].key, value:events});\r\n            }\r\n        }\r\n        return PluginManager(aspects, eventHandlers);\r\n    };\r\n}\r\n\r\nexport function PluginManager(aspects, eventHandlers){\r\n    let instances = [];\r\n    let disposes = [];\r\n    \r\n    return {\r\n        aspects, // TODO: hide\r\n        buildApi(api){\r\n            for(let i = 0; i<instances.length; i++){\r\n                let dispose = instances[i].buildApi?.(api)\r\n                if (dispose)\r\n                    disposes.push(dispose);\r\n            }\r\n        },\r\n        dispose(){\r\n            for(let i = 0; i<disposes.length; i++){\r\n                disposes[i]()\r\n            }\r\n            disposes=null;\r\n            for(let i = 0; i<instances.length; i++){\r\n                instances[i].dispose?.()\r\n            }\r\n            instances=null;\r\n        },\r\n        plugStaticDomFactories(newAspects){\r\n            extendIfUndefined(aspects, newAspects)\r\n            for(let i = 0; i<eventHandlers.length; i++){\r\n                eventHandlers[i].value.plugStaticDomFactories?.(aspects);\r\n            }\r\n        },\r\n        plugStaticDom(newAspects){\r\n            extendIfUndefined(aspects, newAspects)\r\n            for(let i = 0; i<eventHandlers.length; i++){\r\n                eventHandlers[i].value.plugStaticDom?.(aspects);\r\n            }\r\n        },\r\n        layout(newAspects){\r\n            extendIfUndefined(aspects, newAspects)\r\n            if (eventHandlers){\r\n                // TODO: complete to full bus event system\r\n                for(let i = 0; i<eventHandlers.length; i++){\r\n                    let a = eventHandlers[i].value;\r\n                    if (a.plugStaticDomBus){\r\n                        if (eventHandlers.some(c => c.key===a.plugStaticDomBus.after))\r\n                            a.plugStaticDomBus.plugStaticDom?.(aspects);\r\n                    }\r\n                }\r\n        \r\n                for(let i = 0; i<eventHandlers.length; i++){\r\n                    let instance = eventHandlers[i].value.layout?.(aspects)\r\n                    if (instance)\r\n                        instances.push(instance);\r\n                    \r\n                }\r\n            \r\n            }\r\n        },\r\n        attach(){\r\n            if (eventHandlers)\r\n                for(let i = 0; i<eventHandlers.length; i++){\r\n                    eventHandlers[i].value.attach?.(aspects)\r\n                }\r\n        }\r\n    }\r\n}","const transformStyles = [\r\n    {old:'selectedPanelDisabledBackgroundColor', opt:'picks_disabled', style:\"backgroundColor\"},\r\n    {old:'selectedPanelFocusValidBoxShadow', opt:'picks_focus_valid', style:\"boxShadow\"},\r\n    {old:'selectedPanelFocusInvalidBoxShadow', opt:'picks_focus_invalid', style:\"boxShadow\"},\r\n    {old:'selectedPanelDefMinHeight', opt:'picks_def', style:\"minHeight\"},\r\n    {old:'selectedPanelLgMinHeight', opt:'picks_lg', style:\"minHeight\"},\r\n    {old:'selectedPanelSmMinHeight', opt:'picks_sm', style:\"minHeight\"},\r\n    {old:'selectedItemContentDisabledOpacity', opt:'choiceLabel_disabled', style:\"opacity\"}\r\n]\r\n\r\nconst transformClasses = [\r\n    {old:'dropDownMenuClass', opt:'choices'},\r\n    {old:'dropDownItemClass', opt:'choice'},\r\n    {old:'dropDownItemHoverClass', opt:'choice_hover'},\r\n    {old:'selectedPanelClass', opt:'picks'},\r\n    {old:'selectedItemClass', opt:'pick'},\r\n    {old:'removeSelectedItemButtonClass', opt:'pickButton'},\r\n    {old:'filterInputItemClass', opt:'pickFilter'},\r\n    {old:'filterInputClass', opt:'filterInput'},\r\n    {old:'selectedPanelFocusClass', opt:'picks_focus'},\r\n    {old:'selectedPanelDisabledClass', opt:'picks_disabled'},\r\n    {old:'selectedItemContentDisabledClass', opt:'pick_disabled'}\r\n]\r\n\r\nexport function adjustLegacySettings(settings){\r\n    if (!settings.css)\r\n        settings.css={}\r\n    var css =settings.css;\r\n\r\n    if (!settings.cssPatch)\r\n        settings.cssPatch={}\r\n    var cssPatch =settings.cssPatch;\r\n\r\n    if (settings.selectedPanelFocusBorderColor || settings.selectedPanelFocusBoxShadow){\r\n        console.log(\"DashboarCode.BsMultiSelect: selectedPanelFocusBorderColor and selectedPanelFocusBoxShadow are depricated, use - cssPatch:{picks_focus:{borderColor:'myValue', boxShadow:'myValue'}}\");\r\n        if(!cssPatch.picks_focus){\r\n            cssPatch.picks_focus = {boxShadow: settings.selectedPanelFocusBoxShadow, borderColor: settings.selectedPanelFocusBorderColor}\r\n        }\r\n        delete settings.selectedPanelFocusBorderColor;\r\n        delete settings.selectedPanelFocusBoxShadow;\r\n    }\r\n\r\n    transformStyles.forEach(\r\n        (i)=>{\r\n            if (settings[i.old]){\r\n                console.log(`DashboarCode.BsMultiSelect: ${i.old} is depricated, use - cssPatch:{${i.opt}:{${i.style}:'myValue'}}`);\r\n                if(!settings[i.opt]){\r\n                    let opt = {}\r\n                    opt[i.style] = settings[i.old]\r\n                    settings.cssPatch[i.opt]=opt;\r\n                }\r\n                delete settings[i.old];\r\n            }\r\n        }\r\n    )\r\n    \r\n    transformClasses.forEach( (i) => {\r\n        if (settings[i.old]){\r\n            console.log(`DashboarCode.BsMultiSelect: ${i.old} is depricated, use - css:{${i.opt}:'myValue'}`);\r\n            if(!css[i.opt]){\r\n                css[i.opt]= settings[i.old]\r\n            }\r\n            delete settings[i.old];\r\n        }\r\n    })\r\n    \r\n    if (settings.inputColor){\r\n        console.log(\"DashboarCode.BsMultiSelect: inputColor is depricated, remove parameter\");\r\n        delete settings.inputColor;\r\n    }\r\n\r\n    if (settings.useCss){\r\n        console.log(\"DashboarCode.BsMultiSelect: 'useCss: true' is depricated, use - 'useCssPatch: false'\");\r\n        if(!css.pick_disabled){\r\n            settings.useCssPatch = !settings.useCss\r\n        }\r\n        delete settings.useCss;\r\n    }  \r\n\r\n    if (settings.getIsValid || settings.getIsInValid){\r\n        throw \"DashboarCode.BsMultiSelect: parameters getIsValid and getIsInValid are depricated and removed, use - getValidity that should return (true|false|null) \"\r\n    } \r\n}","import {BsMultiSelect} from './BsMultiSelect'\r\nimport {ComposePluginManagerFactory} from './PluginManager'\r\n\r\nimport {adjustLegacySettings} from './BsMultiSelectDepricatedParameters'\r\n\r\nimport {extendIfUndefined} from './ToolsJs'\r\n\r\nimport {createCss} from './ToolsStyling'\r\n\r\n// TODO: remove environment - replace it with plugins\r\nexport function MultiSelectBuilder(environment, plugins, defaultCss) \r\n{\r\n    const defaults = {containerClass: \"dashboardcode-bsmultiselect\", css: defaultCss}\r\n\r\n    var pluginManagerFactory = ComposePluginManagerFactory(plugins, defaults);\r\n\r\n    let create = (element, options) => { \r\n        if (options && options.plugins)\r\n            console.log(\"DashboarCode.BsMultiSelect: 'options.plugins' is depricated, use - MultiSelectBuilder(environment, plugins) instead\");\r\n        \r\n        let buildConfiguration;\r\n        if (options instanceof Function) {\r\n            buildConfiguration = options;\r\n            options = null;\r\n        } else {\r\n            buildConfiguration = options?.buildConfiguration;\r\n        }\r\n        if (options){\r\n            adjustLegacySettings(options);\r\n        }\r\n        let configuration = {};\r\n        \r\n        // TODO: move to each plugin that add css (as plugMergeSettings) \r\n        configuration.css = createCss(defaults.css, options?.css);\r\n        \r\n        var pluginManager = pluginManagerFactory(configuration, options); // merge settings.cssPatch and defaults.cssPatch\r\n\r\n        extendIfUndefined(configuration, options);\r\n        extendIfUndefined(configuration, defaults);\r\n        let onInit = buildConfiguration?.(element, configuration); // TODO: configuration should become an aspect\r\n        let multiSelect = BsMultiSelect(element, environment, pluginManager, configuration, onInit); // onInit(api, aspects) - before load data\r\n        return multiSelect;\r\n    }\r\n    \r\n    return {create, defaultSettings: defaults}\r\n}\r\n","import {addToJQueryPrototype} from './AddToJQueryPrototype'\r\n\r\nimport {composeSync, ObjectValuesEx, isString} from './ToolsJs'\r\nimport {composeEventTrigger} from './ToolsDom'\r\n\r\nimport {MultiSelectBuilder} from './MultiSelectBuilder'\r\n\r\nexport function createForJQuery(window, $,  globalPopper, name, plugins, defaultCss){\r\n    let trigger = null;\r\n    let isJQyery = $ && !window.document.body.hasAttribute('data-bs-no-jquery');\r\n    if (isJQyery) {\r\n        trigger = (e, eventName) => $(e).trigger(eventName);\r\n    } else {\r\n        trigger = composeEventTrigger(window);\r\n    }\r\n\r\n    let environment = {trigger, window, globalPopper}\r\n    let pluginsArray = ObjectValuesEx(plugins)\r\n    let {create, defaultSettings} = MultiSelectBuilder(environment, pluginsArray, defaultCss);\r\n    let createForUmd = (element, settings) => {\r\n        if (isString(element))\r\n            element = window.document.querySelector(element);\r\n        return create(element, settings);\r\n    }\r\n    createForUmd.Default = defaultSettings;\r\n\r\n    if (isJQyery) {\r\n        let constructorForJquery = (element, settings, removeInstanceData) => {let multiSelect = create(element, settings); multiSelect.dispose = composeSync(multiSelect.dispose, removeInstanceData); return multiSelect;} \r\n        let prototypable = addToJQueryPrototype(name, constructorForJquery, $);\r\n    \r\n        prototypable.defaults = defaultSettings;\r\n    }\r\n    return createForUmd;   \r\n}\r\n","export function addToJQueryPrototype(pluginName, createPlugin, $){\r\n    const firstChar = pluginName.charAt(0);\r\n    const firstCharLower = firstChar.toLowerCase();\r\n    if (firstCharLower == firstChar) {\r\n        throw new Error(`Plugin name '${pluginName}' should be started from upper case char`)\r\n    }\r\n    const prototypableName = firstCharLower + pluginName.slice(1)\r\n    const noConflictPrototypable = $.fn[prototypableName];\r\n    const noConflictPrototypableForInstance = $.fn[pluginName];\r\n    const dataKey = `DashboardCode.${pluginName}`;\r\n\r\n    function createInstance(options, e, $e){\r\n        const optionsRef = (typeof options === 'object') || options instanceof Function ? options:null;\r\n        let instance = createPlugin(e, optionsRef,\r\n            () => {\r\n                $e.removeData(dataKey)\r\n            });\r\n        $e.data(dataKey, instance);\r\n        return instance;\r\n    }\r\n\r\n    function prototypable(options){\r\n        let output=[];\r\n        this.each( function (i, e) {\r\n            let $e = $(e);\r\n            let instance = $e.data(dataKey)\r\n            let isMethodName = typeof options === 'string';\r\n            if (!instance) {\r\n                if (isMethodName && /Dispose/.test(options)) \r\n                    return;\r\n                instance = createInstance(options, e, $e);\r\n            }\r\n            if (isMethodName) {\r\n                let methodName = options;\r\n                if (typeof instance[methodName] === 'undefined') {\r\n                    let lMethodName = methodName.charAt(0).toLowerCase() + methodName.slice(1)\r\n                    if ( typeof instance[lMethodName] === 'undefined') {\r\n                        throw new Error(`No method named '${methodName}'`)\r\n                    } else {\r\n                        methodName = lMethodName;\r\n                    }\r\n                }\r\n                let result = instance[methodName]();\r\n                if (result !== undefined){\r\n                    output.push(result);\r\n                }\r\n            }\r\n        })\r\n        if (output.length==0)\r\n            return this;\r\n        else if (output.length==1)\r\n            return output[0];\r\n        else\r\n            return output;\r\n    }\r\n\r\n    function prototypableForInstance(options){\r\n        let instance = this.data(dataKey);\r\n        if (instance)\r\n            return instance;\r\n        else if (this.length === 1){\r\n            return createInstance(options, this.get(0), this);\r\n        } else if (this.length > 1){\r\n            let output=[];\r\n            this.each(function(i, e){\r\n                output.push(createInstance(options, e, $(e)));\r\n            })\r\n            return output;\r\n        }\r\n    }\r\n    \r\n    $.fn[prototypableName] = prototypable;\r\n    $.fn[prototypableName].noConflict = function () {\r\n        $.fn[prototypableName] = noConflictPrototypable\r\n        return prototypable;\r\n    }\r\n\r\n    $.fn[pluginName] = prototypableForInstance;\r\n    $.fn[pluginName].noConflict = function () {\r\n        $.fn[pluginName] = noConflictPrototypableForInstance\r\n        return prototypableForInstance;\r\n    }\r\n\r\n    return prototypable;\r\n}","import {closestByClassName, siblingsAsArray} from '../ToolsDom';\r\nimport {addStyling} from '../ToolsStyling'\r\nimport {ObservableLambda, composeSync} from '../ToolsJs';\r\n\r\nexport function BsAppearancePlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                plugStaticDomBus: {\r\n                    after: \"LabelForAttributePlugin\",\r\n                    plugStaticDom: () => {\r\n                        console.log(\"TODOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO\");\r\n                        var {labelAspect, staticDom, configuration} = aspects; \r\n                        var {selectElement} = staticDom;\r\n                        var {getDefaultLabel} = configuration;\r\n                        let origLabelAspectGetLabel = labelAspect.getLabel; \r\n                        console.log(\"BsAppearancePlugin - new labelAspect.getLabel  \");\r\n                        labelAspect.getLabel = () => {\r\n                            var e = origLabelAspectGetLabel();\r\n                            if (e)\r\n                                return e;\r\n                            else{\r\n                                console.log(\"BsAppearancePlugin - new labelAspect.getLabel  - selectElement\");\r\n                                if (selectElement){\r\n                                    console.log(\"BsAppearancePlugin - new labelAspect.getLabel  - selectElement +\");\r\n                                    let labelElement = getDefaultLabel(selectElement);\r\n                                    console.log({name:\"BsAppearancePlugin - new labelAspect.getLabel  - selectElement +\", labelElement});\r\n                                    return labelElement;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                layout: () => {\r\n                    let {validationApiAspect, \r\n                        picksDom, staticDom, updateAppearanceAspect, componentPropertiesAspect, floatingLabelAspect} = aspects;\r\n                    let {getValidity, getSize, useCssPatch, css, composeGetSize} = configuration;\r\n                    \r\n                    let selectElement = staticDom.selectElement;\r\n                    \r\n                    let initialElement = staticDom.initialElement;\r\n                \r\n                    let isFloatingLabel = false;\r\n                    if (floatingLabelAspect){\r\n                        isFloatingLabel =  closestByClassName(initialElement, 'form-floating');\r\n                        floatingLabelAspect.isFloatingLabel = () => isFloatingLabel\r\n                    }\r\n                \r\n                    if (staticDom.selectElement) {\r\n                        if(!getValidity)\r\n                            getValidity = composeGetValidity(selectElement)\r\n                        if(!getSize) \r\n                            getSize = composeGetSize(selectElement)\r\n                    } else {\r\n                        if (!getValidity)\r\n                            getValidity = () => null\r\n                        if (!getSize)\r\n                            getSize = () => null\r\n                    }\r\n                \r\n                    componentPropertiesAspect.getSize=getSize;\r\n                \r\n                    componentPropertiesAspect.getValidity=getValidity;\r\n                \r\n                    var updateSize;\r\n                    if (!useCssPatch){\r\n                        updateSize= () => updateSizeForAdapter(picksDom.picksElement, getSize)\r\n                    }\r\n                    else{\r\n                        let {picks_lg, picks_sm, picks_def, picks_floating_def} = css;\r\n                        if (isFloatingLabel)\r\n                            picks_lg = picks_sm = picks_def = picks_floating_def;\r\n                        updateSize = () => updateSizeJsForAdapter(picksDom.picksElement, picks_lg, picks_sm, picks_def,  getSize);\r\n                    }\r\n                \r\n                    if (useCssPatch){\r\n                        var origToggleFocusStyling = picksDom.toggleFocusStyling;\r\n                        picksDom.toggleFocusStyling = () => {\r\n                            var validity =  validationObservable.getValue();\r\n                            var isFocusIn = picksDom.getIsFocusIn();\r\n                            origToggleFocusStyling(isFocusIn)\r\n                            if (isFocusIn){\r\n                                if (validity===false) { \r\n                                    // but not toggle events (I know it will be done in future)\r\n                                    picksDom.setIsFocusIn(isFocusIn);\r\n                                    \r\n                                    addStyling(picksDom.picksElement, css.picks_focus_invalid)\r\n                                } else if (validity===true) {\r\n                                    // but not toggle events (I know it will be done in future)\r\n                                    picksDom.setIsFocusIn(isFocusIn);\r\n                                    \r\n                                    addStyling(picksDom.picksElement, css.picks_focus_valid)  \r\n                                }              \r\n                            }\r\n                        }\r\n                    }\r\n                \r\n                    var getWasValidated = () => {\r\n                        var wasValidatedElement = closestByClassName(staticDom.initialElement, 'was-validated');\r\n                        return wasValidatedElement?true:false;\r\n                    }\r\n                    var wasUpdatedObservable = ObservableLambda(()=>getWasValidated());\r\n                    var getManualValidationObservable = ObservableLambda(()=>getValidity());\r\n                    let validationApiObservable = validationApiAspect?.validationApiObservable;\r\n                    \r\n                    var validationObservable = ObservableLambda(\r\n                        () => wasUpdatedObservable.getValue()?validationApiObservable.getValue():getManualValidationObservable.getValue()\r\n                    )\r\n                  \r\n                    validationObservable.attach(\r\n                        (value)=>{\r\n                            var  {validMessages, invalidMessages} = getMessagesElements(staticDom.containerElement);\r\n                            updateValidity( picksDom.picksElement, validMessages, invalidMessages, value);\r\n                            picksDom.toggleFocusStyling();\r\n                        }\r\n                    )\r\n                    wasUpdatedObservable.attach(\r\n                        ()=>validationObservable.call()\r\n                    )\r\n                    if (validationApiObservable)\r\n                        validationApiObservable.attach(\r\n                            ()=>validationObservable.call()\r\n                        )\r\n                    getManualValidationObservable.attach(\r\n                        ()=>validationObservable.call()\r\n                    )\r\n                \r\n                    updateAppearanceAspect.updateAppearance = composeSync(\r\n                        updateAppearanceAspect.updateAppearance, \r\n                        updateSize, \r\n                        validationObservable.call, \r\n                        getManualValidationObservable.call);\r\n                \r\n                    return {\r\n                        buildApi(api){\r\n                            api.updateSize = updateSize;\r\n                            api.updateValidity = ()=> getManualValidationObservable.call();\r\n                            api.updateWasValidated = ()=>wasUpdatedObservable.call();\r\n                        },\r\n                        dispose(){\r\n                            wasUpdatedObservable.detachAll();\r\n                            validationObservable.detachAll();\r\n                            getManualValidationObservable.detachAll();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateValidity(picksElement, validMessages, invalidMessages, validity){\r\n    if (validity===false){\r\n        picksElement.classList.add('is-invalid');\r\n        picksElement.classList.remove('is-valid');\r\n        invalidMessages.map(e=>e.style.display='block'); \r\n        validMessages.map(e=>e.style.display='none');      \r\n    }\r\n    else if (validity===true){\r\n        picksElement.classList.remove('is-invalid');\r\n        picksElement.classList.add('is-valid');\r\n        invalidMessages.map(e=>e.style.display='none'); \r\n        validMessages.map(e=>e.style.display='block'); \r\n    }else {\r\n        picksElement.classList.remove('is-invalid');\r\n        picksElement.classList.remove('is-valid');\r\n        invalidMessages.map(e=>e.style.display=''); \r\n        validMessages.map(e=>e.style.display=''); \r\n    }\r\n}\r\n\r\nfunction updateSizeClasses(picksElement, size){\r\n    if (size==\"lg\"){\r\n        picksElement.classList.add('form-control-lg');\r\n        picksElement.classList.remove('form-control-sm');\r\n    }\r\n    else if (size==\"sm\"){\r\n        picksElement.classList.remove('form-control-lg');\r\n        picksElement.classList.add('form-control-sm');\r\n    }\r\n    else{\r\n        picksElement.classList.remove('form-control-lg');\r\n        picksElement.classList.remove('form-control-sm');\r\n    }\r\n}\r\n\r\nfunction updateSizeJsPicks(picksElement, picksLgStyling, picksSmStyling, picksDefStyling, size){\r\n    if (size==\"lg\"){\r\n        addStyling(picksElement, picksLgStyling);\r\n    } else if (size==\"sm\"){\r\n        addStyling(picksElement, picksSmStyling);\r\n    } else {\r\n        addStyling(picksElement, picksDefStyling);\r\n    }\r\n}\r\n\r\nfunction updateSizeJs(picksElement, picksLgStyling, picksSmStyling, picksDefStyling, size){\r\n    updateSizeClasses(picksElement, size);\r\n    updateSizeJsPicks(picksElement, picksLgStyling, picksSmStyling, picksDefStyling, size)\r\n}\r\n\r\nfunction updateSizeForAdapter(picksElement, getSize){\r\n    updateSizeClasses(picksElement, getSize())\r\n}\r\n\r\nfunction updateSizeJsForAdapter(picksElement, picksLgStyling, picksSmStyling, picksDefStyling, getSize){\r\n    updateSizeJs(picksElement, picksLgStyling, picksSmStyling, picksDefStyling, getSize())\r\n}\r\n\r\nfunction getMessagesElements(containerElement){\r\n    var siblings = siblingsAsArray(containerElement);\r\n    var invalidMessages =  siblings.filter(e=>e.classList.contains('invalid-feedback') || \r\n        e.classList.contains('invalid-tooltip'));\r\n    var validMessages =  siblings.filter(e=>e.classList.contains('valid-feedback') || \r\n        e.classList.contains('valid-tooltip'));\r\n    return {validMessages, invalidMessages}    \r\n} \r\n\r\nfunction composeGetValidity(selectElement){\r\n    var getValidity = () => \r\n        selectElement.classList.contains('is-invalid')?false:\r\n        (selectElement.classList.contains('is-valid')?true:null);\r\n    return getValidity;\r\n}","import {closestByClassName} from '../ToolsDom'\r\nimport {BsAppearancePlugin} from './BsAppearancePlugin'\r\n\r\nexport function BsAppearanceBs5Plugin(defaults) {\r\n    defaults.pickButtonHTML = '<button aria-label=\"Remove\" tabIndex=\"-1\" type=\"button\"></button>'; // used in PickDomFactory\r\n    defaults.composeGetSize = composeGetSize; // BsAppearancePlugin\r\n    defaults.getDefaultLabel = getDefaultLabel; // FloatingLabelPlugin, BsAppearancePlugin\r\n    return BsAppearancePlugin();\r\n}\r\n\r\nfunction composeGetSize(element){\r\n    let inputGroupElement = closestByClassName(element, 'input-group');\r\n    let getSize = null;\r\n    if (inputGroupElement){\r\n        getSize = function(){\r\n            var value = null;\r\n            if (inputGroupElement.classList.contains('input-group-lg'))\r\n                value = 'lg';\r\n            else if (inputGroupElement.classList.contains('input-group-sm'))\r\n                value = 'sm';\r\n            return value;\r\n        }\r\n    }\r\n    else{ \r\n        getSize = function(){\r\n            var value = null;\r\n            if (element.classList.contains('form-select-lg') || element.classList.contains('form-control-lg')) // changed for BS\r\n                value = 'lg';\r\n            else if (element.classList.contains('form-select-sm') || element.classList.contains('form-control-sm'))\r\n                value = 'sm'; \r\n            return value;\r\n        }\r\n    }\r\n    return getSize;\r\n}\r\n\r\nfunction getDefaultLabel(element){\r\n    let value = null;\r\n    let query = `label[for=\"${element.id}\"]`;\r\n    let p1 = element.parentElement;\r\n    value = p1.querySelector(query); // label can be wrapped into col-auto\r\n    if (!value){\r\n        let p2 = p1.parentElement;\r\n        value = p2.querySelector(query);\r\n    }\r\n    return value;\r\n}","import {defCall, composeSync} from '../ToolsJs';\r\n\r\nexport function LabelForAttributePlugin(defaults){\r\n    defaults.label = null;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n\t            plugStaticDom: ()=> {\r\n                    aspects.labelAspect = LabelAspect(configuration);\r\n                    aspects.labelNewIdAspect = LabelNewIdAspect(aspects); // ?\r\n        \t    },\r\n                layout: () => {\r\n                    var {filterDom, labelAspect, loadAspect, labelNewIdAspect, disposeAspect} = aspects;\r\n    \r\n                    // TODO: move to \r\n                    console.log(\"LabelForAttributePlugin, labelNewIdAspect\");\r\n                    \r\n                    var labelForAttributeAspect = LabelForAttributeAspect(filterDom, labelAspect, labelNewIdAspect, disposeAspect);\r\n                    aspects.labelForAttributeAspect=labelForAttributeAspect;\r\n                    \r\n                    loadAspect.load = composeSync(loadAspect.load, ()=>labelForAttributeAspect.update())\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction LabelAspect(configuration){\r\n    return {\r\n        getLabel(){\r\n            return defCall(configuration.label); \r\n        }\r\n    }\r\n}\r\n\r\n// TODO migrate to configuration\r\nfunction LabelNewIdAspect(aspects){\r\n    return {\r\n        createInputId(){\r\n            let {configuration, staticDom}=aspects;\r\n            let {containerClass} = configuration;\r\n            let {containerElement} = staticDom;\r\n        \r\n            let a =`${containerClass}-generated-filter-${containerElement.id}` \r\n            console.log('LabelNewIdAspect - ' + a);\r\n            return a; \r\n            //`${containerClass}-generated-input-${((selectElement.id)?selectElement.id:selectElement.name).toLowerCase()}-id`;\r\n        }\r\n    }\r\n}\r\n\r\nfunction LabelForAttributeAspect(filterDom, labelAspect, labelNewIdAspect, disposeAspect){\r\n    return{\r\n        update(){  \r\n            //let createInputId = null;\r\n            //let {selectElement, containerElement} = staticDom;\r\n            let {filterInputElement} = filterDom;\r\n\r\n            // if (selectElement)\r\n            //     createInputId = () => `${containerClass}-generated-input-${((selectElement.id)?selectElement.id:selectElement.name).toLowerCase()}-id`;\r\n            // else\r\n            //     createInputId = () => `${containerClass}-generated-filter-${containerElement.id}`;\r\n            \r\n            let labelElement =  labelAspect.getLabel(); //getLabelElementAspect.getLabelElement();\r\n            console.log(\"LabelForAttributeAspect - \" );\r\n            if (labelElement) {\r\n                console.log(\"LabelForAttributeAspect + \" );\r\n                let backupedForAttribute = labelElement.getAttribute('for');\r\n                var newId = labelNewIdAspect.createInputId();\r\n                filterInputElement.setAttribute('id', newId);\r\n                labelElement.setAttribute('for',newId);\r\n                if (backupedForAttribute){\r\n                    disposeAspect.dispose = composeSync(\r\n                        disposeAspect.dispose, \r\n                        () =>labelElement.setAttribute('for',backupedForAttribute)\r\n                    )\r\n                }\r\n            }\r\n        } \r\n    }\r\n}","\r\nimport {getIsRtl, AttributeBackup} from '../ToolsDom';\r\nimport {isBoolean} from '../ToolsJs';\r\n\r\nexport function RtlPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {popperRtlAspect, staticDom} = aspects;\r\n                    let {isRtl} = configuration;\r\n                    let forceRtlOnContainer = false; \r\n                    if (isBoolean(isRtl))\r\n                        forceRtlOnContainer = true;\r\n                    else\r\n                        isRtl = getIsRtl(staticDom.initialElement);\r\n\r\n                    var attributeBackup = AttributeBackup();\r\n                    if (forceRtlOnContainer){\r\n                        attributeBackup.set(staticDom.containerElement, \"dir\", \"rtl\");\r\n                    }\r\n                    else if (staticDom.selectElement){\r\n                        var dirAttributeValue = staticDom.selectElement.getAttribute(\"dir\");\r\n                        if (dirAttributeValue){\r\n                            attributeBackup.set(staticDom.containerElement, \"dir\", dirAttributeValue);\r\n                        }\r\n                    }\r\n                \r\n                    if (popperRtlAspect)\r\n                        popperRtlAspect.getIsRtl = () => isRtl;\r\n                \r\n                    return {\r\n                        dispose(){\r\n                            attributeBackup.restore();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {ObservableValue, ObservableLambda, defCall, isBoolean, composeSync} from '../ToolsJs';\r\nimport {getDataGuardedWithPrefix} from '../ToolsDom';\r\n\r\nconst defValueMissingMessage = 'Please select an item in the list'\r\n\r\nexport function ValidationApiPlugin(defaults){\r\n    defaults.getValueRequired = function(){\r\n        return false;\r\n    }\r\n    defaults.valueMissingMessage = '';\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    var {triggerAspect, onChangeAspect, optionsAspect, \r\n                        staticDom, filterDom, updateDataAspect} = aspects;\r\n                   // TODO: required could be a function\r\n                   let {getIsValueMissing, valueMissingMessage, required, getValueRequired} = configuration;\r\n                   if (!isBoolean(required))\r\n                       required = getValueRequired(); \r\n                   valueMissingMessage = defCall(valueMissingMessage,\r\n                       ()=> getDataGuardedWithPrefix(staticDom.initialElement,\"bsmultiselect\",\"value-missing-message\"),\r\n                       defValueMissingMessage)\r\n               \r\n                   if (!getIsValueMissing) {\r\n                       getIsValueMissing = () => {\r\n                           let count = 0;\r\n                           let optionsArray = optionsAspect.getOptions();\r\n                           for (var i=0; i < optionsArray.length; i++) {\r\n                               if (optionsArray[i].selected) \r\n                                   count++;\r\n                           }\r\n                           return count===0;\r\n                       }\r\n                   }\r\n                   \r\n                   var isValueMissingObservable = ObservableLambda(()=>required && getIsValueMissing());\r\n                   var validationApiObservable  = ObservableValue(!isValueMissingObservable.getValue());\r\n               \r\n                   onChangeAspect.onChange = composeSync(isValueMissingObservable.call, onChangeAspect.onChange);\r\n                   updateDataAspect.updateData = composeSync(isValueMissingObservable.call, updateDataAspect.updateData);\r\n               \r\n                   aspects.validationApiAspect = ValidationApiAspect(validationApiObservable);\r\n               \r\n                   return {\r\n                       buildApi(api){\r\n                           api.validationApi = ValidityApi(\r\n                               filterDom.filterInputElement, \r\n                               isValueMissingObservable, \r\n                               valueMissingMessage,\r\n                               (isValid)=>validationApiObservable.setValue(isValid),\r\n                               triggerAspect.trigger\r\n                           );\r\n                       },\r\n                       dispose(){\r\n                           isValueMissingObservable.detachAll(); \r\n                           validationApiObservable.detachAll();\r\n                       }\r\n                   }\r\n                },\r\n                layoutInit: (aspects)=> {\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ValidationApiAspect(validationApiObservable){\r\n    return {\r\n        validationApiObservable\r\n    }\r\n}\r\n\r\nfunction ValidityApi(visibleElement, isValueMissingObservable, valueMissingMessage, onValid, trigger){\r\n    var customValidationMessage = \"\";\r\n    var validationMessage = \"\";\r\n    var validity = null;\r\n    var willValidate = true;\r\n    \r\n    function setMessage(valueMissing, customError){\r\n        validity = Object.freeze({\r\n            valueMissing,\r\n            customError,\r\n            valid: !(valueMissing || customError),\r\n        });\r\n        validationMessage = customError?customValidationMessage:(valueMissing?valueMissingMessage:\"\")\r\n        visibleElement.setCustomValidity(validationMessage);\r\n        onValid(validity.valid);\r\n    }\r\n\r\n    setMessage(isValueMissingObservable.getValue(), false);\r\n\r\n    isValueMissingObservable.attach(\r\n        (value) => {\r\n            setMessage(value, validity.customError);\r\n        }\r\n    );\r\n    var checkValidity = () => {\r\n        if (!validity.valid)\r\n            trigger('dashboardcode.multiselect:invalid')\r\n        return validity.valid;\r\n    }\r\n    return {\r\n        validationMessage,\r\n        willValidate,\r\n        validity,\r\n        setCustomValidity(message){\r\n            customValidationMessage = message;\r\n            setMessage(validity.valueMissing, customValidationMessage?true:false);\r\n        },\r\n        checkValidity,\r\n        reportValidity(){\r\n            visibleElement.reportValidity();\r\n            return checkValidity();\r\n        }\r\n    }\r\n}","export function HiddenOptionPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {createWrapAspect, isChoiceSelectableAspect,\r\n                        wrapsCollection, buildChoiceAspect, buildAndAttachChoiceAspect,\r\n                        countableChoicesListInsertAspect, countableChoicesList} = aspects;\r\n                \r\n                    countableChoicesListInsertAspect.countableChoicesListInsert = (wrap, key) => {\r\n                        if ( !wrap.isOptionHidden ){\r\n                            let choiceNext = wrapsCollection.getNext(key, c=>!c.isOptionHidden );\r\n                            countableChoicesList.add(wrap, choiceNext)\r\n                        }\r\n                    }\r\n                \r\n                    let origBuildAndAttachChoice = buildAndAttachChoiceAspect.buildAndAttachChoice;\r\n                    buildAndAttachChoiceAspect.buildAndAttachChoice=(wrap, getNextElement)=>{\r\n                        if (wrap.isOptionHidden){ \r\n                            buildHiddenChoice(wrap);\r\n                        }\r\n                        else{ \r\n                            origBuildAndAttachChoice(wrap, getNextElement);\r\n                        }\r\n                    }\r\n                \r\n                    var origIsSelectable = isChoiceSelectableAspect.isSelectable;\r\n                    isChoiceSelectableAspect.isSelectable = (wrap) => origIsSelectable(wrap) && !wrap.isOptionHidden;\r\n                \r\n                    let {getIsOptionHidden, options} = configuration;\r\n                    if (options) {\r\n                        if (!getIsOptionHidden)\r\n                            getIsOptionHidden = (option) => (option.hidden===undefined)?false:option.hidden;     \r\n                    } else {\r\n                        if (!getIsOptionHidden)\r\n                            getIsOptionHidden = (option) => {\r\n                                return option.hidden;     \r\n                            } \r\n                    }\r\n                    \r\n                    var origCreateWrap = createWrapAspect.createWrap;\r\n                    createWrapAspect.createWrap = (option) => {\r\n                        let wrap = origCreateWrap(option);\r\n                        wrap.isOptionHidden = getIsOptionHidden(option);\r\n                        return wrap;\r\n                    };\r\n                \r\n                    return {\r\n                        buildApi(api){     \r\n                            let getNextNonHidden =  (key) => wrapsCollection.getNext(key, c => !c.isOptionHidden );\r\n                \r\n                            api.updateOptionsHidden = () => \r\n                                wrapsCollection.forLoop( (wrap, key) => \r\n                                        updateChoiceHidden(wrap, key, getNextNonHidden, countableChoicesList, getIsOptionHidden, buildChoiceAspect)\r\n                                    );\r\n                \r\n                            api.updateOptionHidden  = (key) => \r\n                                updateChoiceHidden(wrapsCollection.get(key), key, getNextNonHidden, countableChoicesList, getIsOptionHidden, buildChoiceAspect);\r\n                            // TODO create updateHidden ? \r\n                            // it is too complex since we need to find the next non hidden, when this depends on key \r\n                            // there should be the backreference \"wrap -> index\" invited before\r\n                            // api.updateOptionHidden  = (key) => wrapsCollection.get(key).updateHidden();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction buildHiddenChoice(wrap){\r\n    wrap.updateSelected = () => void 0;\r\n    \r\n    wrap.choice.isChoiceElementAttached = false;\r\n    wrap.choice.choiceElement = null;\r\n    wrap.choice.choiceElementAttach = null;\r\n    wrap.choice.setVisible = null; \r\n    wrap.choice.setHoverIn = null;\r\n    wrap.choice.remove = null; \r\n    \r\n    wrap.choice.dispose = () => { \r\n        wrap.choice.dispose = null;\r\n    };\r\n\r\n    wrap.dispose = () => { \r\n        wrap.choice.dispose();\r\n        wrap.dispose = null;\r\n    };\r\n}\r\n\r\nfunction updateChoiceHidden(wrap, key, getNextNonHidden, countableChoicesList, getIsOptionHidden, buildChoiceAspect){\r\n    let newIsOptionHidden = getIsOptionHidden(wrap.option);\r\n    if (newIsOptionHidden != wrap.isOptionHidden)\r\n    {\r\n        wrap.isOptionHidden= newIsOptionHidden;\r\n        if (wrap.isOptionHidden) {\r\n\r\n            countableChoicesList.remove(wrap);\r\n            wrap.choice.remove(); \r\n            buildHiddenChoice(wrap);\r\n        } else {\r\n            let nextChoice = getNextNonHidden(key);\r\n            countableChoicesList.add(wrap, nextChoice);\r\n            buildChoiceAspect.buildChoice(wrap);\r\n            wrap.choice.choiceElementAttach(nextChoice?.choice.choiceElement);\r\n        }\r\n    }\r\n}\r\n","import {createCss, extendCss} from '../ToolsStyling';\r\nimport {isBoolean} from '../ToolsJs';\r\n\r\nexport function CssPatchPlugin(defaults){\r\n    defaults.useCssPatch = true;\r\n    return {\r\n        buildAspects: (aspects, configuration, settings) => {\r\n            // merge\r\n            let cssPatch = settings?.cssPatch;\r\n            if (isBoolean(cssPatch))\r\n                throw new Error(\"BsMultiSelect: 'cssPatch' was used instead of 'useCssPatch'\") // often type of error\r\n            configuration.cssPatch = createCss(defaults.cssPatch, cssPatch); // replace classes, merge styles\r\n            return {\r\n                // TODO: this means after all cssPatch added, but this should be done different way (another static extension point?)\r\n                plugStaticDom: () => {\r\n                    if (configuration.useCssPatch)\r\n                        extendCss(configuration.css, configuration.cssPatch); \r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst _cssPatchBs5 = {\r\n    choicesList: {listStyleType:'none', paddingLeft:'0', paddingRight:'0', marginBottom:'0'},\r\n    picks: {listStyleType:'none', display:'flex', flexWrap:'wrap',  height: 'auto', marginBottom: '0', cursor: 'text'},\r\n    choice: {classes:'px-md-2 px-1', styles:{cursor:'pointer'}},\r\n    //choice_selected: 'selected',  //  remove,\r\n    //choice_disabled: 'disabled',  //  remove,\r\n    choice_hover: 'text-primary bg-light', \r\n    choice_disabled_hover: 'bg-light', // actually 'disabled, not selected'\r\n    filterInput: {\r\n        border:'0px', height: 'auto', boxShadow:'none', \r\n        padding:'0', margin:'0', \r\n        outline:'none', backgroundColor:'transparent',\r\n        backgroundImage: 'none' // otherwise BS .was-validated set its image\r\n    },\r\n    filterInput_empty: 'form-control', // need for placeholder, TODO test form-control-plaintext\r\n\r\n    // used in PicksDom\r\n    picks_disabled: {backgroundColor: '#e9ecef'},\r\n\r\n    picks_focus: {borderColor: '#80bdff', boxShadow: '0 0 0 0.2rem rgba(0, 123, 255, 0.25)'},\r\n    picks_focus_valid: {borderColor: '',  boxShadow: '0 0 0 0.2rem rgba(40, 167, 69, 0.25)'},\r\n    picks_focus_invalid: {borderColor: '', boxShadow: '0 0 0 0.2rem rgba(220, 53, 69, 0.25)'},\r\n    \r\n    // used in BsAppearancePlugin\r\n    picks_def: {minHeight: 'calc(2.25rem + 2px)'},\r\n    picks_lg:  {minHeight: 'calc(2.875rem + 2px)'},\r\n    picks_sm:  {minHeight: 'calc(1.8125rem + 2px)'},\r\n    picks_floating_def: {minHeight: 'calc(3.5rem + 2px)'},\r\n    \r\n    // used in pickContentGenerator\r\n    pick: {paddingLeft: '0', paddingRight: '.5rem', paddingInlineStart:'0', paddingInlineEnd:'0.5rem', color:'var(--bs-dark)'},\r\n    pickButton: {fontSize:'0.8em',  float : \"none\", verticalAlign: \"text-top\"},\r\n    pickContent_disabled: {opacity: '.65'}, \r\n    \r\n    // used in choiceContentGenerator\r\n    choiceContent: {justifyContent: 'flex-start', cursor:'inherit'}, // BS problem: without this on inline form menu items justified center\r\n    choiceLabel: {color: 'inherit', cursor:'inherit'}, // otherwise BS .was-validated set its color\r\n    choiceCheckBox: {color: 'inherit', cursor:'inherit'},\r\n    choiceLabel_disabled: {opacity: '.65'},  // more flexible than {color: '#6c757d'}; note: avoid opacity on pickElement's border; TODO write to BS \r\n\r\n    // floating plugin\r\n    label_floating_lifted: {opacity: '.65', transform : 'scale(.85) translateY(-.5rem) translateX(.15rem)'},\r\n    picks_floating_lifted: {paddingTop: '1.625rem', paddingLeft:'0.8rem', paddingBottom : '0'},\r\n\r\n    warning: {paddingLeft: '.25rem', paddingRight: '.25rem', zIndex: 4,  fontSize:'small', backgroundColor:'var(--bs-warning)'} // zIndex=4  since the input-group zIndex=3\r\n}\r\n\r\nconst _cssPatchBs4 = {\r\n    choicesList: {listStyleType:'none', paddingLeft:'0', paddingRight:'0', marginBottom:'0'},\r\n    picks: {listStyleType:'none', display:'flex', flexWrap:'wrap',  height: 'auto', marginBottom: '0',cursor: 'text'},\r\n    choice: {classes:'px-md-2 px-1', styles:{cursor:'pointer'}},    \r\n    choice_hover: 'text-primary bg-light', \r\n    choice_disabled_hover: 'bg-light',\r\n    filterInput: {border:'0px', height: 'auto', boxShadow:'none', \r\n        padding:'0', margin:'0', \r\n        outline:'none', backgroundColor:'transparent',\r\n        backgroundImage: 'none' // otherwise BS .was-validated set its image\r\n    },\r\n    filterInput_empty: 'form-control', // need for placeholder, TODO test form-control-plaintext\r\n\r\n    // used in PicksDom\r\n    picks_disabled: {backgroundColor: '#e9ecef'},\r\n\r\n    picks_focus: {borderColor: '#80bdff', boxShadow: '0 0 0 0.2rem rgba(0, 123, 255, 0.25)'},\r\n    picks_focus_valid: {borderColor: '', boxShadow: '0 0 0 0.2rem rgba(40, 167, 69, 0.25)'},\r\n    picks_focus_invalid: {borderColor: '', boxShadow: '0 0 0 0.2rem rgba(220, 53, 69, 0.25)'},\r\n    \r\n    // used in BsAppearancePlugin\r\n    picks_def: {minHeight: 'calc(2.25rem + 2px)'},\r\n    picks_lg:  {minHeight: 'calc(2.875rem + 2px)'},\r\n    picks_sm:  {minHeight: 'calc(1.8125rem + 2px)'},\r\n    \r\n    // used in pickContentGenerator\r\n    pick: {lineHeight: '1.5em', paddingLeft: '0', paddingRight: '.5rem', paddingInlineStart:'0', paddingInlineEnd:'0.5rem'},\r\n    pickButton: {fontSize:'1.5em', lineHeight: '.9em', float : \"none\"},\r\n    pickContent_disabled: {opacity: '.65'}, \r\n    \r\n    // used in choiceContentGenerator\r\n    choiceContent: {justifyContent: 'flex-start', cursor:'inherit'}, // BS problem: without this on inline form menu items justified center\r\n    choiceLabel: {color: 'inherit', cursor:'inherit'}, // otherwise BS .was-validated set its color\r\n    choiceCheckBox: {color: 'inherit', cursor:'inherit'},\r\n    choiceLabel_disabled: {opacity: '.65'},  // more flexible than {color: '#6c757d'}; note: avoid opacity on pickElement's border; TODO write to BS4 \r\n\r\n    warning: {paddingLeft: '.25rem', paddingRight: '.25rem', zIndex: 4,  fontSize:'small', backgroundColor: 'var(--bs-warning)'}, // zIndex=4  since the input-group zIndex=3\r\n}\r\n\r\nconst _cssBs4 = {\r\n    choices: 'dropdown-menu', // bs4, in bsmultiselect.scss as ul.dropdown-menu\r\n    choicesList: '', // bs4, in bsmultiselect.scss as div.dropdown-menu>ul (first child)\r\n    choice_hover:  'hover',  //  not bs4, in scss as 'ul.dropdown-menu li.hover'\r\n    choice_selected: '', \r\n    choice_disabled: '', \r\n\r\n    picks: 'form-control',  // bs4, in scss 'ul.form-control'\r\n    picks_focus: 'focus', // not bs4, in scss 'ul.form-control.focus'\r\n    picks_disabled: 'disabled', //  not bs4, in scss 'ul.form-control.disabled'\r\n    pick_disabled: '',  \r\n    \r\n    pickFilter: '', \r\n    filterInput: '',\r\n\r\n    // used in pickContentGenerator\r\n    pick: 'badge', // bs4\r\n    pickContent: '',\r\n    pickContent_disabled: 'disabled', // not bs4, in scss 'ul.form-control li span.disabled'\r\n    pickButton: 'close', // bs4\r\n\r\n    // used in choiceContentGenerator\r\n    // choice:  'dropdown-item', // it seems like hover should be managed manually since there should be keyboard support\r\n    choiceCheckBox_disabled: 'disabled', //  not bs4, in scss as 'ul.form-control li .custom-control-input.disabled ~ .custom-control-label'\r\n    choiceContent: 'custom-control custom-checkbox d-flex', // bs4 d-flex required for rtl to align items\r\n    choiceCheckBox: 'custom-control-input', // bs4\r\n    choiceLabel: 'custom-control-label justify-content-start',\r\n    choiceLabel_disabled: '',\r\n\r\n    warning: 'alert-warning bg-warning'\r\n}\r\n\r\n\r\nconst _cssBs5 = {\r\n    choices: 'dropdown-menu', // bs, in bsmultiselect.scss as div.dropdown-menu\r\n    choicesList: '', // bs, in bsmultiselect.scss as div.dropdown-menu>ul (first child)\r\n    choice_hover:  'hover',  //  not bs, in scss as 'ul.dropdown-menu li.hover'\r\n    choice_selected: 'selected',  //  not bs,\r\n    choice_disabled: 'disabled',  //  not bs,\r\n    picks: 'form-control',  // bs, in scss 'ul.form-control'\r\n    picks_focus: 'focus', // not bs, in scss 'ul.form-control.focus'\r\n    picks_disabled: 'disabled', //  not bs, in scss 'ul.form-control.disabled'\r\n    pick_disabled: '',  \r\n    \r\n    pickFilter: '', \r\n    filterInput: '',\r\n\r\n    // used in pickContentGenerator\r\n    pick: {classes:'badge'}, // bs\r\n    pickContent: '',\r\n    pickContent_disabled: 'disabled', // not bs, in scss 'ul.form-control li span.disabled'\r\n    pickButton: 'btn-close', // bs\r\n\r\n    // used in choiceContentGenerator\r\n    // choice:  'dropdown-item', // it seems like hover should be managed manually since there should be keyboard support\r\n    choiceCheckBox_disabled: 'disabled', //  not bs, in scss as 'ul.form-control li .custom-control-input.disabled ~ .custom-control-label'\r\n    choiceContent: 'form-check', // bs d-flex required for rtl to align items\r\n    choiceCheckBox: 'form-check-input', // bs\r\n    choiceLabel: 'form-check-label',\r\n    choiceLabel_disabled: '',\r\n\r\n    label_floating_lifted: 'floating-lifted',\r\n    picks_floating_lifted: 'floating-lifted',\r\n\r\n    warning: 'alert-warning'\r\n}\r\n\r\n","export function JQueryMethodsPlugin(){\r\n    return {\r\n        buildAspects: () => {\r\n            return {\r\n                layout: (aspects) => {\r\n                    let {staticDom, choicesDom, filterDom, picksList, picksDom} = aspects;\r\n                    return {\r\n                        buildApi(api){\r\n                            api.getContainer = () =>  staticDom.containerElement;\r\n                            api.getChoices = () => choicesDom.choicesElement;\r\n                            api.getChoicesList = () => choicesDom.choicesListElement;\r\n                            api.getFilterInput = () => filterDom.filterInputElement;\r\n                            api.getPicks = () => picksDom.picksElement;\r\n                            api.picksCount = () => picksList.getCount();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","export function OptionsApiPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                layout: () => {\r\n                    let {buildAndAttachChoiceAspect, wraps, wrapsCollection, createWrapAspect, createChoiceBaseAspect,\r\n                        optionsAspect, resetLayoutAspect} = aspects;\r\n                    return {\r\n                        buildApi(api){\r\n                \r\n                            api.updateOptionAdded = (key) => {  // TODO: generalize index as key \r\n                                let options = optionsAspect.getOptions();\r\n                                let option = options[key];\r\n                                \r\n                                let wrap = createWrapAspect.createWrap(option);\r\n                                wrap.choice= createChoiceBaseAspect.createChoiceBase(option);\r\n                                wraps.insert(key, wrap);\r\n                                let nextChoice = ()=> wrapsCollection.getNext(key, c => c.choice.choiceElement);\r\n                \r\n                                buildAndAttachChoiceAspect.buildAndAttachChoice(\r\n                                    wrap,\r\n                                    () => nextChoice()?.choice.choiceElement\r\n                                )\r\n                            }\r\n                        \r\n                            api.updateOptionRemoved = (key) => { // TODO: generalize index as key \r\n                                resetLayoutAspect.resetLayout(); // always hide 1st, then reset filter\r\n                                \r\n                                var wrap = wraps.remove(key);\r\n                                wrap.choice.remove?.();\r\n                                wrap.dispose?.();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\n// TODO: there should be two new \"independent aspects\" AddPickAspect and RemovePickAspect \r\n// plugin should overdrive them : call setWrapSelected and etc\r\n// therefore there should new component API methods\r\n// addOptionPick(key) -> call addPick(pick) which returns removePick() \r\n// SetOptionSelectedAspect, OptionToggleAspect should be moved there \r\n// OptionToggleAspect overrided in DisabledOptionPlugin\r\n\r\nexport function SelectedOptionPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n\t            plugStaticDom: ()=> {\r\n                    let {wrapsCollection} = aspects;\r\n                    let {getSelected : getIsOptionSelected, setSelected : setIsOptionSelected, options} = configuration;\r\n\r\n                    if (options) {\r\n                        if (!setIsOptionSelected){\r\n                            setIsOptionSelected = (option, value) => {option.selected = value};\r\n                        }\r\n                        if (!getIsOptionSelected)\r\n                            getIsOptionSelected = (option) => option.selected;     \r\n                    } else { // selectElement\r\n                        if (!getIsOptionSelected){\r\n                            getIsOptionSelected = (option) => option.selected;\r\n                        }\r\n                        if (!setIsOptionSelected){\r\n                            setIsOptionSelected = (option, value) => {option.selected = value};\r\n                            // NOTE: adding this (setAttribute) break Chrome's html form reset functionality:\r\n                            // if (value) option.setAttribute('selected','');\r\n                            // else option.removeAttribute('selected');\r\n                        }\r\n                    }\r\n                    configuration.getSelected= getIsOptionSelected;\r\n                    configuration.setSelected= setIsOptionSelected;\r\n                    aspects.updateOptionsSelectedAspect = UpdateOptionsSelectedAspect(wrapsCollection, getIsOptionSelected);\r\n        \t    },\r\n                layout: () => {\r\n                    let {wrapsCollection, updateOptionsSelectedAspect,\r\n                        createWrapAspect, buildChoiceAspect, removePickAspect,\r\n                        resetLayoutAspect, picksList, isChoiceSelectableAspect, optionToggleAspect,\r\n                        /*inputAspect, filterDom, filterManagerAspect,*/ createPickHandlersAspect, addPickAspect,  fullMatchAspect, \r\n                        onChangeAspect, filterPredicateAspect\r\n                        } = aspects;\r\n                    let {getSelected : getIsOptionSelected, setSelected : setIsOptionSelected} = configuration;\r\n                    \r\n                \r\n                    let origFilterPredicate = filterPredicateAspect.filterPredicate;\r\n                    filterPredicateAspect.filterPredicate = (wrap, text) =>\r\n                        !wrap.isOptionSelected  &&  origFilterPredicate(wrap, text)\r\n                \r\n                \r\n                    let  origBuildChoice = buildChoiceAspect.buildChoice;\r\n                    buildChoiceAspect.buildChoice= (wrap) => {\r\n                        origBuildChoice(wrap);\r\n                        wrap.updateSelected = () => {\r\n                            wrap.choice.choiceDomManagerHandlers.updateSelected();\r\n                            onChangeAspect.onChange();\r\n                        }\r\n                        wrap.dispose = composeSync( ()=>{wrap.updateSelected = null}, wrap.dispose)\r\n                    }\r\n                \r\n                    // TODO: test this instead of wrap.updateSelected\r\n                    // function updateSelected(wrap){\r\n                    //     if (wrap.pick){\r\n                    //         if (wrap.isOptionSelected)\r\n                    //             pickHandlers.producePick();\r\n                    //         else {\r\n                    //             pickHandlers.removeAndDispose();\r\n                    //             pickHandlers.removeAndDispose=null;\r\n                    //         }\r\n                    //     }\r\n                    //     wrap.choice.choiceDomManagerHandlers.updateSelected();\r\n                    //     onChangeAspect.onChange();\r\n                    // }\r\n                \r\n                \r\n                    function composeUpdateSelected(wrap, booleanValue){\r\n                        return () => {\r\n                            wrap.isOptionSelected = booleanValue;\r\n                            wrap.updateSelected();\r\n                        }\r\n                    }\r\n                \r\n                    function trySetWrapSelected(option, updateSelected, booleanValue){ //  wrap.option\r\n                        let success = false;\r\n                        var confirmed = setIsOptionSelected(option, booleanValue); \r\n                        if (!(confirmed===false)) {\r\n                            updateSelected(); \r\n                            success = true;\r\n                        }\r\n                        return success;\r\n                    }\r\n                \r\n                    let origCreateWrap = createWrapAspect.createWrap;\r\n                    createWrapAspect.createWrap = (option)=>{\r\n                        let wrap = origCreateWrap(option);\r\n                        wrap.isOptionSelected = getIsOptionSelected(option);\r\n                        wrap.updateSelected = null; // can it be combined ?\r\n                        return wrap;\r\n                    }\r\n                    \r\n                \r\n                    let origToggle = optionToggleAspect.toggle; // TODO: improve design, no replace\r\n                    optionToggleAspect.toggle= (wrap) => {\r\n                        return trySetWrapSelected(wrap.option, composeUpdateSelected(wrap, !wrap.isOptionSelected), !wrap.isOptionSelected)\r\n                    }\r\n                 \r\n                    let origFullMatch = fullMatchAspect.fullMatch;\r\n                    fullMatchAspect.fullMatch = (wrap) => {\r\n                        return trySetWrapSelected(wrap.option, composeUpdateSelected(wrap, true), true);\r\n                    }\r\n                \r\n                    let removePickOrig = removePickAspect.removePick; // TODO: improve design, no replace\r\n                    removePickAspect.removePick = (wrap, pick) => { // TODO: try remove pick\r\n                        return trySetWrapSelected(wrap.option, composeUpdateSelected(wrap, false), false);\r\n                    }\r\n                \r\n                    \r\n                    let origCreatePickHandlers =  createPickHandlersAspect.createPickHandlers;\r\n                    createPickHandlersAspect.createPickHandlers = (wrap)=>{\r\n                        let pickHandlers = origCreatePickHandlers(wrap);\r\n                        wrap.updateSelected = composeSync(\r\n                            ()=>{\r\n                                if (wrap.isOptionSelected){\r\n                                    let pick = pickHandlers.producePick();\r\n                                    wrap.pick = pick;\r\n                                    pick.dispose = composeSync(pick.dispose, ()=>{wrap.pick=null;});\r\n                                }\r\n                                else {\r\n                                    pickHandlers.removeAndDispose();\r\n                                    pickHandlers.removeAndDispose=null;\r\n                                }\r\n                            },\r\n                            wrap.updateSelected\r\n                        )\r\n                \r\n                        addPickAspect.addPick(wrap, pickHandlers); \r\n                        return pickHandlers;\r\n                    }\r\n                \r\n                    let origAddPick =  addPickAspect.addPick;\r\n                    addPickAspect.addPick = (wrap, pickHandlers) => {\r\n                        if (wrap.isOptionSelected){\r\n                            let pick = origAddPick(wrap, pickHandlers);\r\n                            wrap.pick = pick;\r\n                            pick.dispose = composeSync(pick.dispose, ()=>{wrap.pick=null;});\r\n                            return pick;\r\n                        }\r\n                    }\r\n                \r\n                \r\n                    return {\r\n                        buildApi(api){\r\n                            api.selectAll= ()=>{\r\n                                resetLayoutAspect.resetLayout(); // always hide 1st\r\n                                wrapsCollection.forLoop(\r\n                                    wrap => {\r\n                                        if (isChoiceSelectableAspect.isSelectable(wrap) &&  !wrap.isOptionSelected)\r\n                                            trySetWrapSelected(wrap.option, composeUpdateSelected(wrap, true), true)\r\n                                    }\r\n                                ); \r\n                            }\r\n                        \r\n                            api.deselectAll= ()=>{\r\n                                resetLayoutAspect.resetLayout(); // always hide 1st\r\n                                picksList.forEach(pick=>pick.setSelectedFalse())\r\n                            }\r\n                \r\n                            api.setOptionSelected = (key, value) => {\r\n                                let wrap = wrapsCollection.get(key);\r\n                                return trySetWrapSelected(wrap.option, composeUpdateSelected(wrap, value), value);\r\n                            }\r\n                \r\n                            // used in FormRestoreOnBackwardPlugin\r\n                            api.updateOptionsSelected = () => updateOptionsSelectedAspect.updateOptionsSelected();\r\n                            api.updateOptionSelected = (key) => updateChoiceSelected(wrapsCollection.get(key), getIsOptionSelected)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction UpdateOptionsSelectedAspect(wrapsCollection, getIsOptionSelected){\r\n    return {\r\n        updateOptionsSelected(){\r\n            wrapsCollection.forLoop( wrap => updateChoiceSelected(wrap, getIsOptionSelected));\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateChoiceSelected(wrap, getIsOptionSelected){\r\n    let newIsSelected = getIsOptionSelected(wrap.option);\r\n    if (newIsSelected != wrap.isOptionSelected)\r\n    {\r\n        wrap.isOptionSelected = newIsSelected;\r\n        wrap.updateSelected?.(); // some hidden oesn't have element (and need to be updated)\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\nexport function DisabledOptionPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {isChoiceSelectableAspect, createWrapAspect,  buildChoiceAspect,\r\n                        filterPredicateAspect, wrapsCollection, optionToggleAspect, buildPickAspect } = aspects;\r\n                    \r\n                    let {getIsOptionDisabled, options} = configuration;\r\n                    if (options) {\r\n                        if (!getIsOptionDisabled)\r\n                            getIsOptionDisabled = (option) => (option.disabled===undefined) ? false : option.disabled;     \r\n                    } else { // selectElement\r\n                        if (!getIsOptionDisabled)\r\n                            getIsOptionDisabled = (option) => option.disabled;\r\n                    }\r\n                \r\n                    // TODO check this instead of wrap.updateDisabled\r\n                    // function updateDisabled(wrap){\r\n                    //     wrap?.choice?.choiceDomManagerHandlers?.updateDisabled?.();\r\n                    //     wrap?.pick?.pickDomManagerHandlers?.updateDisabled?.();\r\n                    // }\r\n                \r\n                    let origCreateWrap = createWrapAspect.createWrap;\r\n                    createWrapAspect.createWrap = (option) => {\r\n                        let wrap = origCreateWrap(option);\r\n                        wrap.isOptionDisabled = getIsOptionDisabled(option); // TODO: remove usage wrap.isOptionDisabled\r\n                        wrap.updateDisabled = null; \r\n                        return wrap;\r\n                    };\r\n                \r\n                    let origToggle = optionToggleAspect.toggle;\r\n                    optionToggleAspect.toggle = (wrap) => {\r\n                        let success = false;\r\n                        if (wrap.isOptionSelected!==undefined){\r\n                            if (wrap.isOptionSelected || !wrap.isOptionDisabled) // TODO: declare dependency on SelectedOptionPlugin\r\n                                success = origToggle(wrap);\r\n                        }\r\n                        else{\r\n                            if (!wrap.isOptionDisabled) {\r\n                                success = origToggle(wrap);\r\n                            }\r\n                        }\r\n                        return success;\r\n                    };\r\n                \r\n                    let origIsSelectable = isChoiceSelectableAspect.isSelectable;\r\n                    isChoiceSelectableAspect.isSelectable = (wrap) => {\r\n                        return  origIsSelectable(wrap) && !wrap.isOptionDisabled;\r\n                    };\r\n                \r\n                    let origFilterPredicate = filterPredicateAspect.filterPredicate;\r\n                    filterPredicateAspect.filterPredicate = (wrap, text) => {\r\n                        return  !wrap.isOptionDisabled && origFilterPredicate(wrap, text) ;\r\n                    };\r\n                \r\n                    let origBuildChoice = buildChoiceAspect.buildChoice;\r\n                    buildChoiceAspect.buildChoice = (wrap) => {\r\n                        origBuildChoice(wrap);\r\n                        wrap.updateDisabled = wrap.choice.choiceDomManagerHandlers.updateDisabled\r\n                        wrap.choice.dispose = composeSync(()=>{wrap.updateDisabled=null;}, wrap.choice.dispose);\r\n                    }\r\n                    \r\n                    let origBuildPick = buildPickAspect.buildPick;\r\n                    buildPickAspect.buildPick = (wrap, removeOnButton) => {\r\n                        let pick = origBuildPick(wrap, removeOnButton);\r\n                        \r\n                        pick.updateDisabled = () => pick.pickDomManagerHandlers.updateDisabled();\r\n                        pick.dispose = composeSync(pick.dispose, ()=>{pick.updateDisabled=null});\r\n                \r\n                        let choiceUpdateDisabledBackup = wrap.updateDisabled;\r\n                        wrap.updateDisabled = composeSync(choiceUpdateDisabledBackup, pick.updateDisabled); // add pickDisabled\r\n                        pick.dispose = composeSync(pick.dispose, \r\n                            ()=>{\r\n                                wrap.updateDisabled = choiceUpdateDisabledBackup; // remove pickDisabled\r\n                                wrap.updateDisabled(); // make \"true disabled\" without it checkbox only looks disabled\r\n                            }\r\n                        )\r\n                        return pick;\r\n                    }\r\n                \r\n                    return {\r\n                        buildApi(api){\r\n                            api.updateOptionsDisabled = () => wrapsCollection.forLoop( wrap => updateChoiceDisabled(wrap, getIsOptionDisabled))\r\n                            api.updateOptionDisabled = (key) => updateChoiceDisabled(wrapsCollection.get(key), getIsOptionDisabled)\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateChoiceDisabled(wrap, getIsOptionDisabled){\r\n    let newIsDisabled = getIsOptionDisabled(wrap.option);\r\n    if (newIsDisabled != wrap.isOptionDisabled)\r\n    {\r\n        wrap.isOptionDisabled= newIsDisabled;\r\n        wrap.updateDisabled?.(); // some hidden oesn't have element (and need to be updated)\r\n    }\r\n}","export function PicksApiPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                layout: () => {\r\n                    let {picksList, createWrapAspect, createPickHandlersAspect, addPickAspect} = aspects;\r\n                    return {\r\n                        buildApi(api){\r\n                            api.forEachPeak = (f) => \r\n                                picksList.forEach(wrap=>f(wrap.option));\r\n                            // TODO: getHeadPeak\r\n                            api.getTailPeak = () => picksList.getTail()?.option;\r\n                            api.countPeaks = () => picksList.getCount();\r\n                            api.isEmptyPeaks = () => picksList.isEmpty();\r\n                            \r\n                            api.addPick = (option) => {\r\n                                let wrap = createWrapAspect.createWrap(option);\r\n                                // TODO should be moved to specific plugins\r\n                                wrap.updateDisabled = ()=>{};\r\n                                wrap.updateHidden = ()=>{};\r\n                                let pickHandlers = createPickHandlersAspect.createPickHandlers(wrap);\r\n                                addPickAspect.addPick(wrap, pickHandlers);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\nexport function PicksPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                plugStaticDom: ()=> {\r\n                    let {configuration, picksList} = aspects;\r\n                    let {picks} = configuration;\r\n                    if (picks) {\r\n                        let {add: origAdd, reset: origReset} = picksList;\r\n                    \r\n                        picksList.add = (e) => {\r\n                            let {remove, index} = origAdd(e);\r\n                            picks.push(e);\r\n                            return { remove: composeSync(remove, () => void picks.splice(index(), 1)), index};\r\n                        }\r\n                    \r\n                        picksList.reset = () => {\r\n                            origReset();\r\n                            picks.length = 0;\r\n                        }\r\n                    }\r\n        \t    },\r\n                layout: () => {\r\n                    let {inputAspect, filterDom, filterManagerAspect} = aspects;\r\n                    let {picks, addOptionPicked} = configuration;\r\n                    /*\r\n                    if (!addOptionPicked){\r\n                        addOptionPicked = (option, index, value) => {\r\n                            if (value)\r\n                                picks.push(option);\r\n                            else\r\n                                picks.splice(index, 1);\r\n                            return true;\r\n                        };\r\n                    }\r\n                \r\n                    function trySetWrapSelected(option, updateSelected, booleanValue){\r\n                        let success = false;\r\n                        var confirmed = setIsOptionSelected(option, booleanValue);\r\n                        if (!(confirmed===false)) {\r\n                            updateSelected();\r\n                            success = true;\r\n                        }\r\n                        return success;\r\n                    }\r\n                \r\n                    let origProcessInput = inputAspect.processInput;\r\n                    inputAspect.processInput = () => {\r\n                        let origResult = origProcessInput();\r\n                        if (!origResult.isEmpty)\r\n                        {\r\n                            if ( filterManagerAspect.getNavigateManager().getCount() == 1)\r\n                            {\r\n                                // todo: move exact match to filterManager\r\n                                let fullMatchWrap =  filterManagerAspect.getNavigateManager().getHead();\r\n                                let text = filterManagerAspect.getFilter();\r\n                                if (fullMatchWrap.choice.searchText == text)\r\n                                {\r\n                                    let success = trySetWrapSelected(fullMatchWrap, true);\r\n                                    if (success) {\r\n                                        filterDom.setEmpty();\r\n                                        origResult.isEmpty = true;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        return origResult;\r\n                    }*/\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\nexport function CreatePopperPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                plugStaticDom(){\r\n                    let {environment} = aspects;\r\n                    var popperRtlAspect = PopperRtlAspect();\r\n                    aspects.popperRtlAspect = popperRtlAspect;\r\n\r\n                    let {createPopper, Popper, globalPopper} = environment;\r\n                    let createModifiersVX = null;\r\n                    let createPopperVX = null;\r\n                    if (Popper) { // V2\r\n                        createPopperVX = createPopper =  (function(createPopperConstructor) {\r\n                            return function(anchorElement, element, popperConfiguration) {\r\n                                return new createPopperConstructor(anchorElement, element, popperConfiguration);\r\n                            }\r\n                        })(Popper);;\r\n                        createModifiersVX = CreateModifiersV1;\r\n                    } else if (createPopper) {\r\n                        createPopperVX = createPopper;\r\n                        createModifiersVX = CreateModifiersV2;\r\n                    } else if (globalPopper) {\r\n                        if (globalPopper.createPopper) {\r\n                            createPopperVX = globalPopper.createPopper;\r\n                            createModifiersVX = CreateModifiersV2;\r\n                        } else {\r\n                            createPopperVX = createPopper =  (function(createPopperConstructor) {\r\n                                return function(anchorElement, element, popperConfiguration) {\r\n                                    return new createPopperConstructor(anchorElement, element, popperConfiguration);\r\n                                }\r\n                            })(globalPopper);\r\n                            createModifiersVX = CreateModifiersV1;\r\n                        }\r\n                    } else {\r\n                        throw new Error(\"BsMultiSelect: Popper component (https://popper.js.org) is required\");\r\n                    }\r\n                    var createPopperConfigurationAspect = CreatePopperConfigurationAspect(createModifiersVX);\r\n                    aspects.createPopperAspect = CreatePopperAspect(createPopperVX, popperRtlAspect, createPopperConfigurationAspect); \r\n                },\r\n                attach(){\r\n                    let {createPopperAspect, filterDom, choicesDom, disposeAspect, staticManager, choicesVisibilityAspect, specialPicksEventsAspect} = aspects;\r\n                    CreatePopper_ConstrunctorAspect(createPopperAspect, filterDom, choicesDom, disposeAspect, staticManager, choicesVisibilityAspect, specialPicksEventsAspect);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction CreatePopper_ConstrunctorAspect(createPopperAspect, filterDom, choicesDom, disposeAspect, staticManager, choicesVisibilityAspect, specialPicksEventsAspect){\r\n    let filterInputElement = filterDom.filterInputElement;\r\n    let choicesElement     = choicesDom.choicesElement;\r\n\r\n    let pop = createPopperAspect.createPopper(choicesElement, filterInputElement, true);\r\n\r\n    staticManager.appendToContainer = composeSync(staticManager.appendToContainer, pop.init);\r\n\r\n    var origBackSpace = specialPicksEventsAspect.backSpace;\r\n    specialPicksEventsAspect.backSpace = (pick) => {origBackSpace(pick);  pop.update();};\r\n\r\n    disposeAspect.dispose = composeSync(disposeAspect.dispose, pop.dispose);\r\n\r\n    choicesVisibilityAspect.updatePopupLocation = composeSync(\r\n        choicesVisibilityAspect.updatePopupLocation, \r\n        function(){pop.update();}\r\n    );\r\n}\r\n\r\nfunction PopperRtlAspect(){\r\n    return {\r\n        getIsRtl(){\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// CreatePopperPlugin.attach = (aspects)=> {\r\n//     let {createPopperAspect, filterDom, choicesDom, disposeAspect, staticManager, choicesVisibilityAspect, specialPicksEventsAspect} = aspects;\r\n//     CreatePopper_ConstrunctorAspect(createPopperAspect, filterDom, choicesDom, disposeAspect, staticManager, choicesVisibilityAspect, specialPicksEventsAspect);\r\n// }\r\n\r\n// CreatePopperPlugin.plugStaticDom = (aspects) => {\r\n//     let {environment} = aspects;\r\n//     var popperRtlAspect = PopperRtlAspect();\r\n//     aspects.popperRtlAspect = popperRtlAspect;\r\n\r\n//     let {createPopper, Popper, globalPopper} = environment;\r\n//     let createModifiersVX = null;\r\n//     let createPopperVX = null;\r\n//     if (Popper) { // V2\r\n//         createPopperVX = createPopper =  (function(createPopperConstructor) {\r\n//             return function(anchorElement, element, popperConfiguration) {\r\n//                 return new createPopperConstructor(anchorElement, element, popperConfiguration);\r\n//             }\r\n//         })(Popper);;\r\n//         createModifiersVX = CreateModifiersV1;\r\n//     } else if (createPopper) {\r\n//         createPopperVX = createPopper;\r\n//         createModifiersVX = CreateModifiersV2;\r\n//     } else if (globalPopper) {\r\n//         if (globalPopper.createPopper) {\r\n//             createPopperVX = globalPopper.createPopper;\r\n//             createModifiersVX = CreateModifiersV2;\r\n//         } else {\r\n//             createPopperVX = createPopper =  (function(createPopperConstructor) {\r\n//                 return function(anchorElement, element, popperConfiguration) {\r\n//                     return new createPopperConstructor(anchorElement, element, popperConfiguration);\r\n//                 }\r\n//             })(globalPopper);\r\n//             createModifiersVX = CreateModifiersV1;\r\n//         }\r\n//     } else {\r\n//         throw new Error(\"BsMultiSelect: Popper component (https://popper.js.org) is required\");\r\n//     }\r\n//     var createPopperConfigurationAspect = CreatePopperConfigurationAspect(createModifiersVX);\r\n//     aspects.createPopperAspect = CreatePopperAspect(createPopperVX, popperRtlAspect, createPopperConfigurationAspect);\r\n// }\r\n\r\nfunction CreateModifiersV1(preventOverflow){\r\n    return {\r\n        preventOverflow: {enabled:preventOverflow},\r\n        hide: {enabled:false},\r\n        flip: {enabled:false}\r\n    };\r\n}\r\n\r\nfunction CreateModifiersV2(preventOverflow){\r\n    var modifiers = [{\r\n            name: 'flip',\r\n            options: {\r\n                fallbackPlacements: ['bottom'],\r\n            },\r\n        }\r\n    ];\r\n    if (preventOverflow) {\r\n        modifiers.push({name: 'preventOverflow'});\r\n    }\r\n    return modifiers;\r\n}\r\n\r\nfunction CreatePopperAspect(createPopperVX, popperRtlAspect, createPopperConfigurationAspect){\r\n    return {\r\n        createPopper(element, anchorElement, preventOverflow){\r\n            let popper = null;\r\n            return {\r\n                init(){\r\n                    var isRtl = popperRtlAspect.getIsRtl();\r\n                    var popperConfiguration = createPopperConfigurationAspect.createConfiguration(preventOverflow, isRtl);\r\n                    popper = createPopperVX(anchorElement, element, popperConfiguration); \r\n\r\n                },\r\n                update(){ \r\n                    popper.update(); // become async in popper 2; use forceUpdate if sync is needed? \r\n                },\r\n                dispose(){\r\n                    popper.destroy();\r\n                }\r\n            }\r\n        }\r\n    }   \r\n}\r\n\r\nfunction CreatePopperConfigurationAspect(createModifiersVX){\r\n    return {\r\n        createConfiguration(preventOverflow, isRtl){\r\n            let modifiers = createModifiersVX(preventOverflow);\r\n            \r\n            let popperConfiguration = {\r\n                placement: 'bottom-start',\r\n                modifiers: modifiers\r\n            };\r\n\r\n            if (isRtl){\r\n                popperConfiguration.placement = 'bottom-end';\r\n            }\r\n            return popperConfiguration;\r\n        }\r\n    }   \r\n}","// aka auto height and scrolling\r\nexport function ChoicesDynamicStylingPlugin(defaults){\r\n    defaults.useChoicesDynamicStyling = false;\r\n    defaults.choicesDynamicStyling = choicesDynamicStyling;\r\n    defaults.minimalChoicesDynamicStylingMaxHeight = 20;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {choicesDynamicStyling, useChoicesDynamicStyling} = configuration;\r\n                    if (useChoicesDynamicStyling) {\r\n                        let {choicesVisibilityAspect, specialPicksEventsAspect} = aspects;\r\n                        var origSetChoicesVisible = choicesVisibilityAspect.setChoicesVisible;\r\n                        choicesVisibilityAspect.setChoicesVisible = \r\n                            function(visible){\r\n                                if (visible)\r\n                                    choicesDynamicStyling(aspects);\r\n                                origSetChoicesVisible(visible);\r\n                            };\r\n                        var origBackSpace = specialPicksEventsAspect.backSpace;\r\n                        specialPicksEventsAspect.backSpace = (pick) => { origBackSpace(pick);  choicesDynamicStyling(aspects);};\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction choicesDynamicStyling(aspects){\r\n    let {configuration, environment, choicesDom, navigateAspect} = aspects;\r\n    let window = environment.window;\r\n    let choicesElement = choicesDom.choicesElement;\r\n    let minimalChoicesDynamicStylingMaxHeight = configuration.minimalChoicesDynamicStylingMaxHeight;\r\n\r\n    //find height of the browser window\r\n    var g = window.document.getElementsByTagName('body')[0],\r\n        e = window.document.documentElement,\r\n        y = window.innerHeight || e.clientHeight  || g.clientHeight;\r\n  \r\n    //find position of choicesElement, if it's at the bottom of the page make the choicesElement shorter\r\n    var pos = choicesElement.parentNode.getBoundingClientRect();\r\n    var new_y = y - pos.top;\r\n  \r\n    //calculate multi select max-height\r\n    var msHeight = Math.max(minimalChoicesDynamicStylingMaxHeight, Math.round((new_y * 0.85))); // Michalek: 0.85 is empiric value, without it list was longer than footer height ; TODO: propose better way\r\n  \r\n    //add css height value\r\n    choicesElement.style.setProperty(\"max-height\", msHeight+\"px\");\r\n    choicesElement.style.setProperty(\"overflow-y\", \"auto\");\r\n\r\n    if (!choicesDom.ChoicesDynamicStylingPlugin_scrollHandle){\r\n        choicesDom.ChoicesDynamicStylingPlugin_scrollHandle = true;\r\n        var origNavigateAspectNavigate = navigateAspect.navigate;\r\n        navigateAspect.navigate = function(down){\r\n            var wrap = origNavigateAspectNavigate(down);\r\n            if (wrap!= null && wrap.choice!=null && wrap.choice.choiceElement!=null)\r\n            wrap.choice.choiceElement.scrollIntoView(false); // alignTo false -  scroll to the top bottom of dropdown first\r\n            // TODO: BUG if mouse left on the dropdow scroll to bottom and one after doesn't work properly\r\n            return wrap;\r\n        }\r\n    }\r\n}\r\n","export function HighlightPlugin(defaults){\r\n    defaults.useHighlighting = false;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n\t            plugStaticDom: ()=> {\r\n                    if (configuration.useHighlighting)\r\n                        aspects.highlightAspect = HighlightAspect();\r\n        \t    },\r\n                plugStaticDomFactories: ()=> {\r\n                    var {choiceDomFactory, optionPropertiesAspect} = aspects;\r\n\r\n                    var origCreateChoiceDomFactory = choiceDomFactory.create;\r\n                    choiceDomFactory.create = (choiceElement, wrap, toggle) => {\r\n                        var value = origCreateChoiceDomFactory(choiceElement, wrap, toggle);\r\n                        value.choiceDomManagerHandlers.updateHighlighted = ()=>{\r\n                            var text = optionPropertiesAspect.getText(wrap.option);\r\n                            var highlighter = aspects.highlightAspect.getHighlighter();\r\n                            if (highlighter)\r\n                                highlighter(choiceElement, value.choiceDom, text);                    \r\n                            else\r\n                            choiceElement.textContent = text;\r\n                        };\r\n                        return value;\r\n                    }                    \r\n        \t    },\r\n                layout: () => {\r\n                    let {highlightAspect, filterManagerAspect,  buildChoiceAspect} = aspects;\r\n                    if (highlightAspect) {\r\n                          let origProcessEmptyInput = filterManagerAspect.processEmptyInput;\r\n                          filterManagerAspect.processEmptyInput = function(){\r\n                            highlightAspect.reset();\r\n                            origProcessEmptyInput(); \r\n                          }\r\n                          let origSetFilter = filterManagerAspect.setFilter;\r\n                          filterManagerAspect.setFilter = function(text){\r\n                            highlightAspect.set(text);\r\n                            origSetFilter(text);\r\n                          }\r\n                          let origBuildChoice = buildChoiceAspect.buildChoice;\r\n                          buildChoiceAspect.buildChoice = function(wrap){\r\n                              origBuildChoice(wrap);\r\n                              let origSetVisible =  wrap.choice.setVisible;\r\n                              wrap.choice.setVisible = function(v){\r\n                                origSetVisible(v);\r\n                                wrap.choice.choiceDomManagerHandlers.updateHighlighted();\r\n                              }\r\n                          }\r\n                      }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { composeSync } from \"../ToolsJs\";\r\n\r\nexport function CustomChoiceStylingsPlugin(defaults){\r\n    defaults.customChoiceStylings =  null;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n\t            plugStaticDom: ()=> {\r\n                    let {choiceDomFactory} = aspects;\r\n                    let customChoiceStylings = configuration.customChoiceStylings;\r\n                    let customChoiceStylingsAspect = CustomChoiceStylingsAspect(customChoiceStylings);\r\n                    ExtendChoiceDomFactory(choiceDomFactory, customChoiceStylingsAspect);\r\n        \t    }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ExtendChoiceDomFactory(choiceDomFactory, customChoiceStylingsAspect){\r\n    let origChoiceDomFactoryCreate = choiceDomFactory.create;\r\n    choiceDomFactory.create = function(choiceElement, wrap, toggle){\r\n        var o = origChoiceDomFactoryCreate(choiceElement, wrap, toggle);\r\n        customChoiceStylingsAspect.customize(wrap, o.choiceDom, o.choiceDomManagerHandlers);\r\n        return o;\r\n    }\r\n}\r\n\r\nfunction CustomChoiceStylingsAspect(customChoiceStylings){\r\n    return {\r\n        customize(wrap, choiceDom, choiceDomManagerHandlers){\r\n            if (customChoiceStylings){\r\n                var handlers = customChoiceStylings(choiceDom, wrap.option);\r\n\r\n                if (handlers){\r\n                    function customChoiceStylingsClosure(custom){\r\n                        return function() {\r\n                                custom({\r\n                                    isOptionSelected: wrap.isOptionSelected,\r\n                                    isOptionDisabled: wrap.isOptionDisabled,\r\n                                    isHoverIn: wrap.choice.isHoverIn,\r\n                                    //isHighlighted: wrap.choice.isHighlighted  // TODO isHighlighted should be developed\r\n                                });\r\n                        }\r\n                    }\r\n                    if (choiceDomManagerHandlers.updateHoverIn && handlers.updateHoverIn)  \r\n                        choiceDomManagerHandlers.updateHoverIn \r\n                            = composeSync(choiceDomManagerHandlers.updateHoverIn, customChoiceStylingsClosure(handlers.updateHoverIn) );\r\n                    if (choiceDomManagerHandlers.updateSelected && handlers.updateSelected)  \r\n                        choiceDomManagerHandlers.updateSelected \r\n                            = composeSync(choiceDomManagerHandlers.updateSelected, customChoiceStylingsClosure(handlers.updateSelected));\r\n                    if (choiceDomManagerHandlers.updateDisabled && handlers.updateDisabled)  \r\n                        choiceDomManagerHandlers.updateDisabled\r\n                            = composeSync(choiceDomManagerHandlers.updateDisabled, customChoiceStylingsClosure(handlers.updateDisabled));\r\n                    if (choiceDomManagerHandlers.updateHighlighted && handlers.updateHighlighted)  \r\n                        choiceDomManagerHandlers.updateHighlighted\r\n                            = composeSync(choiceDomManagerHandlers.updateHighlighted, customChoiceStylingsClosure(handlers.updateHighlighted));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { composeSync } from \"../ToolsJs\";\r\n\r\nexport function CustomPickStylingsPlugin(defaults){\r\n    defaults.customPickStylings = null;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n\t            plugStaticDom: ()=> {\r\n                    let {componentPropertiesAspect, pickDomFactory} = aspects;\r\n                    let customPickStylings = configuration.customPickStylings;\r\n                    let customPickStylingsAspect = CustomPickStylingsAspect(componentPropertiesAspect, customPickStylings);\r\n                    ExtendPickDomFactory(pickDomFactory, customPickStylingsAspect);\r\n        \t    }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ExtendPickDomFactory(pickDomFactory, customPickStylingsAspect){\r\n    \r\n    let origPickDomFactoryCreate = pickDomFactory.create;\r\n    pickDomFactory.create = function(pickElement, wrap, removeOnButton){\r\n        var o = origPickDomFactoryCreate(pickElement, wrap, removeOnButton);\r\n        customPickStylingsAspect.customize(wrap, o.pickDom, o.pickDomManagerHandlers);\r\n        return o;\r\n    }\r\n}\r\n\r\nfunction CustomPickStylingsAspect(componentPropertiesAspect, customPickStylings){\r\n    return {\r\n        customize(wrap, pickDom, pickDomManagerHandlers){\r\n            if (customPickStylings){\r\n                var handlers = customPickStylings(pickDom, wrap.option);\r\n\r\n                if (handlers){\r\n                    function customPickStylingsClosure(custom){\r\n                        return function() {\r\n                            custom({\r\n                                isOptionDisabled: wrap.isOptionDisabled,\r\n                                isComponentDisabled: componentPropertiesAspect.getDisabled()\r\n                            });\r\n                        }\r\n                    }\r\n                    if (pickDomManagerHandlers.updateDisabled && handlers.updateDisabled)  \r\n                        pickDomManagerHandlers.updateDisabled \r\n                            = composeSync(pickDomManagerHandlers.updateDisabled, customPickStylingsClosure(handlers.updateDisabled));\r\n                    if (pickDomManagerHandlers.updateComponentDisabled && handlers.updateComponentDisabled)  \r\n                        pickDomManagerHandlers.updateComponentDisabled \r\n                            = composeSync(pickDomManagerHandlers.updateComponentDisabled, customPickStylingsClosure(handlers.updateComponentDisabled));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\nexport function UpdateAppearancePlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                layout: () => {\r\n                    var {updateAppearanceAspect, updateAspect, loadAspect} = aspects;\r\n    \r\n                    updateAspect.update = composeSync(updateAspect.update, ()=>updateAppearanceAspect.updateAppearance())\r\n                    loadAspect.load = composeSync(loadAspect.load, ()=>updateAppearanceAspect.updateAppearance())\r\n\r\n                    return{\r\n                        buildApi(api){\r\n                            api.updateAppearance = ()=>updateAppearanceAspect.updateAppearance();\r\n                        }\r\n                    }\r\n                },\r\n                plugStaticDom: ()=> {\r\n                    aspects.updateAppearanceAspect = UpdateAppearanceAspect();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n// export function UpdateAppearancePlugin(aspects){\r\n//     var {updateAppearanceAspect, updateAspect, loadAspect} = aspects;\r\n    \r\n//     updateAspect.update = composeSync(updateAspect.update, ()=>updateAppearanceAspect.updateAppearance())\r\n//     loadAspect.load = composeSync(loadAspect.load, ()=>updateAppearanceAspect.updateAppearance())\r\n\r\n//     return{\r\n//         buildApi(api){\r\n//             api.updateAppearance = ()=>updateAppearanceAspect.updateAppearance();\r\n//         }\r\n//     }\r\n// }\r\n\r\n// UpdateAppearancePlugin.plugStaticDom = (aspects) => {\r\n//     aspects.updateAppearanceAspect = UpdateAppearanceAspect();\r\n// }\r\n\r\nfunction UpdateAppearanceAspect(){\r\n    return {\r\n        updateAppearance(){}\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\n\r\nexport function DisableComponentPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                plugStaticDomFactories: () => {\r\n                    var {pickDomFactory, componentPropertiesAspect} = aspects;\r\n\r\n                    var origCreatePickDomFactory = pickDomFactory.create;\r\n                    pickDomFactory.create = (pickElement, wrap, remove) => {\r\n                        var value = origCreatePickDomFactory(pickElement, wrap, remove);\r\n                        value.pickDomManagerHandlers.updateComponentDisabled = () => {\r\n                            value.pickDom.pickButtonElement.disabled = componentPropertiesAspect.getDisabled()\r\n                        };\r\n                        return value;\r\n                    }\r\n                },\r\n                layout: () => {\r\n                    var {updateAppearanceAspect, picksList, picksDom, componentPropertiesAspect, picksElementAspect} = aspects;\r\n    \r\n                    var origOnClick = picksElementAspect.onClick;\r\n                    \r\n                    var disableComponent = (isComponentDisabled)=>{\r\n                        picksList.forEach(pick=>pick.pickDomManagerHandlers.updateComponentDisabled())\r\n                        picksDom.disable(isComponentDisabled);\r\n                    }\r\n                \r\n                    picksElementAspect.onClick = (handler)=>{\r\n                        disableComponent = (isComponentDisabled)=>{\r\n                            picksList.forEach(pick=>pick.pickDomManagerHandlers.updateComponentDisabled())\r\n                            picksDom.disable(isComponentDisabled);\r\n                            if (isComponentDisabled)\r\n                                picksElementAspect.onClickUnbind(); //componentDisabledEventBinder.unbind();\r\n                            else\r\n                                origOnClick(handler); //componentDisabledEventBinder.bind(picksElement, \"click\",  handler); \r\n                        }\r\n                    } \r\n                \r\n                    let isComponentDisabled; // state! \r\n                    function updateDisabled(){\r\n                        let newIsComponentDisabled = componentPropertiesAspect.getDisabled();\r\n                        if (isComponentDisabled!==newIsComponentDisabled){\r\n                            isComponentDisabled=newIsComponentDisabled;\r\n                            disableComponent(newIsComponentDisabled);\r\n                        }\r\n                    }\r\n                \r\n                    updateAppearanceAspect.updateAppearance = composeSync(updateAppearanceAspect.updateAppearance,  updateDisabled);\r\n                \r\n                    return{\r\n                        buildApi(api){\r\n                            api.updateDisabled = updateDisabled;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {composeSync} from '../ToolsJs';\r\nimport {getDataGuardedWithPrefix} from '../ToolsDom';\r\nimport {toggleStyling} from '../ToolsStyling';\r\nimport {ResetableFlag} from '../ToolsDom'\r\n\r\nexport function PlaceholderPlugin(){\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {staticManager, picksList, picksDom, filterDom, staticDom, updateDataAspect,\r\n                        resetFilterListAspect, filterManagerAspect, environment} = aspects;\r\n                    let isIE11 = environment.isIE11;\r\n                    let {placeholder,  css} = configuration;\r\n                    let {picksElement} = picksDom;\r\n                    let filterInputElement = filterDom.filterInputElement;\r\n                \r\n                    function setPlaceholder(placeholder){\r\n                        filterInputElement.placeholder = placeholder;\r\n                    }\r\n                    if (isIE11){\r\n                        var ignoreNextInputResetableFlag = ResetableFlag(); \r\n                        let placeholderStopInputAspect = PlaceholderStopInputAspect(ignoreNextInputResetableFlag);\r\n                        var setPlaceholderOrig = setPlaceholder;\r\n                        setPlaceholder = function(placeholder){\r\n                            ignoreNextInputResetableFlag.set();\r\n                            setPlaceholderOrig(placeholder);\r\n                        }\r\n                        var origOnInput = filterDom.onInput;\r\n                        filterDom.onInput = (handler) => {\r\n                            origOnInput(\r\n                                ()=>{if (placeholderStopInputAspect.get()){\r\n                                    placeholderStopInputAspect.reset();\r\n                                } else {\r\n                                    handler();\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                \r\n                    if (!placeholder){\r\n                        placeholder = getDataGuardedWithPrefix(staticDom.initialElement,\"bsmultiselect\",\"placeholder\");\r\n                    }\r\n                \r\n                    function setEmptyInputWidth(isVisible){\r\n                        if(isVisible)\r\n                            filterInputElement.style.width ='100%';\r\n                        else \r\n                            filterInputElement.style.width ='2ch';\r\n                    }\r\n                    var emptyToggleStyling = toggleStyling(filterInputElement, css.filterInput_empty);\r\n                    function showPlacehodler(isVisible){\r\n                        if (isVisible)\r\n                        {\r\n                            setPlaceholder(placeholder?placeholder:'');\r\n                            picksElement.style.display = 'block';\r\n                        }\r\n                        else\r\n                        {\r\n                            setPlaceholder('');\r\n                            picksElement.style.display = 'flex';\r\n                        }\r\n                        emptyToggleStyling(isVisible);\r\n                        setEmptyInputWidth(isVisible);\r\n                    }\r\n                    showPlacehodler(true);\r\n                   \r\n                    function setDisabled(isComponentDisabled){ \r\n                        filterInputElement.disabled = isComponentDisabled;\r\n                    };\r\n                    let isEmpty = () => picksList.isEmpty() && filterDom.isEmpty()\r\n                \r\n                    function updatePlacehodlerVisibility(){\r\n                        showPlacehodler(isEmpty());\r\n                    };\r\n                    function updateEmptyInputWidth(){\r\n                        setEmptyInputWidth(isEmpty())\r\n                    };\r\n                    \r\n                    let origDisable = picksDom.disable;\r\n                    picksDom.disable = (isComponentDisabled)=>{\r\n                        setDisabled(isComponentDisabled);\r\n                        origDisable(isComponentDisabled);\r\n                    };\r\n                \r\n                    staticManager.appendToContainer = composeSync(staticManager.appendToContainer, updateEmptyInputWidth);\r\n                \r\n                    filterManagerAspect.processEmptyInput = composeSync(updateEmptyInputWidth, filterManagerAspect.processEmptyInput);\r\n                    resetFilterListAspect.forceResetFilter = composeSync(resetFilterListAspect.forceResetFilter, updatePlacehodlerVisibility);\r\n                            \r\n                    let origAdd = picksList.add;\r\n                    picksList.add = (pick) => { \r\n                        let returnValue = origAdd(pick);\r\n                        if (picksList.getCount()==1 ){ // make flex\r\n                            if (filterDom.isEmpty()){\r\n                                setPlaceholder('');\r\n                                picksElement.style.display = 'flex';\r\n                                emptyToggleStyling(false);\r\n                                filterInputElement.style.width ='2ch';\r\n                            } else {\r\n                                picksElement.style.display = 'flex';\r\n                            }\r\n                        }\r\n                        pick.dispose = composeSync(pick.dispose, function()\r\n                            { \r\n                                if (isEmpty()) {\r\n                                    showPlacehodler(true);\r\n                                }\r\n                            });\r\n                        return returnValue;\r\n                    };\r\n                \r\n                    updateDataAspect.updateData = composeSync(updateDataAspect.updateData, updatePlacehodlerVisibility);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n// ie11 support\r\nfunction PlaceholderStopInputAspect(resetableFlag){\r\n    return{\r\n        get(){\r\n            return resetableFlag.get();\r\n        },\r\n        reset(){\r\n            return resetableFlag.reset();\r\n        }             \r\n    }\r\n}","export function PlaceholderCssPatchPlugin(defaults){\r\n    defaults.cssPatch.filterInput_empty= 'form-control'\r\n}","import {composeSync} from '../ToolsJs';\r\nimport {toggleStyling} from '../ToolsStyling';\r\n\r\nexport function FloatingLabelPlugin(defaults){\r\n    defaults.css.label_floating_lifted = 'floating-lifted';\r\n    defaults.css.picks_floating_lifted = 'floating-lifted';            \r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                plugStaticDom: (aspects)=> {\r\n                    aspects.floatingLabelAspect = FloatingLabelAspect();\r\n        \t    },\r\n                layout: () => {\r\n                    let {picksList, picksDom, filterDom, \r\n                        updateDataAspect, resetFilterListAspect, floatingLabelAspect, labelAspect} = aspects;\r\n                   let {css} = configuration;\r\n                   \r\n                   if (floatingLabelAspect.isFloatingLabel() ){\r\n                       let labelElement = labelAspect.getLabel(); \r\n                       let picksElement = picksDom.picksElement;\r\n               \r\n                       var liftToggleStyling1 = toggleStyling(labelElement, css.label_floating_lifted);\r\n                       var liftToggleStyling2 = toggleStyling(picksElement, css.picks_floating_lifted);\r\n               \r\n                       function liftedLabel(isEmpty){\r\n                           liftToggleStyling1(isEmpty);\r\n                           liftToggleStyling2(isEmpty);\r\n                       }\r\n               \r\n                       let isEmpty = () => picksList.isEmpty() && filterDom.isEmpty() && !picksDom.getIsFocusIn();;\r\n               \r\n                       function updateLiftedLabel(){\r\n                           liftedLabel(!isEmpty());\r\n                       };\r\n               \r\n                       updateLiftedLabel();\r\n               \r\n                       resetFilterListAspect.forceResetFilter = composeSync(resetFilterListAspect.forceResetFilter, updateLiftedLabel);\r\n                           \r\n                       let origAdd = picksList.add;\r\n                       picksList.add = (pick) => { \r\n                           let returnValue = origAdd(pick);\r\n                           if (picksList.getCount()==1) \r\n                               updateLiftedLabel()\r\n                           pick.dispose = composeSync(pick.dispose, ()=>\r\n                               { \r\n                                   if (picksList.getCount()==0) \r\n                                       updateLiftedLabel()\r\n                               })\r\n                           return returnValue;\r\n                       };\r\n                   \r\n                       var origToggleFocusStyling = picksDom.toggleFocusStyling;\r\n                       picksDom.toggleFocusStyling = () => {\r\n                           var isFocusIn = picksDom.getIsFocusIn();\r\n                           origToggleFocusStyling(isFocusIn);\r\n                           updateLiftedLabel();\r\n                       }\r\n               \r\n                       updateDataAspect.updateData = composeSync(updateDataAspect.updateData, updateLiftedLabel);\r\n                   }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// export function FloatingLabelPlugin(aspects){\r\n//     let {configuration, picksList, picksDom, filterDom, \r\n//          updateDataAspect, resetFilterListAspect, floatingLabelAspect, labelAspect} = aspects;\r\n//     let {css} = configuration;\r\n    \r\n//     if (floatingLabelAspect.isFloatingLabel() ){\r\n//         let labelElement = labelAspect.getLabel(); \r\n//         let picksElement = picksDom.picksElement;\r\n\r\n//         var liftToggleStyling1 = toggleStyling(labelElement, css.label_floating_lifted);\r\n//         var liftToggleStyling2 = toggleStyling(picksElement, css.picks_floating_lifted);\r\n\r\n//         function liftedLabel(isEmpty){\r\n//             liftToggleStyling1(isEmpty);\r\n//             liftToggleStyling2(isEmpty);\r\n//         }\r\n\r\n//         let isEmpty = () => picksList.isEmpty() && filterDom.isEmpty() && !picksDom.getIsFocusIn();;\r\n\r\n//         function updateLiftedLabel(){\r\n//             liftedLabel(!isEmpty());\r\n//         };\r\n\r\n//         updateLiftedLabel();\r\n\r\n//         resetFilterListAspect.forceResetFilter = composeSync(resetFilterListAspect.forceResetFilter, updateLiftedLabel);\r\n            \r\n//         let origAdd = picksList.add;\r\n//         picksList.add = (pick) => { \r\n//             let returnValue = origAdd(pick);\r\n//             if (picksList.getCount()==1) \r\n//                 updateLiftedLabel()\r\n//             pick.dispose = composeSync(pick.dispose, ()=>\r\n//                 { \r\n//                     if (picksList.getCount()==0) \r\n//                         updateLiftedLabel()\r\n//                 })\r\n//             return returnValue;\r\n//         };\r\n    \r\n//         var origToggleFocusStyling = picksDom.toggleFocusStyling;\r\n//         picksDom.toggleFocusStyling = () => {\r\n//             var isFocusIn = picksDom.getIsFocusIn();\r\n//             origToggleFocusStyling(isFocusIn);\r\n//             updateLiftedLabel();\r\n//         }\r\n\r\n//         updateDataAspect.updateData = composeSync(updateDataAspect.updateData, updateLiftedLabel);\r\n//     }\r\n// }\r\n\r\n// FloatingLabelPlugin.plugDefaultConfig = (defaults) => {\r\n//     defaults.css.label_floating_lifted = 'floating-lifted';\r\n//     defaults.css.picks_floating_lifted = 'floating-lifted';\r\n// }\r\n\r\n// FloatingLabelPlugin.plugStaticDom = (aspects) => {\r\n//     aspects.floatingLabelAspect = FloatingLabelAspect();\r\n// }\r\n\r\nfunction FloatingLabelAspect() {\r\n    return {\r\n        isFloatingLabel(){},\r\n    }\r\n}\r\n\r\n\r\n","export function WarningCssPatchPlugin(defaults){\r\n    defaults.cssPatch.warning = {paddingLeft: '.25rem', paddingRight: '.25rem', zIndex: 4,  fontSize:'small', backgroundColor: 'var(--bs-warning)'}\r\n}\r\n","import {addStyling} from \"../ToolsStyling\";\r\nimport {composeSync} from '../ToolsJs';\r\n\r\nconst defNoResultsWarningMessage = 'No results found';\r\n\r\nexport function WarningPlugin(defaults){\r\n    defaults.noResultsWarning = defNoResultsWarningMessage;\r\n    defaults.isNoResultsWarningEnabled = false;\r\n    return {\r\n        buildAspects: (aspects, configuration) => {\r\n            return {\r\n                layout: () => {\r\n                    let {choicesDom, createElementAspect, staticManager, afterInputAspect, filterManagerAspect, resetLayoutAspect} = aspects;\r\n                    let {css, noResultsWarning} = configuration;\r\n\r\n                    if (configuration.isNoResultsWarningEnabled){\r\n                        let warningAspect = WarningAspect(choicesDom, createElementAspect, staticManager, css);\r\n                        aspects.warningAspect = warningAspect;\r\n                    \r\n                        ExtendAfterInputAspect(afterInputAspect, warningAspect, filterManagerAspect, noResultsWarning);\r\n                    \r\n                        resetLayoutAspect.resetLayout = composeSync(() => warningAspect.hide(), resetLayoutAspect.resetLayout);\r\n                    }\r\n                },\r\n                attach: ()=> {\r\n                    let {createPopperAspect, filterDom, warningAspect, staticManager, disposeAspect} = aspects;\r\n                    if (warningAspect){\r\n                        let filterInputElement = filterDom.filterInputElement;\r\n                        \r\n                        let pop2 = createPopperAspect.createPopper(warningAspect.warningElement, filterInputElement, false);\r\n                        staticManager.appendToContainer = composeSync(staticManager.appendToContainer, pop2.init);\r\n                        \r\n                        var origWarningAspectShow = warningAspect.show;\r\n                        warningAspect.show = (msg) => {\r\n                            pop2.update();\r\n                            origWarningAspectShow(msg);\r\n                        }\r\n                        disposeAspect.dispose = composeSync(disposeAspect.dispose, pop2.dispose);      \r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ExtendAfterInputAspect(afterInputAspect, warningAspect, filterManagerAspect, noResultsWarning){\r\n    var origVisible = afterInputAspect.visible;\r\n    afterInputAspect.visible = (showChoices, visibleCount) => {\r\n        warningAspect.hide(); \r\n        origVisible(showChoices, visibleCount)\r\n    }\r\n\r\n    var origNotVisible = afterInputAspect.notVisible;\r\n    afterInputAspect.notVisible = (hideChoices) => {\r\n        origNotVisible(hideChoices);\r\n    \r\n        if (filterManagerAspect.getFilter())\r\n            warningAspect.show(noResultsWarning); \r\n        else\r\n            warningAspect.hide();\r\n    }\r\n}\r\n\r\nfunction WarningAspect(choicesDom, createElementAspect, staticManager, css){\r\n    let choicesElement = choicesDom.choicesElement;\r\n\r\n    var warningElement = createElementAspect.createElement('DIV'); \r\n    \r\n    var origAppendToContainer = staticManager.appendToContainer;\r\n    staticManager.appendToContainer = function(){\r\n        origAppendToContainer();\r\n        choicesElement.parentNode.insertBefore(warningElement, choicesElement.nextSibling); // insert after\r\n    }\r\n\r\n    warningElement.style.display = 'none';\r\n    addStyling(warningElement, css.warning);\r\n\r\n\r\n    return {\r\n        warningElement,\r\n        show(message){\r\n            warningElement.style.display = 'block';\r\n            warningElement.innerHTML = message;\r\n        },\r\n        hide(){\r\n            warningElement.style.display = 'none';\r\n            warningElement.innerHTML = \"\";\r\n        }\r\n    }\r\n}","import {\r\n    BsAppearanceBs4Plugin, BsAppearanceBs5Plugin, \r\n    \r\n    CssPatchBs4Plugin, CssPatchBs5Plugin,\r\n    BsAppearanceBs4CssPatchPlugin, BsAppearanceBs5CssPatchPlugin,\r\n    \r\n    SelectElementPlugin, \r\n    LabelForAttributePlugin, ValidationApiPlugin, \r\n    UpdateAppearancePlugin, \r\n    \r\n    DisableComponentPlugin,\r\n    FormResetPlugin, CreatePopperPlugin,  RtlPlugin,  PlaceholderPlugin, PlaceholderCssPatchPlugin, \r\n     OptionsApiPlugin, \r\n    JQueryMethodsPlugin, \r\n    SelectedOptionPlugin, FormRestoreOnBackwardPlugin, \r\n    DisabledOptionPlugin, PicksApiPlugin, HighlightPlugin,\r\n    ChoicesDynamicStylingPlugin, CustomPickStylingsPlugin, CustomChoiceStylingsPlugin,\r\n    \r\n    FloatingLabelPlugin, FloatingLabelCssPatchBs5Plugin, \r\n    \r\n    WarningCssPatchPlugin, WarningBs4Plugin, WarningBs5Plugin,\r\n\r\n    PicksPlugin,\r\n\r\n    HiddenOptionPlugin,\r\n    /*HiddenOptionAltPlugin as HiddenOptionPlugin*/} from './plugins/index'\r\n\r\nimport {shallowClearClone} from './ToolsJs'\r\n\r\n\r\nexport let Bs4PluginSet = {BsAppearanceBs4Plugin, WarningBs4Plugin, CssPatchBs4Plugin, BsAppearanceBs4CssPatchPlugin }\r\n\r\nexport let Bs5PluginSet = {BsAppearanceBs5Plugin, WarningBs5Plugin, CssPatchBs5Plugin, BsAppearanceBs5CssPatchPlugin, FloatingLabelCssPatchBs5Plugin }\r\n\r\nexport let multiSelectPlugins = {SelectElementPlugin, \r\n    LabelForAttributePlugin, HiddenOptionPlugin, ValidationApiPlugin, \r\n    UpdateAppearancePlugin, \r\n    DisableComponentPlugin,\r\n    FormResetPlugin, CreatePopperPlugin, WarningCssPatchPlugin, RtlPlugin,  PlaceholderPlugin, PlaceholderCssPatchPlugin, FloatingLabelPlugin,  OptionsApiPlugin, \r\n    JQueryMethodsPlugin, \r\n    SelectedOptionPlugin, FormRestoreOnBackwardPlugin, \r\n    DisabledOptionPlugin, PicksApiPlugin, HighlightPlugin,\r\n    ChoicesDynamicStylingPlugin, CustomPickStylingsPlugin, CustomChoiceStylingsPlugin};\r\n\r\nexport let picksPlugins = {PicksPlugin, \r\n    LabelForAttributePlugin, ValidationApiPlugin, \r\n    UpdateAppearancePlugin, \r\n    DisableComponentPlugin, \r\n    CreatePopperPlugin, WarningCssPatchPlugin, RtlPlugin,  PlaceholderPlugin, PlaceholderCssPatchPlugin, FloatingLabelPlugin, OptionsApiPlugin, \r\n    JQueryMethodsPlugin, PicksApiPlugin, HighlightPlugin,\r\n    ChoicesDynamicStylingPlugin, CustomPickStylingsPlugin, CustomChoiceStylingsPlugin};\r\n\r\nexport let allPlugins =  shallowClearClone(multiSelectPlugins, {PicksPlugin});\r\n\r\n\r\n\r\n\r\n// var defaultConfig = {\r\n//     plugins: multiSelectPlugins\r\n// }\r\n\r\n// var picksConfig = {\r\n//     plugins: picksPlugins\r\n// }\r\n\r\n// export function createConfig(arg){\r\n//     return config;\r\n// }","import {WarningPlugin} from './WarningPlugin';\r\n\r\nexport function WarningBs5Plugin(defaults){\r\n    defaults.css.warning = 'alert-warning';\r\n    return WarningPlugin(defaults);\r\n}\r\n\r\n","import {CssPatchPlugin} from './CssPatchPlugin';\r\n\r\nimport {PickDomFactoryPlugCssPatch, PickDomFactoryPlugCssPatchBs5} from '../PickDomFactory'\r\nimport {PicksDomFactoryPlugCssPatch, PicksDomFactoryPlugCssPatchBs5} from '../PicksDomFactory'\r\nimport {ChoiceDomFactoryPlugCssPatch} from '../ChoiceDomFactory'\r\nimport {ChoicesDomFactoryPlugCssPatch} from '../ChoicesDomFactory'\r\nimport {FilterDomFactoryPlugCssPatch} from '../FilterDomFactory'\r\n\r\n\r\nexport function CssPatchBs5Plugin(defaults){\r\n    var cssPatch = {};\r\n    \r\n    PickDomFactoryPlugCssPatch(cssPatch);\r\n    PickDomFactoryPlugCssPatchBs5(cssPatch);\r\n    PicksDomFactoryPlugCssPatch(cssPatch);\r\n    PicksDomFactoryPlugCssPatchBs5(cssPatch);\r\n    ChoiceDomFactoryPlugCssPatch(cssPatch);\r\n    ChoicesDomFactoryPlugCssPatch(cssPatch);\r\n    FilterDomFactoryPlugCssPatch(cssPatch);\r\n\r\n    defaults.cssPatch = cssPatch;\r\n    return CssPatchPlugin(defaults)\r\n}","export function BsAppearanceBs5CssPatchPlugin(defaults){\r\n    let cssPatch = defaults.cssPatch;\r\n    cssPatch.picks_def = {minHeight: 'calc(2.25rem + 2px)'};\r\n    cssPatch.picks_lg = {minHeight: 'calc(2.875rem + 2px)'};\r\n    cssPatch.picks_sm = {minHeight: 'calc(1.8125rem + 2px)'};\r\n    cssPatch.picks_floating_def = {minHeight: 'calc(3.5rem + 2px)'};\r\n\r\n    cssPatch.picks_focus_valid = {borderColor: '',  boxShadow: '0 0 0 0.2rem rgba(40, 167, 69, 0.25)'};\r\n    cssPatch.picks_focus_invalid = {borderColor: '', boxShadow: '0 0 0 0.2rem rgba(220, 53, 69, 0.25)'};            \r\n}","export function FloatingLabelCssPatchBs5Plugin(defaults){\r\n    let cssPatch = defaults.cssPatch;\r\n    cssPatch.label_floating_lifted = {opacity: '.65', transform : 'scale(.85) translateY(-.5rem) translateX(.15rem)'};\r\n    cssPatch.picks_floating_lifted = {paddingTop: '1.625rem', paddingLeft:'0.8rem', paddingBottom : '0'};\r\n}","import {closestByTagName, findDirectChildByTagName, closestByClassName} from '../ToolsDom';\r\nimport {composeSync} from '../ToolsJs';\r\n\r\nexport function SelectElementPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                plugStaticDom: ()=> {\r\n                        let {configuration, staticDomFactory, createElementAspect,\r\n                            componentPropertiesAspect, onChangeAspect, triggerAspect, optionsAspect, optGroupAspect, disposeAspect} = aspects;\r\n                            \r\n                        let origStaticDomFactoryCreate = staticDomFactory.create;\r\n                        staticDomFactory.create = (choicesDomFactory, filterDomFactory, picksDomFactory) => {\r\n                            let {createStaticDom: origCreateStaticDom} = origStaticDomFactoryCreate(choicesDomFactory, filterDomFactory, picksDomFactory);\r\n                            return { \r\n                                createStaticDom(element, containerClass){\r\n                                    console.log(\"createStaticDom\");\r\n                                    let selectElement = null;\r\n                                    let containerElement = null;\r\n                                    let picksElement = null;\r\n                                    if (element.tagName == 'SELECT') {\r\n                                        selectElement = element;\r\n                                        if (containerClass){\r\n                                            containerElement = closestByClassName(selectElement, containerClass)\r\n                                            if (containerElement)\r\n                                                picksElement = findDirectChildByTagName(containerElement, 'UL');\r\n                                        }\r\n                                    } else if (element.tagName == 'DIV') {\r\n                                        selectElement = findDirectChildByTagName(element, 'SELECT');\r\n                                        if (selectElement) {\r\n                                            if (containerClass){\r\n                                                containerElement = closestByClassName(element, containerClass);\r\n                                                if (containerElement)\r\n                                                    picksElement = findDirectChildByTagName(containerElement, 'UL');\r\n                                            }\r\n                                        } else {\r\n                                            return origCreateStaticDom(element, containerClass);\r\n                                        } \r\n                                    }\r\n                    \r\n                                    let disposableContainerElement = false;\r\n                                    if (!containerElement) {\r\n                                        containerElement = createElementAspect.createElement('DIV');\r\n                                        containerElement.classList.add(containerClass);\r\n                                        disposableContainerElement= true;\r\n                                    }\r\n                                \r\n                                    let isDisposablePicksElement = false;\r\n                                    if (!picksElement) {\r\n                                        picksElement = createElementAspect.createElement('UL');\r\n                                        isDisposablePicksElement = true; \r\n                                    }\r\n                                \r\n                                    if (selectElement){\r\n                                        var backupDisplay = selectElement.style.display;\r\n                                        selectElement.style.display = 'none';\r\n                                        var backupedRequired = selectElement.required;\r\n                    \r\n                                        configuration.getValueRequired = function(){\r\n                                            return backupedRequired;\r\n                                        }\r\n                    \r\n                                        if(selectElement.required===true)\r\n                                            selectElement.required = false;\r\n                    \r\n                                        let {getDisabled} = configuration;\r\n                    \r\n                                        if(!getDisabled) {\r\n                                            var fieldsetElement = closestByTagName(selectElement, 'FIELDSET');\r\n                                            if (fieldsetElement) {\r\n                                                componentPropertiesAspect.getDisabled = () => selectElement.disabled || fieldsetElement.disabled;\r\n                                            } else {\r\n                                                componentPropertiesAspect.getDisabled = () => selectElement.disabled;\r\n                                            }\r\n                                        }\r\n                                        onChangeAspect.onChange = composeSync(() => triggerAspect.trigger('change'), onChangeAspect.onChange) \r\n                                        optionsAspect.getOptions = () => selectElement.options;\r\n                                        \r\n                                        if (optGroupAspect){\r\n                                            optGroupAspect.getOptionOptGroup = (option) => option.parentNode;\r\n                                            optGroupAspect.getOptGroupText   = (optGroup) => optGroup.label;\r\n                                            optGroupAspect.getOptGroupId = (optGroup) => optGroup.id;\r\n                                        }\r\n                    \r\n                                        if (aspects.labelNewIdAspect){\r\n                                            console.log(\"new aspects.labelNewIdAspect\");\r\n                                            aspects.labelNewIdAspect.createInputId = () => `${containerClass}-generated-input-${((selectElement.id)?selectElement.id:selectElement.name).toLowerCase()}-id`;\r\n                                        } else {\r\n                                            console.log(\"no new aspects.labelNewIdAspect\");\r\n                                        }\r\n                    \r\n                                        disposeAspect.dispose = composeSync(disposeAspect.dispose, () => {\r\n                                             selectElement.required = backupedRequired;\r\n                                             selectElement.style.display = backupDisplay;\r\n                                        });\r\n                                    }\r\n                                    let choicesDom = choicesDomFactory.create();\r\n                                    let filterDom = filterDomFactory.create(isDisposablePicksElement);\r\n                                    let picksDom  = picksDomFactory.create(picksElement, isDisposablePicksElement);\r\n                    \r\n                                    let {choicesElement} = choicesDom; \r\n                                    \r\n                                    return {\r\n                                        choicesDom,\r\n                                        filterDom,\r\n                                        picksDom,\r\n                    \r\n                                        staticDom:{\r\n                                                initialElement:element,\r\n                                                containerElement,\r\n                                                picksElement,\r\n                                                isDisposablePicksElement,\r\n                                                selectElement\r\n                                        }, \r\n                    \r\n                                        staticManager:{\r\n                                            appendToContainer(){ \r\n                                                if (disposableContainerElement){\r\n                                                    selectElement.parentNode.insertBefore(containerElement, selectElement.nextSibling) \r\n                                                    containerElement.appendChild(choicesElement)\r\n                                                }else {\r\n                                                    selectElement.parentNode.insertBefore(choicesElement, selectElement.nextSibling)\r\n                                                }\r\n                                                if (isDisposablePicksElement)\r\n                                                    containerElement.appendChild(picksElement)\r\n                                            },\r\n                                            dispose(){ \r\n                                                choicesElement.parentNode.removeChild(choicesElement);\r\n                                                if (disposableContainerElement)\r\n                                                    selectElement.parentNode.removeChild(containerElement) \r\n                                                if (isDisposablePicksElement)\r\n                                                    containerElement.removeChild(picksElement)\r\n                                            }\r\n                                        }\r\n                                    };\r\n                                }\r\n                            }\r\n                        }\r\n                    \r\n                },\r\n                layout: ()=>{\r\n                    var {loadAspect, environment} = aspects;\r\n                    var document = environment.window.document;\r\n\r\n                    var origLoadAspectLoop  = loadAspect.loop;\r\n                    loadAspect.loop = function(){\r\n                        // browsers can change select value as part of \"autocomplete\" (IE11) at load time\r\n                        // or \"show preserved on go back\" (Chrome) after page is loaded but before \"ready\" event;\r\n                        // mote: they never \"restore\" selected-disabled options.\r\n                        // TODO: make the FROM Validation for 'selected-disabled' easy.\r\n                        if (document.readyState != 'loading'){\r\n                            origLoadAspectLoop();\r\n                        }else{\r\n                            var domContentLoadedHandler = function(){\r\n                                origLoadAspectLoop();\r\n                                document.removeEventListener(\"DOMContentLoaded\", domContentLoadedHandler);\r\n                            }\r\n                            document.addEventListener('DOMContentLoaded', domContentLoadedHandler); // IE9+\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import {EventBinder, closestByTagName} from '../ToolsDom';\r\n\r\nexport function FormResetPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                layout: () => {\r\n                    var {staticDom, updateDataAspect, environment} = aspects;\r\n\r\n                    var eventBuilder = EventBinder();\r\n                    if (staticDom.selectElement){\r\n                        var form = closestByTagName(staticDom.selectElement, 'FORM');\r\n                        if (form) {\r\n                            eventBuilder.bind(form, \r\n                                'reset', \r\n                                () => environment.window.setTimeout( ()=>updateDataAspect.updateData() ) );\r\n                        }\r\n                    }\r\n                    return {\r\n                        dispose(){\r\n                            eventBuilder.unbind();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// export function FormResetPlugin(aspects){\r\n//     var {staticDom, updateDataAspect, environment} = aspects;\r\n\r\n//     var eventBuilder = EventBinder();\r\n//     if (staticDom.selectElement){\r\n//         var form = closestByTagName(staticDom.selectElement, 'FORM');\r\n//         if (form) {\r\n//             eventBuilder.bind(form, \r\n//                 'reset', \r\n//                 () => environment.window.setTimeout( ()=>updateDataAspect.updateData() ) );\r\n//         }\r\n//     }\r\n//     return {\r\n//         dispose(){\r\n//             eventBuilder.unbind();\r\n//         }\r\n//     }\r\n// }","import {composeSync} from '../ToolsJs';\r\n\r\nexport function FormRestoreOnBackwardPlugin(){\r\n    return {\r\n        buildAspects: (aspects) => {\r\n            return {\r\n                layout: () => {\r\n                    let {staticDom, environment, loadAspect, updateOptionsSelectedAspect} = aspects;\r\n                    let window = environment.window;\r\n                \r\n                    if (staticDom.selectElement && updateOptionsSelectedAspect){\r\n                        loadAspect.load = composeSync(loadAspect.load,\r\n                            function(){\r\n                                // support browser's \"step backward\" and form's values restore\r\n                                if (window.document.readyState !=\"complete\"){\r\n                                    window.setTimeout(function(){\r\n                                        updateOptionsSelectedAspect.updateOptionsSelected();\r\n                                    // there are no need to add more updates as api.updateWasValidated() because backward never trigger .was-validate\r\n                                    // also backward never set the state to invalid\r\n                                    });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\n// export function FormRestoreOnBackwardPlugin(aspects){\r\n//     let {staticDom, environment, loadAspect, updateOptionsSelectedAspect} = aspects;\r\n//     let window = environment.window;\r\n\r\n//     if (staticDom.selectElement && updateOptionsSelectedAspect){\r\n//         loadAspect.load = composeSync(loadAspect.load,\r\n//             function(){\r\n//                 // support browser's \"step backward\" and form's values restore\r\n//                 if (window.document.readyState !=\"complete\"){\r\n//                     window.setTimeout(function(){\r\n//                         updateOptionsSelectedAspect.updateOptionsSelected();\r\n//                     // there are no need to add more updates as api.updateWasValidated() because backward never trigger .was-validate\r\n//                     // also backward never set the state to invalid\r\n//                     });\r\n//                 }\r\n//             })\r\n//     }\r\n// }","import {composeSync} from './ToolsJs'\r\nimport {EventBinder} from './ToolsDom'\r\nimport {addStyling, toggleStyling} from './ToolsStyling'\r\n\r\nexport let utilities = {composeSync, EventBinder, addStyling, toggleStyling}","import Popper from '@popperjs/core'\r\n\r\nimport {createForJQuery} from './CreateForJQuery'\r\n\r\nimport {Bs5PluginSet, multiSelectPlugins, picksPlugins, allPlugins} from './PluginSet'\r\nimport {createDefaultCssBs5} from './DomFactories'\r\n\r\nimport {MultiSelectBuilder} from './MultiSelectBuilder'\r\nimport {utilities} from './ToolSet'\r\n\r\nimport {shallowClearClone} from './ToolsJs'\r\n\r\nconst defaultCss = createDefaultCssBs5();\r\n\r\nconst BsMultiSelect = (\r\n    (window, jQuery, globalPopper) => {\r\n        console.log(defaultCss);\r\n        let plugins = shallowClearClone(Bs5PluginSet, multiSelectPlugins);\r\n        return createForJQuery(window, jQuery, globalPopper, 'BsMultiSelect', plugins, defaultCss)\r\n    }\r\n)(window, window.jQuery, Popper)\r\n\r\nconst BsPicks = (\r\n    (window, jQuery, globalPopper) => {\r\n        let plugins = shallowClearClone(Bs5PluginSet, picksPlugins);\r\n        return createForJQuery(window, jQuery, globalPopper, 'BsPicks', plugins, defaultCss)\r\n    }\r\n)(window, window.jQuery, Popper)\r\n\r\nexport default { BsMultiSelect, BsPicks, \r\n    MultiSelectTools: {MultiSelectBuilder, plugins: shallowClearClone(Bs5PluginSet, allPlugins), defaultCss, utilities}\r\n}","import {PickDomFactoryPlugCss, PickDomFactoryPlugCssBs5, PickDomFactoryPlugCssBs4} from './PickDomFactory'\r\nimport {PicksDomFactoryPlugCss} from './PicksDomFactory'\r\nimport {ChoiceDomFactoryPlugCss, ChoiceDomFactoryPlugCssBs5, ChoiceDomFactoryPlugCssBs4} from './ChoiceDomFactory'\r\nimport {ChoicesDomFactoryPlugCss} from './ChoicesDomFactory'\r\nimport {FilterDomFactoryPlugCss} from './FilterDomFactory'\r\n\r\nexport function createDefaultCssBs5(){\r\n    var defaultCss={};\r\n    PickDomFactoryPlugCss(defaultCss)\r\n    PickDomFactoryPlugCssBs5(defaultCss)\r\n    PicksDomFactoryPlugCss(defaultCss)\r\n    ChoiceDomFactoryPlugCss(defaultCss)\r\n    ChoiceDomFactoryPlugCssBs5(defaultCss)\r\n    ChoicesDomFactoryPlugCss(defaultCss)\r\n    FilterDomFactoryPlugCss(defaultCss)\r\n    return defaultCss;\r\n}\r\n\r\nexport function createDefaultCssBs4(){ \r\n    var defaultCss={}\r\n    PickDomFactoryPlugCss(defaultCss)\r\n    PickDomFactoryPlugCssBs4(defaultCss)\r\n    PicksDomFactoryPlugCss(defaultCss)\r\n    ChoiceDomFactoryPlugCss(defaultCss)\r\n    ChoiceDomFactoryPlugCssBs4(defaultCss)\r\n    ChoicesDomFactoryPlugCss(defaultCss)\r\n    FilterDomFactoryPlugCss(defaultCss)\r\n    return defaultCss;\r\n}"]}